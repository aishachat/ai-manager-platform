# üöÄ –ü–æ—à–∞–≥–æ–≤–∞—è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è RLS

## üìã **–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ü–†–Ø–ú–û –°–ï–ô–ß–ê–°:**

### **–®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard**
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://supabase.com/dashboard
2. –í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç
3. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç `jppujbttlrsobfwuzalw`

### **–®–∞–≥ 2: –û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor**
1. –í –ª–µ–≤–æ–º –º–µ–Ω—é –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ **"SQL Editor"**
2. –ù–∞–∂–º–∏—Ç–µ **"New query"**

### **–®–∞–≥ 3: –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–¥**
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `–§–ò–ù–ê–õ–¨–ù–´–ï_–ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø_RLS.sql`
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–í–ï–°–¨ –ö–û–î** –∏–∑ —Ñ–∞–π–ª–∞
3. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor
4. –ù–∞–∂–º–∏—Ç–µ **"Run"**

### **–®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç**
–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
üéâ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê
total_policies: 99
null_condition_policies: 0  ‚Üê –î–û–õ–ñ–ù–û –ë–´–¢–¨ 0!
true_condition_policies: 3  ‚Üê –°–ø—Ä–∞–≤–æ—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (OK)
project_based_policies: 31
user_based_policies: 46
final_status: ‚úÖ –í–°–ï –ò–°–ü–†–ê–í–õ–ï–ù–û!
```

## üéØ **–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—Å—è:**

### **17 INSERT –ø–æ–ª–∏—Ç–∏–∫ –ø–æ–ª—É—á–∞—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è:**

#### **–¢–∞–±–ª–∏—Ü—ã —Å project_id (9 —Ç–∞–±–ª–∏—Ü):**
- `assistants` ‚Üí `project_id = get_user_project_id()`
- `chat_messages` ‚Üí `project_id = get_user_project_id()`
- `conversations` ‚Üí `project_id = get_user_project_id()`
- `dialogs` ‚Üí `project_id = get_user_project_id()`
- `knowledge_chunks` ‚Üí `project_id = get_user_project_id()`
- `knowledge_sources` ‚Üí `project_id = get_user_project_id()`
- `telegram_settings` ‚Üí `project_id = get_user_project_id()`
- `user_niches` ‚Üí `project_id = get_user_project_id()`
- `widget_development_settings` ‚Üí `project_id = get_user_project_id()`

#### **–¢–∞–±–ª–∏—Ü—ã —Å user_id (1 —Ç–∞–±–ª–∏—Ü–∞):**
- `autoswitch_settings` ‚Üí `auth.uid() = user_id`

#### **–¢–∞–±–ª–∏—Ü—ã —Å owner_id (2 —Ç–∞–±–ª–∏—Ü—ã):**
- `projects` (2 –ø–æ–ª–∏—Ç–∏–∫–∏) ‚Üí `auth.uid() = owner_id`

#### **–¢–∞–±–ª–∏—Ü—ã —Å id (3 —Ç–∞–±–ª–∏—Ü—ã):**
- `users` (3 –ø–æ–ª–∏—Ç–∏–∫–∏) ‚Üí `auth.uid() = id`

#### **–°–ø—Ä–∞–≤–æ—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (1 —Ç–∞–±–ª–∏—Ü–∞):**
- `niches` ‚Üí `auth.uid() IS NOT NULL`

## üìä **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

### **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- ‚ùå **17 –ø–æ–ª–∏—Ç–∏–∫ –±–µ–∑ —É—Å–ª–æ–≤–∏–π** (–∫—Ä–∏—Ç–∏—á–Ω–æ!)
- ‚ö†Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: 7/10**
- üìà **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: 80%**

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- ‚úÖ **0 –ø–æ–ª–∏—Ç–∏–∫ –±–µ–∑ —É—Å–ª–æ–≤–∏–π** 
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: 9.5/10**
- üöÄ **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: 95%+**

## ‚ö†Ô∏è **–í–∞–∂–Ω–æ:**
- **SELECT –ø–æ–ª–∏—Ç–∏–∫–∏ —Å qual="true"** –¥–ª—è `niches` –∏ `niche_synonyms` **–ù–ï –¢–†–û–ì–ê–ï–ú** - —ç—Ç–æ —Å–ø—Ä–∞–≤–æ—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- **project_members** –ø–æ–ª–∏—Ç–∏–∫–∞ —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è - –Ω–µ —Ç—Ä–æ–≥–∞–µ–º

## üèÜ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∞—à–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!**

**–≠—Ç–æ –∑–∞–π–º–µ—Ç 2 –º–∏–Ω—É—Ç—ã –∏ —Å–¥–µ–ª–∞–µ—Ç –≤–∞—à—É RLS –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏–¥–µ–∞–ª—å–Ω–æ–π!**

## üÜò **–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∏ –≤–µ—Å—å –∫–æ–¥
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞–∂–∞–ª–∏ "Run"
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `null_condition_policies: 0`

**–ì–æ—Ç–æ–≤—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è?** üöÄ
