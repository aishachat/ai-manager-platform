# üìã –ü–õ–ê–ù RLS –ü–û–õ–ò–¢–ò–ö –î–õ–Ø –í–°–ï–• –¢–ê–ë–õ–ò–¶

## ‚úÖ –£–ñ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –¢–ê–ë–õ–ò–¶–´

### 1. **users** - ‚úÖ –ì–û–¢–û–í–û
- **–õ–æ–≥–∏–∫–∞**: `id = auth.uid()`
- **–ü–æ–ª–∏—Ç–∏–∫–∞**: `users_own_access`

### 2. **projects** - ‚úÖ –ì–û–¢–û–í–û  
- **–õ–æ–≥–∏–∫–∞**: `owner_id = auth.uid()`
- **–ü–æ–ª–∏—Ç–∏–∫–∞**: `projects_owner_access`

### 3. **project_members** - ‚úÖ –ì–û–¢–û–í–û
- **–õ–æ–≥–∏–∫–∞**: `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())`
- **–ü–æ–ª–∏—Ç–∏–∫–∞**: `project_members_project_access`

### 4. **assistants** - ‚úÖ –ì–û–¢–û–í–û
- **–õ–æ–≥–∏–∫–∞**: `owner_id = auth.uid()` (–∏–∑ –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö)
- **–ü–æ–ª–∏—Ç–∏–∫–∞**: `assistants_owner_access`

### 5. **autoswitch_settings** - ‚úÖ –ì–û–¢–û–í–û
- **–õ–æ–≥–∏–∫–∞**: `user_id = auth.uid()`
- **–ü–æ–ª–∏—Ç–∏–∫–∞**: `autoswitch_settings_user_access`

## üîç –¢–ê–ë–õ–ò–¶–´ –° OWNER_ID (–∏–∑ –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö)

### 6. **conversations** - –¢–†–ï–ë–£–ï–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞**: `owner_id` (uuid)
- **–õ–æ–≥–∏–∫–∞**: `owner_id = auth.uid()`
- **–ü–æ–ª–∏—Ç–∏–∫–∞**: `conversations_owner_access`

## ‚ùì –¢–ê–ë–õ–ò–¶–´ –¢–†–ï–ë–£–Æ–©–ò–ï –ü–†–û–í–ï–†–ö–ò –°–¢–†–£–ö–¢–£–†–´

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
1. **ai_agent_settings** - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ `project_id` –∏–ª–∏ `user_id`
2. **dialogs** - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ `project_id` –∏–ª–∏ `owner_id`
3. **chat_messages** - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ `project_id` –∏–ª–∏ `user_id`

### –¢–∞–±–ª–∏—Ü—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π:
4. **widget_development_settings** - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
5. **telegram_settings** - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
6. **bot_corrections** - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É

### –¢–∞–±–ª–∏—Ü—ã –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π:
7. **knowledge_sources** - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
8. **knowledge_chunks** - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É

### –¢–∞–±–ª–∏—Ü—ã –Ω–∏—à:
9. **niches** - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
10. **niche_synonyms** - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
11. **user_niches** - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É

## üéØ –ü–†–ò–ù–¶–ò–ü–´ RLS –ü–û–õ–ò–¢–ò–ö

### –î–ª—è —Ç–∞–±–ª–∏—Ü —Å `project_id`:
```sql
project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())
```

### –î–ª—è —Ç–∞–±–ª–∏—Ü —Å `user_id`:
```sql
user_id = auth.uid()
```

### –î–ª—è —Ç–∞–±–ª–∏—Ü —Å `owner_id`:
```sql
owner_id = auth.uid()
```

### –î–ª—è —Ç–∞–±–ª–∏—Ü –±–µ–∑ —ç—Ç–∏—Ö –∫–æ–ª–æ–Ω–æ–∫:
- –ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏ —Å–≤—è–∑—å —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏ —á–µ—Ä–µ–∑ –¥—Ä—É–≥–∏–µ –∫–æ–ª–æ–Ω–∫–∏
- –í–æ–∑–º–æ–∂–Ω–æ, —á–µ—Ä–µ–∑ `assistant_id`, `dialog_id`, `conversation_id` –∏ —Ç.–¥.

## üöÄ –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### 1. –°–ï–ô–ß–ê–° - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
- –í—ã–ø–æ–ª–Ω–∏—Ç—å `–ü–†–û–í–ï–†–ö–ê_–í–°–ï–•_–û–°–¢–ê–í–®–ò–•–°–Ø_–¢–ê–ë–õ–ò–¶.sql`
- –ü–æ–ª—É—á–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü

### 2. –ü–û–°–õ–ï –ü–†–û–í–ï–†–ö–ò - –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤:
- –°–æ–∑–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã
- –£—á–µ—Å—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —Å–≤—è–∑–∏

### 3. –ü–û–®–ê–ì–û–í–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï:
- –ò—Å–ø—Ä–∞–≤–ª—è—Ç—å RLS –ø–æ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

## üìû –¢–†–ï–ë–£–ï–¢–°–Ø –î–ï–ô–°–¢–í–ò–ï
–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç `–ü–†–û–í–ï–†–ö–ê_–í–°–ï–•_–û–°–¢–ê–í–®–ò–•–°–Ø_–¢–ê–ë–õ–ò–¶.sql` –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö RLS –ø–æ–ª–∏—Ç–∏–∫.
