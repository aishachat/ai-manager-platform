# üìã –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô - –®–ê–ì–ò 23, 24, 25

## üéØ –ì–û–¢–û–í–´–ï –°–ö–†–ò–ü–¢–´

### ‚úÖ –°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è CRM —Å–∏—Å—Ç–µ–º—ã:

1. **`–®–ê–ì_23_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_CRM_TASKS_–ü–†–û–ï–ö–¢.sql`** - –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `crm_tasks`
2. **`–®–ê–ì_24_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_CRM_DEAL_NOTES_–ü–†–û–ï–ö–¢.sql`** - –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `crm_deal_notes`
3. **`–®–ê–ì_25_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_DIALOG_CRM_CONNECTIONS_–ü–†–û–ï–ö–¢.sql`** - –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `dialog_crm_connections`

## üîß –õ–û–ì–ò–ö–ê RLS

### –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç **PROJECT_ID –ª–æ–≥–∏–∫—É** –¥–ª—è –∫–æ–º–∞–Ω–¥–Ω–æ–π —Ä–∞–±–æ—Ç—ã:
```sql
project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())
```

**–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è:**
- `crm_tasks` - –∑–∞–¥–∞—á–∏ CRM –ø—Ä–æ–µ–∫—Ç–∞
- `crm_deal_notes` - –∑–∞–º–µ—Ç–∫–∏ –∫ —Å–¥–µ–ª–∫–∞–º CRM –ø—Ä–æ–µ–∫—Ç–∞
- `dialog_crm_connections` - —Å–≤—è–∑–∏ –¥–∏–∞–ª–æ–≥–æ–≤ —Å CRM –ø—Ä–æ–µ–∫—Ç–∞

## üöÄ –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û–°–¢–¨ –î–ï–ô–°–¢–í–ò–ô

### –ù–ï–ú–ï–î–õ–ï–ù–ù–û:
1. –í—ã–ø–æ–ª–Ω–∏—Ç—å `–®–ê–ì_23_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_CRM_TASKS_–ü–†–û–ï–ö–¢.sql`
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å `–®–ê–ì_24_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_CRM_DEAL_NOTES_–ü–†–û–ï–ö–¢.sql`
3. –í—ã–ø–æ–ª–Ω–∏—Ç—å `–®–ê–ì_25_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_DIALOG_CRM_CONNECTIONS_–ü–†–û–ï–ö–¢.sql`
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü–û–°–õ–ï –£–°–ü–ï–•–ê:
–°–æ–∑–¥–∞–º —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü:
- `dialog_with_operators` - –¥–∏–∞–ª–æ–≥–∏ —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏ –ø—Ä–æ–µ–∫—Ç–∞
- `faq_cache` - –∫—ç—à FAQ –ø—Ä–æ–µ–∫—Ç–∞
- `help_requests` - –∑–∞–ø—Ä–æ—Å—ã –ø–æ–º–æ—â–∏ –ø—Ä–æ–µ–∫—Ç–∞

## üí° –í–ê–ñ–ù–û

### **–í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–æ—Å—Ç—É—é PROJECT_ID –ª–æ–≥–∏–∫—É
- ‚úÖ USER_ID –æ—Å—Ç–∞–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- ‚úÖ –ö–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞ - –≤—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ –≤–∏–¥—è—Ç –¥–∞–Ω–Ω—ã–µ CRM –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### **–û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ RLS –≤–∫–ª—é—á–µ–Ω
- ‚úÖ –ü–æ–ª–∏—Ç–∏–∫–∏ —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ –ü—Ä–∞–≤–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã
- ‚úÖ –¢–µ—Å—Ç –∏–∑–æ–ª—è—Ü–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤ –≤–ª–∞–¥–µ–ª—å—Ü–∞

## üìû –¢–†–ï–ë–£–ï–¢–°–Ø –î–ï–ô–°–¢–í–ò–ï

### **–°–ï–ô–ß–ê–°:**
1. –í—ã–ø–æ–ª–Ω–∏—Ç—å –≥–æ—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
3. –°–æ–æ–±—â–∏—Ç—å –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö

### **–ü–û–°–õ–ï –£–°–ü–ï–•–ê:**
1. –°–æ–∑–¥–∞–º —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
2. –ü—Ä–∏–º–µ–Ω–∏–º —Ç—É –∂–µ –ª–æ–≥–∏–∫—É
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º –≤—Å—é —Å–∏—Å—Ç–µ–º—É

## üéØ –ü–†–û–ì–†–ï–°–°

### **‚úÖ –í–´–ü–û–õ–ù–ï–ù–û (18 —Ç–∞–±–ª–∏—Ü):**
1. **users** - ‚úÖ `id = auth.uid()`
2. **projects** - ‚úÖ `owner_id = auth.uid()`
3. **project_members** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())`
4. **assistants** - ‚úÖ `owner_id = auth.uid()`
5. **autoswitch_settings** - ‚úÖ `user_id = auth.uid()`
6. **conversations** - ‚úÖ `owner_id = auth.uid()`
7. **user_niches** - ‚úÖ `user_id = auth.uid() AND project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())`
8. **niche_synonyms** - ‚úÖ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫: —á—Ç–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö, –∑–∞–ø–∏—Å—å –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤
9. **ai_agent_settings** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())`
10. **dialogs** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())`
11. **chat_messages** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())`
12. **widget_development_settings** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())`
13. **telegram_settings** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())`
14. **knowledge_sources** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())`
15. **knowledge_chunks** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())`
16. **crm_clients** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())`
17. **crm_deals** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())`
18. **crm_operators** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())`

### **üéØ –ì–û–¢–û–í–´ –ö –í–´–ü–û–õ–ù–ï–ù–ò–Æ (3 —Ç–∞–±–ª–∏—Ü—ã):**
19. **crm_tasks** - –≥–æ—Ç–æ–≤ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é
20. **crm_deal_notes** - –≥–æ—Ç–æ–≤ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é
21. **dialog_crm_connections** - –≥–æ—Ç–æ–≤ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é

**–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!** üöÄ
