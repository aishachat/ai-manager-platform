# üìä –û–¢–ß–ï–¢ –û –õ–û–ì–ò–ö–ï –°–ü–†–ê–í–û–ß–ù–ò–ö–û–í

## üîç –û–ë–ù–ê–†–£–ñ–ï–ù–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê

### –¢–∞–±–ª–∏—Ü–∞: `niche_synonyms` (–°–ü–†–ê–í–û–ß–ù–ò–ö)
```sql
–°—Ç—Ä—É–∫—Ç—É—Ä–∞:
- id (uuid, NOT NULL) - –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
- niche_id (uuid, NOT NULL) - —Å—Å—ã–ª–∫–∞ –Ω–∞ –Ω–∏—à—É
- synonym (text, NOT NULL) - —Å–∏–Ω–æ–Ω–∏–º
- created_at (timestamp, nullable) - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
```

## üéØ –õ–û–ì–ò–ö–ê RLS –î–õ–Ø –°–ü–†–ê–í–û–ß–ù–ò–ö–û–í

### ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–ª–æ—Å—å):
```sql
-- –ü–æ–ª–∏—Ç–∏–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ project_id –∏–ª–∏ user_id
project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())
-- –∏–ª–∏
user_id = auth.uid()
```

### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (—Å–ø—Ä–∞–≤–æ—á–Ω–∞—è –ª–æ–≥–∏–∫–∞):
```sql
-- –ß—Ç–µ–Ω–∏–µ: –≤—Å–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
FOR SELECT USING (true)

-- –ó–∞–ø–∏—Å—å: —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—ã –ø—Ä–æ–µ–∫—Ç–æ–≤
FOR ALL USING (
    EXISTS (SELECT 1 FROM projects WHERE owner_id = auth.uid())
)
```

## üìã –ü–†–ò–ù–¶–ò–ü –†–ê–ë–û–¢–´ –°–ü–†–ê–í–û–ß–ù–ò–ö–û–í

### –õ–æ–≥–∏–∫–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞:
- **–û–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ** –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–∏—Å—Ç–µ–º—ã
- **–ß—Ç–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –≤—Å–µ–º** –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü–∞–º** –ø—Ä–æ–µ–∫—Ç–æ–≤
- **–ù–µ—Ç –ø—Ä–∏–≤—è–∑–∫–∏** –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞–º

### RLS –ø–æ–ª–∏—Ç–∏–∫–∏:
```sql
-- –ü–æ–ª–∏—Ç–∏–∫–∞ —á—Ç–µ–Ω–∏—è
CREATE POLICY "niche_synonyms_public_read" ON public.niche_synonyms
    FOR SELECT USING (true);

-- –ü–æ–ª–∏—Ç–∏–∫–∞ –∑–∞–ø–∏—Å–∏
CREATE POLICY "niche_synonyms_owner_write" ON public.niche_synonyms
    FOR ALL USING (
        EXISTS (SELECT 1 FROM projects WHERE owner_id = auth.uid())
    )
    WITH CHECK (
        EXISTS (SELECT 1 FROM projects WHERE owner_id = auth.uid())
    );
```

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –°–æ–∑–¥–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç:
- ‚úÖ `–®–ê–ì_11_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_NICHE_SYNONYMS_–°–ü–†–ê–í–û–ß–ù–ò–ö.sql`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–≥–∏–∫—É —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞
- ‚úÖ –î–≤–µ –ø–æ–ª–∏—Ç–∏–∫–∏: —á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å
- ‚úÖ –ë–µ–∑ –æ—à–∏–±–æ–∫ —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –∫–æ–ª–æ–Ω–∫–∞–º–∏

### 2. –°–æ–∑–¥–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:
- ‚úÖ `–ò–ù–°–¢–†–£–ö–¶–ò–Ø_–í–´–ü–û–õ–ù–ï–ù–ò–Ø_–®–ê–ì_11_–°–ü–†–ê–í–û–ß–ù–ò–ö.md`
- ‚úÖ –û–±—ä—è—Å–Ω—è–µ—Ç –ª–æ–≥–∏–∫—É —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞
- ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### 1. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
- –ó–∞–ø—É—Å—Ç–∏—Ç—å `–®–ê–ì_11_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_NICHE_SYNONYMS_–°–ü–†–ê–í–û–ß–ù–ò–ö.sql`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### 2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¥—Ä—É–≥–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏:
–í–æ–∑–º–æ–∂–Ω–æ, –¥—Ä—É–≥–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Ç–æ–∂–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏:
- `niches` - –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–∂–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫
- `knowledge_sources` - –≤–æ–∑–º–æ–∂–Ω–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫
- `knowledge_chunks` - –≤–æ–∑–º–æ–∂–Ω–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
- `ai_agent_settings` - –≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞ user_id –∏–ª–∏ project_id
- `dialogs` - –≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞ project_id
- `chat_messages` - –≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞ user_id –∏–ª–∏ project_id
- `widget_development_settings` - –≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞ project_id
- `telegram_settings` - –≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞ project_id
- `bot_corrections` - –≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞ project_id

## üí° –í–´–í–û–î–´

1. **–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –∏–º–µ—é—Ç –æ—Å–æ–±—É—é –ª–æ–≥–∏–∫—É RLS** - —á—Ç–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö, –∑–∞–ø–∏—Å—å –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤
2. **–ù—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ç–∏–ø —Ç–∞–±–ª–∏—Ü—ã** –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º RLS:
   - –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ ‚Üí –ª–æ–≥–∏–∫–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ ‚Üí user_id = auth.uid()
   - –ü—Ä–æ–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí project_id —á–µ—Ä–µ–∑ –ø—Ä–æ–µ–∫—Ç—ã
   - –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ ‚Üí user_id + project_id

3. **–õ–æ–≥–∏–∫–∞ RLS –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã**:
   - –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ ‚Üí –æ–±—â–∏–π –¥–æ—Å—Ç—É–ø –¥–ª—è —á—Ç–µ–Ω–∏—è
   - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí –∏–∑–æ–ª—è—Ü–∏—è –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
   - –ü—Ä–æ–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí –∏–∑–æ–ª—è—Ü–∏—è –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º

## üìû –¢–†–ï–ë–£–ï–¢–°–Ø –î–ï–ô–°–¢–í–ò–ï
–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç `–®–ê–ì_11_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_NICHE_SYNONYMS_–°–ü–†–ê–í–û–ß–ù–ò–ö.sql` –∏ —Å–æ–æ–±—â–∏—Ç–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö.
