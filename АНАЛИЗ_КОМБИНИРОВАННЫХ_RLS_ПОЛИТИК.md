# üîç –ê–ù–ê–õ–ò–ó –ö–û–ú–ë–ò–ù–ò–†–û–í–ê–ù–ù–´–• RLS –ü–û–õ–ò–¢–ò–ö

## üéØ –í–ê–ñ–ù–û–°–¢–¨ –ù–ê–õ–ò–ß–ò–Ø USER_ID –ò PROJECT_ID

### –ü–æ—á–µ–º—É —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ:
1. **–î–≤–æ–π–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ
2. **–ì–∏–±–∫–æ—Å—Ç—å –¥–æ—Å—Ç—É–ø–∞** - —Ä–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –¥–æ—Å—Ç—É–ø–∞
3. **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –ø—Ä–æ–µ–∫—Ç–∞—Ö

## üìä –í–ê–†–ò–ê–ù–¢–´ RLS –ü–û–õ–ò–¢–ò–ö

### 1. –¢–û–õ–¨–ö–û USER_ID
```sql
user_id = auth.uid()
```
**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –î–∞–Ω–Ω—ã–µ, –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∫ –ø—Ä–æ–µ–∫—Ç–∞–º

**–ü—Ä–∏–º–µ—Ä:** `autoswitch_settings`

### 2. –¢–û–õ–¨–ö–û PROJECT_ID
```sql
project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())
```
**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- –û–±—â–∏–µ —Ä–µ—Å—É—Ä—Å—ã –ø—Ä–æ–µ–∫—Ç–∞
- –î–∞–Ω–Ω—ã–µ, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –ø—Ä–æ–µ–∫—Ç–∞

**–ü—Ä–∏–º–µ—Ä:** `widget_development_settings`, `telegram_settings`

### 3. –ö–û–ú–ë–ò–ù–ò–†–û–í–ê–ù–ù–ê–Ø (USER_ID + PROJECT_ID)
```sql
user_id = auth.uid() 
AND project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())
```
**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø—Ä–æ–µ–∫—Ç–µ
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º
- –°–≤—è–∑–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å-–ø—Ä–æ–µ–∫—Ç

**–ü—Ä–∏–º–µ—Ä:** `user_niches`

### 4. –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–ê–Ø (USER_ID –ò–õ–ò PROJECT_ID)
```sql
user_id = auth.uid() 
OR project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())
```
**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –î–∞–Ω–Ω—ã–µ, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏–ª–∏ –≤–ª–∞–¥–µ–ª—å—Ü—É –ø—Ä–æ–µ–∫—Ç–∞
- –ì–∏–±–∫–∏–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º

## üîß –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò–ï –ü–†–ò–ú–ï–†–´

### –¢–∞–±–ª–∏—Ü–∞ `chat_messages`:
```sql
-- –í–∞—Ä–∏–∞–Ω—Ç 1: –¢–æ–ª—å–∫–æ –ø–æ –ø—Ä–æ–µ–∫—Ç—É (–≤—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –≤–∏–¥—è—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è)
project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())

-- –í–∞—Ä–∏–∞–Ω—Ç 2: –¢–æ–ª—å–∫–æ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è)
user_id = auth.uid()

-- –í–∞—Ä–∏–∞–Ω—Ç 3: –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–≤–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Å–≤–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö)
user_id = auth.uid() 
AND project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())
```

### –¢–∞–±–ª–∏—Ü–∞ `dialogs`:
```sql
-- –í–∞—Ä–∏–∞–Ω—Ç 1: –¢–æ–ª—å–∫–æ –ø–æ –ø—Ä–æ–µ–∫—Ç—É (–≤—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –≤–∏–¥—è—Ç –≤—Å–µ –¥–∏–∞–ª–æ–≥–∏)
project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())

-- –í–∞—Ä–∏–∞–Ω—Ç 2: –¢–æ–ª—å–∫–æ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∏–∞–ª–æ–≥–∏)
user_id = auth.uid()

-- –í–∞—Ä–∏–∞–Ω—Ç 3: –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–≤–æ–∏ –¥–∏–∞–ª–æ–≥–∏ –≤ —Å–≤–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö)
user_id = auth.uid() 
AND project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())
```

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –í–´–ë–û–†–£ –õ–û–ì–ò–ö–ò

### –î–ª—è —Ç–∞–±–ª–∏—Ü —Å USER_ID + PROJECT_ID:

#### –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¢–û–õ–¨–ö–û PROJECT_ID –µ—Å–ª–∏:
- –î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –ø—Ä–æ–µ–∫—Ç–∞
- –≠—Ç–æ –æ–±—â–∏–µ —Ä–µ—Å—É—Ä—Å—ã –ø—Ä–æ–µ–∫—Ç–∞
- –ù—É–∂–µ–Ω –∫–æ–º–∞–Ω–¥–Ω—ã–π –¥–æ—Å—Ç—É–ø

#### –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¢–û–õ–¨–ö–û USER_ID –µ—Å–ª–∏:
- –≠—Ç–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ù—É–∂–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è –∏–∑–æ–ª—è—Ü–∏—è –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–≤—è–∑–∞–Ω—ã —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏

#### –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ö–û–ú–ë–ò–ù–ò–†–û–í–ê–ù–ù–£–Æ –µ—Å–ª–∏:
- –ù—É–∂–Ω–∞ –¥–≤–æ–π–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Å–≤–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö
- –¢—Ä–µ–±—É–µ—Ç—Å—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

## üö® –í–ê–ñ–ù–´–ï –ú–û–ú–ï–ù–¢–´

### 1. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –º–µ–¥–ª–µ–Ω–Ω–µ–µ
- –ü—Ä–æ—Å—Ç—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –±—ã—Å—Ç—Ä–µ–µ
- –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –∏–Ω–¥–µ–∫—Å—ã

### 2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ
- –î–≤–æ–π–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–Ω–∏–∂–∞–µ—Ç —Ä–∏—Å–∫–∏
- –°–ª–æ–∂–Ω–µ–µ –æ–±–æ–π—Ç–∏ –∑–∞—â–∏—Ç—É

### 3. –ì–∏–±–∫–æ—Å—Ç—å:
- –ü—Ä–æ—Å—Ç—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –ø—Ä–æ—â–µ –≤ –ø–æ–Ω–∏–º–∞–Ω–∏–∏
- –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞—é—Ç –±–æ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è
- –ù—É–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

## üìã –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### 1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã:
- –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
- –í—ã–±—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ç–∏–ø RLS
- –£—á–µ—Å—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 2. –°–æ–∑–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏:
- –ü—Ä–æ—Å—Ç—ã–µ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤
- –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
- –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–æ–ª—è—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö
- –£–±–µ–¥–∏—Ç—å—Å—è –≤ —Ä–∞–±–æ—Ç–µ API
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
