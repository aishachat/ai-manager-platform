import { useState, useEffect } from 'react'

// API –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
const API_BASE_URL = 'http://localhost:3001/api';

// Custom SVG Icons
const BarChart3 = ({ className }: { className?: string }) => (
  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
  </svg>
)

const MessageSquare = ({ className }: { className?: string }) => (
  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
  </svg>
)

const Database = ({ className }: { className?: string }) => (
  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <ellipse cx="12" cy="5" rx="9" ry="3" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} />
    <path d="M3 5v14c0 1.66 4.03 3 9 3s9-1.34 9-3V5" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} />
    <path d="M3 12c0 1.66 4.03 3 9 3s9-1.34 9-3" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} />
  </svg>
)

const Settings = ({ className }: { className?: string }) => (
  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
  </svg>
)

const Zap = ({ className }: { className?: string }) => (
  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
  </svg>
)

const User = ({ className }: { className?: string }) => (
  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
  </svg>
)

const Plus = ({ className }: { className?: string }) => (
  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
  </svg>
)

const ExternalLink = ({ className }: { className?: string }) => (
  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
  </svg>
)

const AlertTriangle = ({ className }: { className?: string }) => (
  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
  </svg>
)

const Info = ({ className }: { className?: string }) => (
  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <circle cx="12" cy="12" r="10" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} />
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 16v-4m0-4h.01" />
  </svg>
)

const Send = ({ className }: { className?: string }) => (
  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
  </svg>
)

const Menu = ({ className }: { className?: string }) => (
  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
  </svg>
)

// Extra icons for UI
const Globe = ({ className }: { className?: string }) => (
  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 21c4.97 0 9-4.03 9-9s-4.03-9-9-9-9 4.03-9 9 4.03 9 9 9z" />
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12h18M12 3c2.5 2.5 2.5 15.5 0 18M8 3.5c-1.5 2.2-1.5 14.8 0 17M16 3.5c1.5 2.2 1.5 14.8 0 17" />
  </svg>
)

const LinkIcon = ({ className }: { className?: string }) => (
  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14a3 3 0 004.243 0l3.535-3.535a3 3 0 10-4.243-4.243L12 6M14 10l-2 2m-2-2L6.222 13.778a3 3 0 104.243 4.243L10 18" />
  </svg>
)

const EditIcon = ({ className }: { className?: string }) => (
  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 4h7a2 2 0 012 2v7M7 17l-4 4 1-5 10-10 4 4-10 10z" />
  </svg>
)

const FileIcon = ({ className }: { className?: string }) => (
  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 3h6l5 5v13a1 1 0 01-1 1H7a1 1 0 01-1-1V4a1 1 0 011-1z" />
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 3v6h6" />
  </svg>
)

const Trash = ({ className }: { className?: string }) => (
  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7H5m3 0V5a2 2 0 012-2h4a2 2 0 012 2v2m-1 0v12a2 2 0 01-2 2H8a2 2 0 01-2-2V7h10z" />
  </svg>
)

const Trash2 = ({ className }: { className?: string }) => (
  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
  </svg>
)

const ArrowUp = ({ className }: { className?: string }) => (
  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 15l7-7 7 7" />
  </svg>
)

const ArrowDown = ({ className }: { className?: string }) => (
  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
  </svg>
)

type MenuItem = {
  icon: React.ComponentType<{ className?: string }>
  label: string
  id: string
}

const menuItems: MenuItem[] = [
  { icon: User, label: '–ú–æ–π Adapto', id: 'my-solo' },
  { icon: BarChart3, label: '–°–≤–æ–¥–∫–∞', id: 'dashboard' },
  { icon: MessageSquare, label: '–î–∏–∞–ª–æ–≥–∏', id: 'dialogs' },
  { icon: Database, label: '–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π', id: 'knowledge' },
  { icon: Settings, label: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥–µ–ª–∏', id: 'model-settings' },
  { icon: Zap, label: '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏', id: 'integrations' }
]

// Simple Button component
const Button = ({ children, variant = 'default', size = 'default', className = '', onClick, ...props }: any) => {
  const baseClasses = 'inline-flex items-center justify-center rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2'
  const variants = {
    default: 'bg-slate-900 text-white hover:bg-slate-800',
    outline: 'border border-gray-300 bg-white hover:bg-gray-50',
    ghost: 'hover:bg-gray-100'
  }
  const sizes = {
    sm: 'h-8 px-3 text-sm',
    default: 'h-10 px-4',
    lg: 'h-12 px-8'
  }
  
  return (
    <button 
      className={`${baseClasses} ${variants[variant]} ${sizes[size]} ${className}`}
      onClick={onClick}
      {...props}
    >
      {children}
    </button>
  )
}

// Simple Card components
const Card = ({ children, className = '', ...props }: any) => (
  <div className={`rounded-lg border border-gray-200 bg-white shadow-sm ${className}`} {...props}>
    {children}
  </div>
)

const CardHeader = ({ children, className = '', ...props }: any) => (
  <div className={`flex flex-col space-y-1.5 p-6 ${className}`} {...props}>
    {children}
  </div>
)

const CardTitle = ({ children, className = '', ...props }: any) => (
  <h3 className={`text-2xl font-semibold leading-none tracking-tight ${className}`} {...props}>
    {children}
  </h3>
)

const CardContent = ({ children, className = '', ...props }: any) => (
  <div className={`p-6 pt-0 ${className}`} {...props}>
    {children}
  </div>
)

// Simple Input component
const Input = ({ className = '', ...props }: any) => (
  <input 
    className={`flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:cursor-not-allowed disabled:opacity-50 ${className}`}
    {...props}
  />
)

// Simple Textarea component
const Textarea = ({ className = '', ...props }: any) => (
  <textarea 
    className={`flex w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:cursor-not-allowed disabled:opacity-50 ${className}`}
    {...props}
  />
)

// Simple Progress component
const Progress = ({ value = 0, className = '', ...props }: any) => (
  <div className={`relative h-4 w-full overflow-hidden rounded-full bg-gray-200 ${className}`} {...props}>
    <div 
      className="h-full bg-blue-600 transition-all"
      style={{ width: `${value}%` }}
    />
  </div>
)

export default function App() {
  const [isLoggedIn, setIsLoggedIn] = useState(() => {
    const token = localStorage.getItem('authToken');
    return !!token;
  })
  const [currentStep, setCurrentStep] = useState<'login' | 'register' | 'register-email' | 'register-name' | 'register-phone' | 'register-company' | 'dashboard' | 'forgot-password' | 'reset-password'>('login')
  const [showSuccessModal, setShowSuccessModal] = useState(false)
  const [showNotification, setShowNotification] = useState(false)
  const [notificationMessage, setNotificationMessage] = useState('')
  const [selectedKbType, setSelectedKbType] = useState<'site' | 'feed' | 'text' | 'file' | null>(null)
  const [kbInputValue, setKbInputValue] = useState('')
  const [formData, setFormData] = useState({
    email: '',
    password: '',
    name: '',
    company: '',
    phone: '',
    companyField: ''
  })
  const [selectedDataFields, setSelectedDataFields] = useState<string[]>(['–ò–º—è', '–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞'])
  const [userAddress, setUserAddress] = useState<'ty' | 'vy'>('vy')
  
  const [activeSection, setActiveSection] = useState('my-solo')
  const [sidebarOpen, setSidebarOpen] = useState(false)
  const [chatMessage, setChatMessage] = useState('')
  const [chatHistory, setChatHistory] = useState([
    { type: 'assistant', text: '–ü—Ä–∏–≤–µ—Ç! –Ø –≤–∞—à –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç Adapto. –ö–∞–∫ –¥–µ–ª–∞?' }
  ])
  const [kbModalOpen, setKbModalOpen] = useState(false)
  const [kbItems, setKbItems] = useState<{ id: number, type: 'site' | 'feed' | 'text' | 'file', title: string, status: '–ó–∞–≥—Ä—É–∂–µ–Ω' | '–û–±—Ä–∞–±–æ—Ç–∫–∞' }[]>([])
  const [dialogStages, setDialogStages] = useState<Array<{id: number, name: string, order: number}>>([
    {id: 1, name: '–í—ã—è—Å–Ω–∏ —Ü–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.', order: 1},
    {id: 2, name: '–ü–æ–π–º–∏ —Ç–µ–∫—É—â—É—é —Å–∏—Ç—É–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.', order: 2},
    {id: 3, name: '–û–ø–∏—à–∏, –±–ª–∞–≥–æ–¥–∞—Ä—è –∫–∞–∫–∏–º –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞–º –º—ã –ø–æ–º–æ–∂–µ–º –µ–º—É –ø—Ä–∏–π—Ç–∏ –∫ —Ü–µ–ª–∏.', order: 3},
    {id: 4, name: '–ó–∞–ø–∏—Å–∞—Ç—å –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é', order: 4}
  ])
  const [tone, setTone] = useState<'–î—Ä—É–∂–µ–ª—é–±–Ω—ã–π' | '–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π' | '–ß–µ–ª–æ–≤–µ—á–Ω—ã–π' | '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π' | '–Æ–º–æ—Ä'>('–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π')
  const [emojiUsage, setEmojiUsage] = useState<'–ù–∏–∫–æ–≥–¥–∞' | '–†–µ–¥–∫–æ' | '–ß–∞—Å—Ç–æ'>('–†–µ–¥–∫–æ')
  const [targetAudience, setTargetAudience] = useState('–º–∞–ª—ã–π –±–∏–∑–Ω–µ—Å')
  
  // –ù–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
  const [currentUser, setCurrentUser] = useState<{
    name: string;
    company_name: string;
    email: string;
    id?: string;
  } | null>(null);
  const [assistants, setAssistants] = useState([]);
  const [knowledgeItems, setKnowledgeItems] = useState([]);

  const handleDeleteKnowledgeItem = (index: number) => {
    setSetupData(prev => ({
      ...prev,
      knowledgeItems: prev.knowledgeItems.filter((_, i) => i !== index)
    }));
  };
  const [currentAssistant, setCurrentAssistant] = useState(null);
  const [showKbModal, setShowKbModal] = useState(false);
  const [kbProcessing, setKbProcessing] = useState(false);
  const [currentSection, setCurrentSection] = useState(() => {
    const saved = localStorage.getItem('currentSection');
    return saved || 'summary';
  });
  const [showAddStage, setShowAddStage] = useState(false);
  const [newStageName, setNewStageName] = useState('');
  const [conversations, setConversations] = useState([
    {
      id: 1,
      client: '–ö–ª–∏–µ–Ω—Ç #1234',
      lastMessage: '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ú–µ–Ω—è –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Ç –≤–∞—à–∏ —É—Å–ª—É–≥–∏',
      timestamp: '2024-01-15 14:30',
      messages: [
        { id: 1, type: 'ai', text: '–ü—Ä–∏–≤–µ—Ç! –Ø –≤–∞—à –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –ö–∞–∫ –º–æ–≥—É –ø–æ–º–æ—á—å?', timestamp: '14:25' },
        { id: 2, type: 'user', text: '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ú–µ–Ω—è –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Ç –≤–∞—à–∏ —É—Å–ª—É–≥–∏', timestamp: '14:30' },
        { id: 3, type: 'ai', text: '–ö–æ–Ω–µ—á–Ω–æ! –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ, –∫–∞–∫–∏–µ –∏–º–µ–Ω–Ω–æ —É—Å–ª—É–≥–∏ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Ç?', timestamp: '14:31' },
        { id: 4, type: 'user', text: '–•–æ—á—É –∑–∞–∫–∞–∑–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É —Å–∞–π—Ç–∞', timestamp: '14:32' },
        { id: 5, type: 'ai', text: '–û—Ç–ª–∏—á–Ω–æ! –£ –Ω–∞—Å –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–∞–∫–µ—Ç–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –ö–∞–∫–æ–π –±—é–¥–∂–µ—Ç —É –≤–∞—Å –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è?', timestamp: '14:33' }
      ]
    }
  ]);
  const [selectedConversation, setSelectedConversation] = useState(null);
  const [showConversationDetail, setShowConversationDetail] = useState(false);
  const [showIntegrationModal, setShowIntegrationModal] = useState(false);
  const [selectedIntegration, setSelectedIntegration] = useState('');
  const [showWidgetConstructor, setShowWidgetConstructor] = useState(false);
  const [widgetSettings, setWidgetSettings] = useState({
    accentColor: '#1354FC',
    buttonColor: 'light',
    buttonText: '–°–ø—Ä–æ—Å–∏—Ç—å –ò–ò',
    buttonSubtext: '–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å',
    avatar: 'default',
    customButtonColor: '#1354FC',
    showCustomColorPicker: false,
    widgetLocation: 'default',
    // Widget positioning
    desktopBottomOffset: 20,
    desktopRightOffset: 20,
    mobileBottomOffset: 20,
    mobileRightOffset: 20,
    zIndex: 9999,
    // Welcome message
    welcomeMessages: ['–ü—Ä–∏–≤–µ—Ç! –ú–µ–Ω—è –∑–æ–≤—É—Ç Adapto, —è –ò–ò –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç.'],
    // Trigger question
    triggerQuestion: '–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å',
    triggerQuestionEnabled: 'no',
    triggerQuestionDelay: 5,
    triggerQuestionText: '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ï—Å–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è –≤–æ–ø—Ä–æ—Å, –º–æ–∂–µ—Ç–µ –∑–∞–¥–∞—Ç—å –µ–≥–æ –≤ —á–∞—Ç–µ, —è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ –æ—Ç–≤–µ—á—É',
    triggerQuickReply: '–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å',
    // Follow up message
    followUpMessage: 'no',
    followUpDelay: 10,
    followUpQuestion: '–ü—Ä–æ–¥–æ–ª–∂–∏–º –¥–∏–∞–ª–æ–≥?',
    followUpQuickReply: '–†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ',
    // Quick replies
    quickReplies: ['–†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ'],
    privacyPolicyUrl: 'https://',
    dataTags: ['utm_source', 'utm_medium', 'utm_campaign', 'utm_term', 'utm_content'],
    excludedPages: []
  });
  const [formErrors, setFormErrors] = useState<{[key: string]: string}>({});
  const [countryCode, setCountryCode] = useState('+7');
  const [showProgressBar, setShowProgressBar] = useState(false);
  const [showHintCard, setShowHintCard] = useState(() => {
    const saved = localStorage.getItem('showHintCard');
    return saved ? JSON.parse(saved) : true;
  });
  const [showWarningCard, setShowWarningCard] = useState(() => {
    const saved = localStorage.getItem('showWarningCard');
    return saved ? JSON.parse(saved) : true;
  });
  const [showSetupWizard, setShowSetupWizard] = useState(false);
  const [botCorrection, setBotCorrection] = useState('');
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  useEffect(() => {
    const token = localStorage.getItem('authToken');
    const userId = localStorage.getItem('userId');
    
    console.log('Loading user data:', { token: !!token, userId });
    
    if (token && userId) {
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –≤—Ö–æ–¥–∞
      setIsLoggedIn(true);
      setCurrentStep('dashboard');
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ localStorage
      const savedUser = localStorage.getItem('userData');
      console.log('Saved user data:', savedUser);
      
      if (savedUser) {
        try {
          const userData = JSON.parse(savedUser);
          console.log('Parsed user data:', userData);
          setCurrentUser(userData);
        } catch (error) {
          console.error('Error parsing user data:', error);
        }
      } else {
        console.log('No saved user data found');
      }
    }
  }, []);

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–∞—Å—Ç–µ—Ä —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
  useEffect(() => {
    if (isLoggedIn) {
      const hasShownSetup = localStorage.getItem('hasShownSetupWizard');
      if (!hasShownSetup) {
        setShowSetupWizard(true);
      }
    }
  }, [isLoggedIn]);

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ localStorage –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏
  useEffect(() => {
    if (currentUser && isLoggedIn) {
      localStorage.setItem('userData', JSON.stringify(currentUser));
    }
  }, [currentUser, isLoggedIn]);
  
  const [setupStep, setSetupStep] = useState(1);
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  const getInitialSetupData = () => {
    const savedData = localStorage.getItem('setupData');
    if (savedData) {
      try {
        const parsedData = JSON.parse(savedData);
        return {
          // –®–∞–≥ 1: –¶–µ–ª–∏ Adapto
          task: parsedData.task || '',
          mainGoal: parsedData.mainGoal || '',
          mainGoalCustom: parsedData.mainGoalCustom || '',
          salesCycle: parsedData.salesCycle || '',
          targetAudience: parsedData.targetAudience || '',
          
          // –®–∞–≥ 2: –ü—Ä–∞–≤–∏–ª–∞ –æ–±—â–µ–Ω–∏—è
          addressing: parsedData.addressing || '–í—ã',
          communicationStyle: parsedData.communicationStyle || '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π',
          restrictions: parsedData.restrictions || [],
          restrictionsCustom: parsedData.restrictionsCustom || '',
          additionalSettings: parsedData.additionalSettings || [],
          additionalSettingsCustom: parsedData.additionalSettingsCustom || '',
          dataCollection: parsedData.dataCollection || [],
          dataCollectionCustom: parsedData.dataCollectionCustom || '',
          clarificationRules: parsedData.clarificationRules || [],
          clarificationRulesCustom: parsedData.clarificationRulesCustom || '',
          emojiUsage: parsedData.emojiUsage || '–†–µ–¥–∫–æ',
          
          // –®–∞–≥ 3: –≠—Ç–∞–ø—ã –¥–∏–∞–ª–æ–≥–∞
          dialogStages: parsedData.dialogStages || [
            '–ü–æ–∑–¥–æ—Ä–æ–≤–∞–π—Å—è –∏ —Å–ø—Ä–æ—Å–∏ –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞. –£—Ç–æ—á–Ω–∏ –µ–≥–æ –ø—Ä–æ–±–ª–µ–º—É –∏ –ø–æ–π–º–∏ —Ç–µ–∫—É—â—É—é —Å–∏—Ç—É–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',
            '–û–ø–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–æ –∫–∞–∫ —Ä–µ—à–∏—à—å –µ–≥–æ –∑–∞–¥–∞—á—É/–Ω–∞–∑–æ–≤–∏ –Ω–∞—à–∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞, –ø—Ä–µ–¥–ª–æ–∂–∏ —Ç–æ–≤–∞—Ä—ã –ø–æ –∑–∞–ø—Ä–æ—Å—É',
            '–í–µ–¥–∏ –∫–ª–∏–µ–Ω—Ç–∞ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é –∑–∞–∫–∞–∑–∞/–∑–∞—è–≤–∫–∏',
            '–ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –≥–æ—Ç–æ–≤ –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑, —Å–¥–µ–ª–∞–π –∏—Ç–æ–≥ –∑–∞–∫–∞–∑–∞ –∏ –ø—Ä–∏—à–ª–∏ —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π.',
            '–ü–µ—Ä–µ–≤–µ–¥–∏ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–ø–ª–∞—Ç—ã –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã'
          ],
          
          // –®–∞–≥ 4: –û–±—É—á–µ–Ω–∏–µ
          knowledgeItems: parsedData.knowledgeItems || [],
          selectedKnowledgeType: parsedData.selectedKnowledgeType || '',
          knowledgeInputValue: parsedData.knowledgeInputValue || ''
        };
      } catch (error) {
        console.error('Error parsing setup data:', error);
      }
    }
    
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç
    return {
      // –®–∞–≥ 1: –¶–µ–ª–∏ Adapto
      task: '',
      mainGoal: '',
      mainGoalCustom: '',
      salesCycle: '',
      targetAudience: '',
      
      // –®–∞–≥ 2: –ü—Ä–∞–≤–∏–ª–∞ –æ–±—â–µ–Ω–∏—è
      addressing: '–í—ã',
      communicationStyle: '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π',
      restrictions: [],
      restrictionsCustom: '',
      additionalSettings: [],
      additionalSettingsCustom: '',
      dataCollection: [],
      dataCollectionCustom: '',
      clarificationRules: [],
      clarificationRulesCustom: '',
      emojiUsage: '–†–µ–¥–∫–æ',
      
      // –®–∞–≥ 3: –≠—Ç–∞–ø—ã –¥–∏–∞–ª–æ–≥–∞
      dialogStages: [
        '–ü–æ–∑–¥–æ—Ä–æ–≤–∞–π—Å—è –∏ —Å–ø—Ä–æ—Å–∏ –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞. –£—Ç–æ—á–Ω–∏ –µ–≥–æ –ø—Ä–æ–±–ª–µ–º—É –∏ –ø–æ–π–º–∏ —Ç–µ–∫—É—â—É—é —Å–∏—Ç—É–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',
        '–û–ø–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–æ –∫–∞–∫ —Ä–µ—à–∏—à—å –µ–≥–æ –∑–∞–¥–∞—á—É/–Ω–∞–∑–æ–≤–∏ –Ω–∞—à–∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞, –ø—Ä–µ–¥–ª–æ–∂–∏ —Ç–æ–≤–∞—Ä—ã –ø–æ –∑–∞–ø—Ä–æ—Å—É',
        '–í–µ–¥–∏ –∫–ª–∏–µ–Ω—Ç–∞ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é –∑–∞–∫–∞–∑–∞/–∑–∞—è–≤–∫–∏',
        '–ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –≥–æ—Ç–æ–≤ –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑, —Å–¥–µ–ª–∞–π –∏—Ç–æ–≥ –∑–∞–∫–∞–∑–∞ –∏ –ø—Ä–∏—à–ª–∏ —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π.',
        '–ü–µ—Ä–µ–≤–µ–¥–∏ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–ø–ª–∞—Ç—ã –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã'
      ],
      
      // –®–∞–≥ 4: –û–±—É—á–µ–Ω–∏–µ
      knowledgeItems: [],
      selectedKnowledgeType: '',
      knowledgeInputValue: ''
    };
  };

  const [setupData, setSetupData] = useState<{
    task: string;
    mainGoal: string;
    mainGoalCustom: string;
    salesCycle: string;
    targetAudience: string;
    addressing: string;
    communicationStyle: string;
    restrictions: string[];
    restrictionsCustom: string;
    additionalSettings: string[];
    additionalSettingsCustom: string;
    dataCollection: string[];
    dataCollectionCustom: string;
    clarificationRules: string[];
    clarificationRulesCustom: string;
    emojiUsage: string;
    dialogStages: string[];
    knowledgeItems: any[];
    selectedKnowledgeType: string;
    knowledgeInputValue: string;
  }>(getInitialSetupData());
  
  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ localStorage –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ setupData
  useEffect(() => {
    if (setupData) {
      localStorage.setItem('setupData', JSON.stringify(setupData));
    }
  }, [setupData]);
  
  const [showLoadingScreen, setShowLoadingScreen] = useState(false);
  const [loadingTime, setLoadingTime] = useState(300); // 5 –º–∏–Ω—É—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
  const [showDialogWarning, setShowDialogWarning] = useState(false);
  const [originalDialogStages] = useState([
    '–ü–æ–∑–¥–æ—Ä–æ–≤–∞–π—Å—è –∏ —Å–ø—Ä–æ—Å–∏ –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞. –£—Ç–æ—á–Ω–∏ –µ–≥–æ –ø—Ä–æ–±–ª–µ–º—É –∏ –ø–æ–π–º–∏ —Ç–µ–∫—É—â—É—é —Å–∏—Ç—É–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',
    '–û–ø–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–æ –∫–∞–∫ —Ä–µ—à–∏—à—å –µ–≥–æ –∑–∞–¥–∞—á—É/–Ω–∞–∑–æ–≤–∏ –Ω–∞—à–∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞, –ø—Ä–µ–¥–ª–æ–∂–∏ —Ç–æ–≤–∞—Ä—ã –ø–æ –∑–∞–ø—Ä–æ—Å—É',
    '–í–µ–¥–∏ –∫–ª–∏–µ–Ω—Ç–∞ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é –∑–∞–∫–∞–∑–∞/–∑–∞—è–≤–∫–∏',
    '–ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –≥–æ—Ç–æ–≤ –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑, —Å–¥–µ–ª–∞–π –∏—Ç–æ–≥ –∑–∞–∫–∞–∑–∞ –∏ –ø—Ä–∏—à–ª–∏ —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π.',
    '–ü–µ—Ä–µ–≤–µ–¥–∏ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–ø–ª–∞—Ç—ã –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã'
  ]);
  const [validationErrors, setValidationErrors] = useState<{[key: string]: boolean}>({});
  const [showValidationMessage, setShowValidationMessage] = useState(false);
  
  // –§—É–Ω–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
  const validateStep = (step: number) => {
    const errors: {[key: string]: boolean} = {};
    
    if (step === 1) {
      if (!setupData.task) errors.task = true;
      if (!setupData.mainGoal) errors.mainGoal = true;
      if (setupData.mainGoal === '–î—Ä—É–≥–æ–µ' && !setupData.mainGoalCustom.trim()) errors.mainGoalCustom = true;
      if (!setupData.salesCycle.trim()) errors.salesCycle = true;
      if (!setupData.targetAudience.trim()) errors.targetAudience = true;
    }
    
    if (step === 2) {
      // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è —à–∞–≥–∞ 2
      if (setupData.restrictions.length === 0 && !setupData.restrictionsCustom?.trim()) errors.restrictions = true;
      if (setupData.additionalSettings.length === 0 && !setupData.additionalSettingsCustom?.trim()) errors.additionalSettings = true;
      // –î–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö - –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —á—Ç–æ-—Ç–æ –≤—ã–±—Ä–∞–Ω–æ
      if (setupData.dataCollection.length === 0 && !setupData.dataCollectionCustom?.trim()) errors.dataCollection = true;
      if (setupData.clarificationRules.length === 0 && !setupData.clarificationRulesCustom?.trim()) errors.clarificationRules = true;
    }
    
    if (step === 4) {
      if (setupData.knowledgeItems.length === 0) errors.knowledgeItems = true;
    }
    
    setValidationErrors(errors);
    setShowValidationMessage(Object.keys(errors).length > 0);
    return Object.keys(errors).length === 0;
  };
  
  const [progressTasks, setProgressTasks] = useState([
    { id: 1, title: '–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–¥–µ–ª–∏', completed: false, description: '–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–≤–æ–µ–≥–æ Adapto –ø–æ–¥ —Å–≤–æ—é –∫–æ–º–ø–∞–Ω–∏—é' },
    { id: 2, title: '–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Adapto', completed: false, description: '–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–ú–æ–π Adapto" –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫ Adapto –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã' },
    { id: 3, title: '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ò–ò-–∞–≥–µ–Ω—Ç–∞', completed: false, description: '–ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ –ò–ò-–∞–≥–µ–Ω—Ç–∞ –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –∏–ª–∏ –Ω–∞ —Å–∞–π—Ç' }
  ]);

  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
  useEffect(() => {
    const updatedTasks = [...progressTasks];
    
    // –ó–∞–¥–∞—á–∞ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–¥–µ–ª–∏ - –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ setupData
    const hasModelSettings = !!(setupData.task && setupData.mainGoal && setupData.targetAudience);
    updatedTasks[0].completed = hasModelSettings;
    
    // –ó–∞–¥–∞—á–∞ 2: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å - –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –µ—Å–ª–∏ –±—ã–ª –≤ —Ä–∞–∑–¥–µ–ª–µ "–ú–æ–π Adapto" –∏ –µ—Å—Ç—å —á–∞—Ç
    const hasTested = chatHistory.length > 1;
    updatedTasks[1].completed = hasTested;
    
    // –ó–∞–¥–∞—á–∞ 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è - –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –µ—Å–ª–∏ –µ—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
    const hasIntegration = setupData.knowledgeItems.length > 0;
    updatedTasks[2].completed = hasIntegration;
    
    setProgressTasks(updatedTasks);
  }, [setupData, chatHistory]);

  const showNotificationMessage = (message: string) => {
    setNotificationMessage(message)
    setShowNotification(true)
    setTimeout(() => setShowNotification(false), 3000)
  }

  const handleKbTypeSelect = (type: 'site' | 'feed' | 'text' | 'file') => {
    setSelectedKbType(type)
    setKbInputValue('')
  }



  const handleLogout = () => {
    // –û—á–∏—â–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
    localStorage.removeItem('authToken');
    localStorage.removeItem('userId');
    localStorage.removeItem('userData');
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    setCurrentUser(null);
    setIsLoggedIn(false);
    setCurrentStep('login');
  }

  const handleLogin = () => {
    setIsLoggedIn(true)
    setCurrentStep('dashboard')
  }

  const handleRegister = () => {
    setCurrentStep('register-email')
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhoneNumber = (value: string) => {
    // –£–±–∏—Ä–∞–µ–º –≤—Å–µ –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä
    const numbers = value.replace(/\D/g, '');
    
    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–æ 10 —Ü–∏—Ñ—Ä (–±–µ–∑ –∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω—ã)
    const limitedNumbers = numbers.slice(0, 10);
    
    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º: (999) 123-45-67
    if (limitedNumbers.length >= 3) {
      return `(${limitedNumbers.slice(0, 3)}) ${limitedNumbers.slice(3, 6)}-${limitedNumbers.slice(6, 8)}-${limitedNumbers.slice(8)}`;
    } else if (limitedNumbers.length >= 1) {
      return `(${limitedNumbers}`;
    }
    
    return '';
  }

  const handleRegisterStep = (step: 'register-email' | 'register-name' | 'register-phone' | 'register-company' | 'dashboard') => {
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º
    if (step === 'register-name') {
      const errors: any = {};
      
      // –í–∞–ª–∏–¥–∞—Ü–∏—è email
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!formData.email) {
        errors.email = 'Email –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω';
      } else if (!emailRegex.test(formData.email)) {
        errors.email = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email';
      }
      
      // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è
      if (!formData.password) {
        errors.password = '–ü–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω';
      } else if (formData.password.length < 6) {
        errors.password = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤';
      }
      
      if (Object.keys(errors).length > 0) {
        setFormErrors(errors);
        return;
      }
    }
    
    if (step === 'register-company') {
      const errors: any = {};
      
      // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
      const phoneNumbers = formData.phone.replace(/\D/g, '');
      if (!formData.phone) {
        errors.phone = '–¢–µ–ª–µ—Ñ–æ–Ω –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω';
      } else if (phoneNumbers.length < 10) {
        errors.phone = '–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (10 —Ü–∏—Ñ—Ä)';
      }
      
      if (Object.keys(errors).length > 0) {
        setFormErrors(errors);
        return;
      }
    }
    
    setFormErrors({});
    setCurrentStep(step);
    
    if (step === 'dashboard') {
      setIsLoggedIn(true);
      setShowSuccessModal(true);
    }
  }

  const handleSaveSettings = () => {
    showNotificationMessage('–£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ')
  }

  const handleSendMessage = async () => {
    if (chatMessage.trim()) {
      const newMessage = {
        type: 'user' as const,
        text: chatMessage
      };
      setChatHistory([...chatHistory, newMessage]);
      setChatMessage('');
      
      try {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ OpenAI API
        const response = await fetch('/api/chat', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
                  body: JSON.stringify({
          message: chatMessage,
          setupData: setupData,
          conversationHistory: chatHistory,
          agentId: 'test-agent-1' // –î–æ–±–∞–≤–ª—è–µ–º ID –∞–≥–µ–Ω—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        }),
        });

        if (!response.ok) {
          throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞');
        }

        const data = await response.json();
        
        if (data.error) {
          throw new Error(data.error);
        }

        const aiResponse = {
          type: 'assistant' as const,
          text: data.response
        };
        setChatHistory(prev => [...prev, aiResponse]);
      } catch (error) {
        console.error('Error sending message:', error);
        const errorResponse = {
          type: 'assistant' as const,
          text: '–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.'
        };
        setChatHistory(prev => [...prev, errorResponse]);
      }
    }
  }

  // API —Ñ—É–Ω–∫—Ü–∏–∏
  const apiRequest = async (endpoint: string, options: RequestInit = {}) => {
    const token = localStorage.getItem('authToken');
    const headers = {
      'Content-Type': 'application/json',
      ...(token && { Authorization: `Bearer ${token}` }),
      ...options.headers,
    };

    try {
      const response = await fetch(`${API_BASE_URL}${endpoint}`, {
        ...options,
        headers,
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || 'API –æ—à–∏–±–∫–∞');
      }

      return await response.json();
    } catch (error) {
      console.error('API Error:', error);
      throw error;
    }
  };

  const handleLoginSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setFormErrors({});

    if (!formData.email || !formData.password) {
      setFormErrors({ general: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è' });
      return;
    }

    if (formData.password.length < 6) {
      setFormErrors({ password: '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤' });
      return;
    }

    try {
      const response = await fetch(`${API_BASE_URL}/auth/login`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          email: formData.email,
          password: formData.password,
        }),
      });

      const data = await response.json();

      if (response.ok) {
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞
        const userData = {
          name: data.user.name || data.user.email?.split('@')[0] || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
          company_name: data.user.company_name || '–ö–æ–º–ø–∞–Ω–∏—è',
          email: data.user.email,
          id: data.user.id
        };
        
        // –°–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
        localStorage.setItem('authToken', data.session.access_token);
        localStorage.setItem('userId', data.user.id);
        localStorage.setItem('userData', JSON.stringify(userData));
        
        // –ó–∞—Ç–µ–º —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        setCurrentUser(userData);
        setIsLoggedIn(true);
        setCurrentStep('dashboard');
        setShowProgressBar(true);
        showNotificationMessage('–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Adapto!');
      } else {
        if (data.error === '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å') {
          setFormErrors({ 
            email: '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å',
            password: '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å'
          });
        } else if (data.details) {
          const errors: any = {};
          data.details.forEach((detail: any) => {
            errors[detail.field] = detail.message;
          });
          setFormErrors(errors);
        } else {
          setFormErrors({ general: data.error || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞' });
        }
        showNotificationMessage('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å.');
      }
    } catch (error) {
      console.error('Login error:', error);
      showNotificationMessage('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É');
    }
  };

  const handleRegisterSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setFormErrors({});

    try {
      const response = await fetch(`${API_BASE_URL}/auth/register`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          email: formData.email,
          password: formData.password,
          name: formData.name,
          company_name: formData.company,
          phone: countryCode + ' ' + formData.phone,
          company_field: formData.companyField,
        }),
      });

      const data = await response.json();

      if (response.ok) {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const userData = {
          name: formData.name,
          company_name: formData.company,
          email: formData.email,
          id: data.user.id
        };
        
        console.log('Saving user data:', userData);
        console.log('Form data company:', formData.company);
        
        // –°–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
        localStorage.setItem('authToken', data.session.access_token);
        localStorage.setItem('userId', data.user.id);
        localStorage.setItem('userData', JSON.stringify(userData));
        
        console.log('Saved to localStorage:', localStorage.getItem('userData'));
        
        // –ó–∞—Ç–µ–º —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        setCurrentUser(userData);
        setIsLoggedIn(true);
        setCurrentStep('dashboard');
        setShowProgressBar(true);
        showNotificationMessage('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Adapto!');
        
        // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
        setFormData({
          email: '',
          password: '',
          name: '',
          company: '',
          phone: '',
          companyField: ''
        });
      } else {
        if (data.error === 'Email already exists' || data.error === '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç') {
          setFormErrors({ email: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' });
          showNotificationMessage('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
        } else if (data.details) {
          const errors: any = {};
          data.details.forEach((detail: any) => {
            errors[detail.field] = detail.message;
          });
          setFormErrors(errors);
          showNotificationMessage('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ.');
        } else {
          setFormErrors({ general: data.error || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏' });
          showNotificationMessage('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ.');
        }
      }
    } catch (error) {
      console.error('Register error:', error);
      showNotificationMessage('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É');
    }
  };

  const handleKbSubmit = async () => {
    if (!kbInputValue.trim() || !selectedKbType) return;

    const newItem = {
      id: Date.now(),
      type: selectedKbType,
      title: kbInputValue,
      status: '–û–±—Ä–∞–±–æ—Ç–∫–∞' as const
    };

    // –î–æ–±–∞–≤–ª—è–µ–º –≤ setupData –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    setSetupData(prev => ({
      ...prev,
      knowledgeItems: [...prev.knowledgeItems, {
        type: selectedKbType,
        content: kbInputValue
      }]
    }));

    setKbItems(prev => [...prev, newItem]);
    setKbModalOpen(false);
    setSelectedKbType(null);
    setKbInputValue('');

    try {
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ GigaChat –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
      const response = await fetch(`${API_BASE_URL}/knowledge`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          action: 'add',
          type: selectedKbType,
          content: kbInputValue,
          agentId: 'test-agent-1'
        }),
      });

      if (response.ok) {
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ "–ó–∞–≥—Ä—É–∂–µ–Ω"
        setKbItems(prev => prev.map(item => 
          item.id === newItem.id 
            ? { ...item, status: '–ó–∞–≥—Ä—É–∂–µ–Ω' as const }
            : item
        ));
        showNotificationMessage('–≠–ª–µ–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∏ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π');
      } else {
        showNotificationMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —ç–ª–µ–º–µ–Ω—Ç–∞');
      }
    } catch (error) {
      console.error('Error processing knowledge item:', error);
      showNotificationMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —ç–ª–µ–º–µ–Ω—Ç–∞');
    }
  };

  const handleBotCorrection = async () => {
    if (!botCorrection.trim()) return;

    try {
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ GigaChat –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
      const response = await fetch(`${API_BASE_URL}/knowledge`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          action: 'correction',
          content: botCorrection,
          agentId: 'test-agent-1'
        }),
      });

      if (response.ok) {
        // –î–æ–±–∞–≤–ª—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ setupData –∫–∞–∫ —á–∞—Å—Ç—å –∑–Ω–∞–Ω–∏–π
        setSetupData(prev => ({
          ...prev,
          knowledgeItems: [...prev.knowledgeItems, {
            type: 'correction',
            content: `–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è –±–æ—Ç–∞: ${botCorrection}`
          }]
        }));

        setBotCorrection('');
        showNotificationMessage('–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ! –ë–æ—Ç –±—É–¥–µ—Ç —É—á–∏—Ç—ã–≤–∞—Ç—å —ç—Ç–æ –≤ –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –æ—Ç–≤–µ—Ç–∞—Ö.');
      } else {
        showNotificationMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è');
      }
    } catch (error) {
      console.error('Error applying bot correction:', error);
      showNotificationMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è');
    }
  };

  const handleAddDialogStage = () => {
    if (newStageName.trim()) {
      const newStage = {
        id: Date.now(),
        name: newStageName,
        order: dialogStages.length + 1
      };
      setDialogStages([...dialogStages, newStage]);
      setNewStageName('');
      setShowAddStage(false);
    }
  };

  const handleDeleteDialogStage = (id: number) => {
    setDialogStages(dialogStages.filter(stage => stage.id !== id));
  };

  const handleEditDialogStage = (id: number, newName: string) => {
    setDialogStages(dialogStages.map(stage => 
      stage.id === id ? { ...stage, name: newName } : stage
    ));
  };

  const handleTestAdapto = () => {
    setCurrentSection('my-adapto');
  };

  const handleProgressTaskClick = (taskId: number) => {
    setProgressTasks(prev => prev.map(task => 
      task.id === taskId ? { ...task, completed: !task.completed } : task
    ));
  };

  const handleProgressTaskAction = (taskId: number) => {
    switch (taskId) {
      case 1:
        setCurrentSection('knowledge');
        setActiveSection('knowledge');
        localStorage.setItem('currentSection', 'knowledge');
        break;
      case 2:
        setCurrentSection('model-settings');
        setActiveSection('model-settings');
        localStorage.setItem('currentSection', 'model-settings');
        // –û—Ç–º–µ—á–∞–µ–º –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é –ø—Ä–∏ –ø–æ—Å–µ—â–µ–Ω–∏–∏
        setProgressTasks(prev => prev.map(task => 
          task.id === taskId ? { ...task, completed: true } : task
        ));
        break;
      case 3:
        setCurrentSection('my-adapto');
        setActiveSection('my-adapto');
        localStorage.setItem('currentSection', 'my-adapto');
        // –û—Ç–º–µ—á–∞–µ–º –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é –ø—Ä–∏ –ø–æ—Å–µ—â–µ–Ω–∏–∏
        setProgressTasks(prev => prev.map(task => 
          task.id === taskId ? { ...task, completed: true } : task
        ));
        break;
      case 4:
        showNotificationMessage('Adapto –∑–∞–ø—É—â–µ–Ω! üöÄ');
        setProgressTasks(prev => prev.map(task => 
          task.id === taskId ? { ...task, completed: true } : task
        ));
        break;
    }
  };

  const handleIntegrationClick = (integration: string) => {
    if (integration === 'widget') {
      setShowWidgetConstructor(true);
    } else {
      setSelectedIntegration(integration);
      setShowIntegrationModal(true);
    }
  };

  if (!isLoggedIn && currentStep !== 'dashboard') {
    return (
      <div className="min-h-screen bg-[#121212] flex flex-col lg:flex-row">
        {/* –õ–æ–≥–æ—Ç–∏–ø */}
        <div className="absolute top-11 left-1/2 transform -translate-x-1/2 z-10">
          <div className="w-[109px] h-6 flex items-center">
            <div className="w-[87px] h-[23px] flex items-center">
              <div className="w-[17px] h-[18px] bg-white rounded-sm"></div>
              <div className="w-[13px] h-[18px] bg-white ml-0.5"></div>
              <div className="w-[12px] h-[14px] bg-white ml-0.5"></div>
              <div className="w-[13px] h-[18px] bg-white ml-0.5"></div>
              <div className="w-[10px] h-[17px] bg-white ml-0.5"></div>
              <div className="w-[13px] h-[14px] bg-white ml-0.5"></div>
            </div>
            <div className="w-[19px] h-[19px] bg-gradient-to-br from-[#5BE5F7] to-[#4576EE] rounded-sm ml-2"></div>
          </div>
        </div>

        {/* –õ–µ–≤–∞—è —á–∞—Å—Ç—å - —Ñ–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ */}
        <div className="w-full lg:w-1/2 flex items-center justify-center relative min-h-screen lg:min-h-0">
          <div className="w-full max-w-[440px] px-5 pt-20 lg:pt-0">
            <h1 className="text-white text-[24px] lg:text-[30px] font-semibold text-center mb-12 lg:mb-16">–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º!</h1>
            
            <form onSubmit={handleLoginSubmit} className="space-y-6">
              {formErrors.general && (
                <div className="bg-red-500/20 border border-red-500/50 text-red-400 px-4 py-3 rounded-lg text-sm">
                  {formErrors.general}
                </div>
              )}
              
              <div>
                <label className="block text-white text-[14px] font-semibold mb-2">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</label>
                <input 
                  type="email" 
                  className={`w-full h-12 bg-white/20 border border-white rounded-[10px] px-5 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent ${
                    formErrors.email ? 'border-red-400 bg-red-500/20' : ''
                  }`}
                  placeholder="yapochta@yandex.ru"
                  value={formData.email}
                  onChange={(e) => setFormData({...formData, email: e.target.value})}
                />
                {formErrors.email && (
                  <p className="text-red-400 text-xs mt-1">{formErrors.email}</p>
                )}
              </div>
              
              <div>
                <label className="block text-white text-[14px] font-semibold mb-2">–ü–∞—Ä–æ–ª—å</label>
                <input 
                  type="password" 
                  className={`w-full h-12 bg-white/20 border border-white rounded-[10px] px-5 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent ${
                    formErrors.password ? 'border-red-400 bg-red-500/20' : ''
                  }`}
                  placeholder="**********"
                  value={formData.password}
                  onChange={(e) => setFormData({...formData, password: e.target.value})}
                />
                {formErrors.password && (
                  <p className="text-red-400 text-xs mt-1">{formErrors.password}</p>
                )}
                <div className="flex justify-end mt-2">
                  <button 
                    type="button"
                    onClick={() => setCurrentStep('forgot-password')}
                    className="text-[#096EFD] text-[14px] font-medium hover:text-blue-400 transition-colors"
                  >
                    –°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å
                  </button>
                </div>
              </div>
              
              <button 
                type="submit"
                className="w-full h-12 bg-gradient-to-r from-[#52AEFF] to-[#096EFD] text-white text-[16px] font-semibold rounded-[10px] hover:opacity-90 transition-opacity"
              >
                –í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç
              </button>
              
              <div className="text-center">
                <button 
                  type="button"
                  onClick={handleRegister}
                  className="text-white text-[14px] font-medium hover:text-gray-300 transition-colors"
                >
                  –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç
                </button>
              </div>
            </form>
          </div>
        </div>

        {/* –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å —Ü–∏—Ç–∞—Ç–æ–π */}
        <div className="w-full lg:w-1/2 relative min-h-[300px] lg:min-h-screen">
          <div className="absolute inset-0 bg-cover bg-center" style={{backgroundImage: 'url(/images/v23_6824.png)'}}></div>
          <div className="absolute inset-0 bg-black/20"></div>
          <div className="absolute inset-0 flex flex-col items-center justify-center text-center px-8 py-12">
            <p className="text-white text-[20px] lg:text-[30px] font-semibold mb-4 max-w-[575px]">
              –í –±—ã—Å—Ç—Ä–æ–º–µ–Ω—è—é—â–µ–º—Å—è –º–∏—Ä–µ —Å–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ ‚Äì —ç—Ç–æ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏.
            </p>
            <p className="text-white/80 text-[14px] lg:text-[16px] font-medium">
              –ò–ª–æ–Ω –ú–∞—Å–∫, –æ—Å–Ω–æ–≤–∞—Ç–µ–ª—å xAI
            </p>
          </div>
        </div>
      </div>
    )
  } else {
    return (
      <div className="min-h-screen bg-gray-50">
        {currentStep === 'register-email' && (
          <div className="w-full max-w-md">
            <div className="text-center mb-8">
              <div className="flex items-center justify-center gap-2 mb-4">
                <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                  <div className="w-2 h-2 bg-white rounded-full"></div>
                </div>
                <span className="text-xl font-semibold">Adapto</span>
              </div>
              <h1 className="text-2xl font-bold mb-2">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ Adapto –±–µ—Å–ø–ª–∞—Ç–Ω–æ</h1>
              <p className="text-gray-600">–£–∫–∞–∂–∏—Ç–µ –ø–æ—á—Ç—É –∏ –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞ –≤ Adapto</p>
            </div>
            <div className="bg-white rounded-xl p-8 shadow-sm">
              <form onSubmit={(e) => { e.preventDefault(); handleRegisterStep('register-name'); }} className="space-y-4">
                {formErrors.general && (
                  <div className="bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg text-sm">
                    {formErrors.general}
                  </div>
                )}
                
                <div>
                  <label className="block text-sm font-medium mb-2">Email</label>
                  <input 
                    type="email" 
                    required
                    className={`w-full h-12 border rounded-lg px-4 focus:outline-none focus:ring-2 focus:ring-blue-500 ${
                      formErrors.email ? 'border-red-300 bg-red-50' : 'border-gray-300'
                    }`}
                    placeholder="your@email.com"
                    value={formData.email}
                    onChange={(e) => {
                      setFormData({...formData, email: e.target.value});
                      if (formErrors.email) setFormErrors({...formErrors, email: null});
                    }}
                  />
                  {formErrors.email && (
                    <p className="text-red-500 text-xs mt-1">{formErrors.email}</p>
                  )}
                </div>
                
                <div>
                  <label className="block text-sm font-medium mb-2">–ü–∞—Ä–æ–ª—å</label>
                  <input 
                    type="password" 
                    required
                    minLength={6}
                    className={`w-full h-12 border rounded-lg px-4 focus:outline-none focus:ring-2 focus:ring-blue-500 ${
                      formErrors.password ? 'border-red-300 bg-red-50' : 'border-gray-300'
                    }`}
                    placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤"
                    value={formData.password}
                    onChange={(e) => {
                      setFormData({...formData, password: e.target.value});
                      if (formErrors.password) setFormErrors({...formErrors, password: null});
                    }}
                  />
                  {formErrors.password && (
                    <p className="text-red-500 text-xs mt-1">{formErrors.password}</p>
                  )}
                </div>
                
                <button 
                  type="submit"
                  className="w-full h-12 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors"
                >
                  –î–∞–ª–µ–µ
                </button>
                <p className="text-xs text-gray-500 text-center">
                  –ù–∞–∂–∏–º–∞—è "–î–∞–ª–µ–µ", –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å —É—Å–ª–æ–≤–∏—è–º–∏ <span className="text-gray-700 underline">–û—Ñ–µ—Ä—Ç—ã</span> –∏ –¥–∞–µ—Ç–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å <span className="text-gray-700 underline">–ü–æ–ª–∏—Ç–∏–∫–æ–π –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</span>
                </p>
              </form>
            </div>
          </div>
        )}

        {currentStep === 'register-name' && (
          <div className="w-full max-w-md">
            <div className="text-center mb-8">
              <div className="flex items-center justify-center gap-2 mb-4">
                <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                  <div className="w-2 h-2 bg-white rounded-full"></div>
                </div>
                <span className="text-xl font-semibold">Adapto</span>
              </div>
              <h1 className="text-2xl font-bold mb-2">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Adapto</h1>
              <p className="text-gray-600">–£–∫–∞–∂–∏—Ç–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, —á—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Adapto –ø–æ–¥ –≤–∞—à –±–∏–∑–Ω–µ—Å</p>
            </div>
            <div className="bg-white rounded-xl p-8 shadow-sm">
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium mb-2">–ò–º—è</label>
                  <Input 
                    type="text" 
                    className="h-12"
                    placeholder="–í–∞—à–µ –∏–º—è"
                    value={formData.name}
                    onChange={(e) => setFormData({...formData, name: e.target.value})}
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</label>
                  <Input 
                    type="text" 
                    className="h-12"
                    placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏"
                    value={formData.company}
                    onChange={(e) => setFormData({...formData, company: e.target.value})}
                  />
                </div>
                <Button 
                  onClick={() => handleRegisterStep('register-phone')}
                  className="w-full h-12"
                >
                  –î–∞–ª–µ–µ
                </Button>
              </div>
            </div>
          </div>
        )}

        {currentStep === 'register-phone' && (
          <div className="w-full max-w-md">
            <div className="text-center mb-8">
              <div className="flex items-center justify-center gap-2 mb-4">
                <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                  <div className="w-2 h-2 bg-white rounded-full"></div>
                </div>
                <span className="text-xl font-semibold">Adapto</span>
              </div>
              <h1 className="text-2xl font-bold mb-2">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h1>
              <p className="text-gray-600">–£–∫–∞–∂–∏—Ç–µ –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è —Å–≤—è–∑–∏</p>
            </div>
            <div className="bg-white rounded-xl p-8 shadow-sm">
              <form onSubmit={(e) => { e.preventDefault(); handleRegisterStep('register-company'); }} className="space-y-4">
                <div>
                  <label className="block text-sm font-medium mb-2">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                  <div className="flex gap-2">
                    <select 
                      value={countryCode}
                      onChange={(e) => setCountryCode(e.target.value)}
                      className="w-24 h-12 border border-gray-300 rounded-lg px-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                      <option value="+7">+7</option>
                      <option value="+1">+1</option>
                      <option value="+44">+44</option>
                      <option value="+49">+49</option>
                      <option value="+33">+33</option>
                      <option value="+39">+39</option>
                      <option value="+34">+34</option>
                      <option value="+81">+81</option>
                      <option value="+86">+86</option>
                      <option value="+91">+91</option>
                    </select>
                    <Input 
                      type="tel" 
                      required
                      className={`flex-1 h-12 ${
                        formErrors.phone ? 'border-red-300 bg-red-50' : ''
                      }`}
                      placeholder="(999) 123-45-67"
                      value={formData.phone}
                      onChange={(e) => {
                        const formatted = formatPhoneNumber(e.target.value);
                        setFormData({...formData, phone: formatted});
                        if (formErrors.phone) setFormErrors({...formErrors, phone: null});
                      }}
                    />
                  </div>
                  {formErrors.phone && (
                    <p className="text-red-500 text-xs mt-1">{formErrors.phone}</p>
                  )}
                  <p className="text-xs text-gray-500 mt-1">–í–≤–µ–¥–∏—Ç–µ —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
                </div>
                <Button 
                  type="submit"
                  className="w-full h-12"
                >
                  –î–∞–ª–µ–µ
                </Button>
              </form>
            </div>
          </div>
        )}

        {currentStep === 'register-company' && (
          <div className="w-full max-w-md">
            <div className="text-center mb-8">
              <div className="flex items-center justify-center gap-2 mb-4">
                <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                  <div className="w-2 h-2 bg-white rounded-full"></div>
                </div>
                <span className="text-xl font-semibold">Adapto</span>
              </div>
              <h1 className="text-2xl font-bold mb-2">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Adapto</h1>
              <p className="text-gray-600">–£–∫–∞–∂–∏—Ç–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, —á—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Adapto –ø–æ–¥ –≤–∞—à –±–∏–∑–Ω–µ—Å</p>
            </div>
            <div className="bg-white rounded-xl p-8 shadow-sm">
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium mb-2">–í –∫–∞–∫–æ–π —Å—Ñ–µ—Ä–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–∞—à–∞ –∫–æ–º–ø–∞–Ω–∏—è?</label>
                  <Input 
                    type="text" 
                    className="h-12"
                    placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—Ñ–µ—Ä—É –∫–æ–º–ø–∞–Ω–∏–∏"
                    value={formData.companyField}
                    onChange={(e) => setFormData({...formData, companyField: e.target.value})}
                  />
                </div>
                <Button 
                  onClick={handleRegisterSubmit}
                  className="w-full h-12"
                >
                  –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
                </Button>
              </div>
            </div>
          </div>
        )}

        {currentStep === 'forgot-password' && (
          <div className="w-full max-w-md">
            <div className="text-center mb-8">
              <div className="flex items-center justify-center gap-2 mb-4">
                <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                  <div className="w-2 h-2 bg-white rounded-full"></div>
                </div>
                <span className="text-xl font-semibold">Adapto</span>
              </div>
              <h1 className="text-2xl font-bold mb-2">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è</h1>
              <p className="text-gray-600">–í–≤–µ–¥–∏—Ç–µ email –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è</p>
            </div>
            <div className="bg-white rounded-xl p-8 shadow-sm">
              <form onSubmit={(e) => { e.preventDefault(); setCurrentStep('reset-password'); }} className="space-y-4">
                <div>
                  <label className="block text-sm font-medium mb-2">Email</label>
                  <Input 
                    type="email" 
                    required
                    className="h-12"
                    placeholder="your@email.com"
                    value={formData.email}
                    onChange={(e) => setFormData({...formData, email: e.target.value})}
                  />
                </div>
                <Button 
                  type="submit"
                  className="w-full h-12"
                >
                  –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É
                </Button>
                <div className="text-center">
                  <button 
                    type="button"
                    onClick={() => setCurrentStep('login')}
                    className="text-blue-600 hover:text-blue-700 text-sm"
                  >
                    –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≤—Ö–æ–¥—É
                  </button>
                </div>
              </form>
            </div>
          </div>
        )}

        {currentStep === 'reset-password' && (
          <div className="w-full max-w-md">
            <div className="text-center mb-8">
              <div className="flex items-center justify-center gap-2 mb-4">
                <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                  <div className="w-2 h-2 bg-white rounded-full"></div>
                </div>
                <span className="text-xl font-semibold">Adapto</span>
              </div>
              <h1 className="text-2xl font-bold mb-2">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É</h1>
              <p className="text-gray-600">–ù–∞ –≤–∞—à—É –ø–æ—á—Ç—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è</p>
            </div>
            <div className="bg-white rounded-xl p-8 shadow-sm text-center">
              <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <div className="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                  <span className="text-white text-xl">‚úì</span>
                </div>
              </div>
              <h3 className="text-lg font-semibold mb-2">–°—Å—ã–ª–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h3>
              <p className="text-gray-600 mb-6">
                –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –≤ –ø–∏—Å—å–º–µ, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
              </p>
              <button 
                onClick={() => setCurrentStep('login')}
                className="w-full h-12 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors"
              >
                –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≤—Ö–æ–¥—É
              </button>
            </div>
          </div>
        )}
      </div>
    )
  } else {
    return (
      <div className="min-h-screen bg-gray-50">
        {currentStep === 'register-email' && (
          <div className="w-full max-w-md mx-auto pt-20">
            <div className="text-center mb-8">
              <div className="flex items-center justify-center gap-2 mb-4">
                <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                  <div className="w-2 h-2 bg-white rounded-full"></div>
                </div>
                <span className="text-xl font-semibold">Adapto</span>
              </div>
              <h1 className="text-2xl font-bold mb-2">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ Adapto –±–µ—Å–ø–ª–∞—Ç–Ω–æ</h1>
              <p className="text-gray-600">–£–∫–∞–∂–∏—Ç–µ –ø–æ—á—Ç—É –∏ –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞ –≤ Adapto</p>
            </div>
            <div className="bg-white rounded-xl p-8 shadow-sm">
              <form onSubmit={(e) => { e.preventDefault(); handleRegisterStep('register-name'); }} className="space-y-4">
                {formErrors.general && (
                  <div className="bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg text-sm">
                    {formErrors.general}
                  </div>
                )}
                
                <div>
                  <label className="block text-sm font-medium mb-2">Email</label>
                  <input 
                    type="email" 
                    required
                    className={`w-full h-12 border rounded-lg px-4 focus:outline-none focus:ring-2 focus:ring-blue-500 ${
                      formErrors.email ? 'border-red-300 bg-red-50' : 'border-gray-300'
                    }`}
                    placeholder="your@email.com"
                    value={formData.email}
                    onChange={(e) => {
                      setFormData({...formData, email: e.target.value});
                      if (formErrors.email) setFormErrors({...formErrors, email: null});
                    }}
                  />
                  {formErrors.email && (
                    <p className="text-red-500 text-xs mt-1">{formErrors.email}</p>
                  )}
                </div>
                
                <div>
                  <label className="block text-sm font-medium mb-2">–ü–∞—Ä–æ–ª—å</label>
                  <input 
                    type="password" 
                    required
                    minLength={6}
                    className={`w-full h-12 border rounded-lg px-4 focus:outline-none focus:ring-2 focus:ring-blue-500 ${
                      formErrors.password ? 'border-red-300 bg-red-50' : 'border-gray-300'
                    }`}
                    placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤"
                    value={formData.password}
                    onChange={(e) => {
                      setFormData({...formData, password: e.target.value});
                      if (formErrors.password) setFormErrors({...formErrors, password: null});
                    }}
                  />
                  {formErrors.password && (
                    <p className="text-red-500 text-xs mt-1">{formErrors.password}</p>
                  )}
                </div>
                
                <button 
                  type="submit"
                  className="w-full h-12 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors"
                >
                  –î–∞–ª–µ–µ
                </button>
                <p className="text-xs text-gray-500 text-center">
                  –ù–∞–∂–∏–º–∞—è "–î–∞–ª–µ–µ", –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å —É—Å–ª–æ–≤–∏—è–º–∏ <span className="text-gray-700 underline">–û—Ñ–µ—Ä—Ç—ã</span> –∏ –¥–∞–µ—Ç–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å <span className="text-gray-700 underline">–ü–æ–ª–∏—Ç–∏–∫–æ–π –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</span>
                </p>
              </form>
            </div>
          </div>
        )}

        {currentStep === 'register-name' && (
          <div className="w-full max-w-md mx-auto pt-20">
            <div className="text-center mb-8">
              <div className="flex items-center justify-center gap-2 mb-4">
                <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                  <div className="w-2 h-2 bg-white rounded-full"></div>
                </div>
                <span className="text-xl font-semibold">Adapto</span>
              </div>
              <h1 className="text-2xl font-bold mb-2">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Adapto</h1>
              <p className="text-gray-600">–£–∫–∞–∂–∏—Ç–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, —á—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Adapto –ø–æ–¥ –≤–∞—à –±–∏–∑–Ω–µ—Å</p>
            </div>
            <div className="bg-white rounded-xl p-8 shadow-sm">
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium mb-2">–ò–º—è</label>
                  <input 
                    type="text" 
                    className="w-full h-12 border border-gray-300 rounded-lg px-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="–í–∞—à–µ –∏–º—è"
                    value={formData.name}
                    onChange={(e) => setFormData({...formData, name: e.target.value})}
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</label>
                  <input 
                    type="text" 
                    className="w-full h-12 border border-gray-300 rounded-lg px-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏"
                    value={formData.company}
                    onChange={(e) => setFormData({...formData, company: e.target.value})}
                  />
                </div>
                <button 
                  onClick={() => handleRegisterStep('register-phone')}
                  className="w-full h-12 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors"
                >
                  –î–∞–ª–µ–µ
                </button>
              </div>
            </div>
          </div>
        )}

        {currentStep === 'register-phone' && (
          <div className="w-full max-w-md mx-auto pt-20">
            <div className="text-center mb-8">
              <div className="flex items-center justify-center gap-2 mb-4">
                <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                  <div className="w-2 h-2 bg-white rounded-full"></div>
                </div>
                <span className="text-xl font-semibold">Adapto</span>
              </div>
              <h1 className="text-2xl font-bold mb-2">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h1>
              <p className="text-gray-600">–£–∫–∞–∂–∏—Ç–µ –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è —Å–≤—è–∑–∏</p>
            </div>
            <div className="bg-white rounded-xl p-8 shadow-sm">
              <form onSubmit={(e) => { e.preventDefault(); handleRegisterStep('register-company'); }} className="space-y-4">
                <div>
                  <label className="block text-sm font-medium mb-2">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                  <div className="flex gap-2">
                    <select 
                      value={countryCode}
                      onChange={(e) => setCountryCode(e.target.value)}
                      className="w-24 h-12 border border-gray-300 rounded-lg px-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                      <option value="+7">+7</option>
                      <option value="+1">+1</option>
                      <option value="+44">+44</option>
                      <option value="+49">+49</option>
                      <option value="+33">+33</option>
                      <option value="+39">+39</option>
                      <option value="+34">+34</option>
                      <option value="+81">+81</option>
                      <option value="+86">+86</option>
                      <option value="+91">+91</option>
                    </select>
                    <input 
                      type="tel" 
                      required
                      className={`flex-1 h-12 border rounded-lg px-4 focus:outline-none focus:ring-2 focus:ring-blue-500 ${
                        formErrors.phone ? 'border-red-300 bg-red-50' : 'border-gray-300'
                      }`}
                      placeholder="(999) 123-45-67"
                      value={formData.phone}
                      onChange={(e) => {
                        const formatted = formatPhoneNumber(e.target.value);
                        setFormData({...formData, phone: formatted});
                        if (formErrors.phone) setFormErrors({...formErrors, phone: null});
                      }}
                    />
                  </div>
                  {formErrors.phone && (
                    <p className="text-red-500 text-xs mt-1">{formErrors.phone}</p>
                  )}
                  <p className="text-xs text-gray-500 mt-1">–í–≤–µ–¥–∏—Ç–µ —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
                </div>
                <button 
                  type="submit"
                  className="w-full h-12 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors"
                >
                  –î–∞–ª–µ–µ
                </button>
              </form>
            </div>
          </div>
        )}

        {currentStep === 'register-company' && (
          <div className="w-full max-w-md mx-auto pt-20">
            <div className="text-center mb-8">
              <div className="flex items-center justify-center gap-2 mb-4">
                <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                  <div className="w-2 h-2 bg-white rounded-full"></div>
                </div>
                <span className="text-xl font-semibold">Adapto</span>
              </div>
              <h1 className="text-2xl font-bold mb-2">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Adapto</h1>
              <p className="text-gray-600">–£–∫–∞–∂–∏—Ç–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, —á—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Adapto –ø–æ–¥ –≤–∞—à –±–∏–∑–Ω–µ—Å</p>
            </div>
            <div className="bg-white rounded-xl p-8 shadow-sm">
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium mb-2">–í –∫–∞–∫–æ–π —Å—Ñ–µ—Ä–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–∞—à–∞ –∫–æ–º–ø–∞–Ω–∏—è?</label>
                  <input 
                    type="text" 
                    className="w-full h-12 border border-gray-300 rounded-lg px-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—Ñ–µ—Ä—É –∫–æ–º–ø–∞–Ω–∏–∏"
                    value={formData.companyField}
                    onChange={(e) => setFormData({...formData, companyField: e.target.value})}
                  />
                </div>
                <button 
                  onClick={handleRegisterSubmit}
                  className="w-full h-12 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors"
                >
                  –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
                </button>
              </div>
            </div>
          </div>
        )}

        {currentStep === 'forgot-password' && (
          <div className="w-full max-w-md mx-auto pt-20">
            <div className="text-center mb-8">
              <div className="flex items-center justify-center gap-2 mb-4">
                <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                  <div className="w-2 h-2 bg-white rounded-full"></div>
                </div>
                <span className="text-xl font-semibold">Adapto</span>
              </div>
              <h1 className="text-2xl font-bold mb-2">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è</h1>
              <p className="text-gray-600">–í–≤–µ–¥–∏—Ç–µ email –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è</p>
            </div>
            <div className="bg-white rounded-xl p-8 shadow-sm">
              <form onSubmit={(e) => { e.preventDefault(); setCurrentStep('reset-password'); }} className="space-y-4">
                <div>
                  <label className="block text-sm font-medium mb-2">Email</label>
                  <input 
                    type="email" 
                    required
                    className="w-full h-12 border border-gray-300 rounded-lg px-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="your@email.com"
                    value={formData.email}
                    onChange={(e) => setFormData({...formData, email: e.target.value})}
                  />
                </div>
                <button 
                  type="submit"
                  className="w-full h-12 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors"
                >
                  –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É
                </button>
                <div className="text-center">
                  <button 
                    type="button"
                    onClick={() => setCurrentStep('login')}
                    className="text-blue-600 hover:text-blue-700 text-sm"
                  >
                    –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≤—Ö–æ–¥—É
                  </button>
                </div>
              </form>
            </div>
          </div>
        )}

        {currentStep === 'reset-password' && (
          <div className="w-full max-w-md mx-auto pt-20">
            <div className="text-center mb-8">
              <div className="flex items-center justify-center gap-2 mb-4">
                <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                  <div className="w-2 h-2 bg-white rounded-full"></div>
                </div>
                <span className="text-xl font-semibold">Adapto</span>
              </div>
              <h1 className="text-2xl font-bold mb-2">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É</h1>
              <p className="text-gray-600">–ù–∞ –≤–∞—à—É –ø–æ—á—Ç—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è</p>
            </div>
            <div className="bg-white rounded-xl p-8 shadow-sm text-center">
              <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <div className="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                  <span className="text-white text-xl">‚úì</span>
                </div>
              </div>
              <h3 className="text-lg font-semibold mb-2">–°—Å—ã–ª–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h3>
              <p className="text-gray-600 mb-6">
                –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –≤ –ø–∏—Å—å–º–µ, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
              </p>
              <button 
                onClick={() => setCurrentStep('login')}
                className="w-full h-12 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors"
              >
                –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≤—Ö–æ–¥—É
              </button>
            </div>
          </div>
        )}
      </div>
    )
  }

  const renderContent = () => {
    switch (activeSection) {
      case 'my-solo':
        return (
          <div className="space-y-6">
            <div className="flex justify-between items-center">
              <h1 className="text-2xl font-bold">–ú–æ–π Adapto</h1>
            </div>

            <div className="space-y-4">
              <Card>
                <CardHeader>
                  <CardTitle>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Adapto –ø–æ–¥ —Å–µ–±—è</CardTitle>
                  <p className="text-gray-600">
                    –ï—Å–ª–∏ –∑–∞–º–µ—Ç–∏—Ç–µ –æ—à–∏–±–∫—É –∏–ª–∏ –∑–∞—Ö–æ—Ç–∏—Ç–µ –ø–æ–¥–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç ‚Äî –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ¬´–ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É¬ª, 
                    –∏ Adapto —Å—Ç–∞–Ω–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
                  </p>
                </CardHeader>
              </Card>

              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {/* –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å */}
                <div className="space-y-4">
                  {/* –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π */}
                  {setupData.knowledgeItems.length === 0 && showWarningCard && (
              <div className="border rounded-lg p-4 bg-orange-50 border-orange-200">
                <div className="flex justify-between items-start">
                  <div className="flex gap-3">
                    <AlertTriangle className="h-4 w-4 text-orange-500 mt-1" />
                    <div>
                            <div className="text-orange-600 mb-1 font-medium">–í—ã –µ—â–µ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π</div>
                      <div className="text-sm mb-2">
                              –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π, —á—Ç–æ–±—ã Adapto –Ω–∞—á–∞–ª —Ä–∞–±–æ—Ç–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ
                      </div>
                            <Button 
                              variant="outline" 
                              size="sm" 
                              className="bg-orange-100"
                              onClick={() => {
                                setCurrentSection('knowledge');
                                setActiveSection('knowledge');
                                localStorage.setItem('currentSection', 'knowledge');
                              }}
                            >
                              –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
                      </Button>
                    </div>
                  </div>
                        <Button variant="ghost" size="sm" onClick={() => {
                          setShowWarningCard(false);
                          localStorage.setItem('showWarningCard', 'false');
                        }}>√ó</Button>
                </div>
              </div>
                  )}

                  {/* –ü–æ–ª–µ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π */}
              <Card>
                <CardHeader>
                      <CardTitle>–í–Ω–µ—Å–∏—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –±–æ—Ç–∞</CardTitle>
                      <p className="text-gray-600 text-sm">
                        –ï—Å–ª–∏ –≤—ã —É–≤–∏–¥–µ–ª–∏ –æ—à–∏–±–∫—É –≤ –æ—Ç–≤–µ—Ç–∞—Ö Adapto ‚Äì –Ω–∞–ø–∏—à–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –∑–¥–µ—Å—å, 
                        –∏ –±–æ—Ç –±—É–¥–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
                      </p>
                    </CardHeader>
                    <CardContent>
                      <div className="space-y-3">
                        <Textarea
                          value={botCorrection}
                          onChange={(e) => setBotCorrection(e.target.value)}
                          placeholder="–û–ø–∏—à–∏—Ç–µ, –∫–∞–∫ –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å –±–æ—Ç –≤ –ø–æ–¥–æ–±–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö..."
                          className="min-h-[120px]"
                        />
                        <Button 
                          className="w-full"
                          onClick={handleBotCorrection}
                          disabled={!botCorrection.trim()}
                        >
                          –ü—Ä–∏–º–µ–Ω–∏—Ç—å
                        </Button>
                      </div>
                    </CardContent>
                  </Card>
                </div>

                {/* –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - –ß–∞—Ç */}
                <div className="space-y-4">
                  <Card>
                    <CardHeader>
                      <CardTitle>–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ Adapto –≤ –¥–µ–π—Å—Ç–≤–∏–∏</CardTitle>
                  <p className="text-gray-600">
                    –ù–∞–ø–∏—à–∏—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –≤–∞—à –ò–ò
                  </p>
                </CardHeader>
                <CardContent>
                  <div className="space-y-4">
                        {/* –ß–∞—Ç —Å –∫—Ä–∞—Å–∏–≤—ã–º –¥–∏–∑–∞–π–Ω–æ–º */}
                        <div className="border rounded-lg p-4 min-h-[400px] bg-gray-50 flex flex-col">
                          {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞ */}
                          <div className="flex items-center gap-3 mb-4 pb-3 border-b">
                            <div className="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                              <span className="text-white text-sm font-bold">A</span>
                            </div>
                            <div className="bg-gray-200 rounded-full px-3 py-1">
                              <span className="text-sm text-gray-700">–û–±—â–∞–π—Ç–µ—Å—å —Å Adapto</span>
                            </div>
                          </div>
                          
                          {/* –°–æ–æ–±—â–µ–Ω–∏—è */}
                          <div className="flex-1 space-y-3 overflow-y-auto">
                        {chatHistory.map((message, index) => (
                          <div key={index} className={`flex ${message.type === 'user' ? 'justify-end' : 'justify-start'}`}>
                                <div className={`max-w-[80%] p-3 rounded-lg ${
                              message.type === 'user' 
                                    ? 'bg-gradient-to-r from-blue-500 to-blue-600 text-white' 
                                    : 'bg-white border border-gray-200 shadow-sm'
                            }`}>
                              {message.text}
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                        
                        {/* –ü–æ–ª–µ –≤–≤–æ–¥–∞ */}
                    <div className="flex gap-2">
                      <Input 
                        value={chatMessage}
                            onChange={(e) => setChatMessage(e.target.value)}
                            placeholder="Type in a message..."
                            onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}
                            className="flex-1"
                      />
                      <Button onClick={handleSendMessage}>
                            –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                      </Button>
                    </div>
                  </div>
                </CardContent>
              </Card>
                </div>
              </div>
            </div>
          </div>
        )

      case 'knowledge':
        return (
          <div className="space-y-6">
            <div className="flex justify-between items-center">
              <h1 className="text-2xl font-bold">–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</h1>
              <Button variant="ghost" size="sm">
                <Info className="w-4 h-4 mr-2" />
                –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?
              </Button>
            </div>

            {/* –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–∑ setup wizard */}
            {setupData.knowledgeItems.length > 0 && (
              <Card>
                <CardHeader>
                  <CardTitle>–≠–ª–µ–º–µ–Ω—Ç—ã –∏–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</CardTitle>
                  <p className="text-gray-600">
                    –≠–ª–µ–º–µ–Ω—Ç—ã, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –≤–æ –≤—Ä–µ–º—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Adapto
                  </p>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    {setupData.knowledgeItems.map((item: any, index: number) => (
                      <div key={index} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div className="flex items-center gap-3">
                          <div className="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                            {item.type === 'site' && <Globe className="w-4 h-4 text-blue-600" />}
                            {item.type === 'feed' && <LinkIcon className="w-4 h-4 text-blue-600" />}
                            {item.type === 'text' && <EditIcon className="w-4 h-4 text-blue-600" />}
                            {item.type === 'file' && <FileIcon className="w-4 h-4 text-blue-600" />}
                          </div>
                          <div>
                            <div className="font-medium text-sm">
                              {item.type === 'site' && '–°–∞–π—Ç'}
                              {item.type === 'feed' && '–¢–æ–≤–∞—Ä–Ω—ã–π —Ñ–∏–¥'}
                              {item.type === 'text' && '–¢–µ–∫—Å—Ç'}
                              {item.type === 'file' && '–§–∞–π–ª'}
                            </div>
                            <div className="text-xs text-gray-500 truncate max-w-xs">
                              {item.content}
                            </div>
                          </div>
                        </div>
                        <div className="flex items-center gap-2">
                          <div className="text-xs text-green-600 bg-green-100 px-2 py-1 rounded-full">
                            –û–±—Ä–∞–±–æ—Ç–∫–∞
                          </div>
                          <Button 
                            variant="ghost" 
                            size="sm" 
                            onClick={() => handleDeleteKnowledgeItem(index)}
                            className="text-red-500 hover:text-red-700 hover:bg-red-50"
                          >
                            <Trash2 className="w-4 h-4" />
                          </Button>
                        </div>
                      </div>
                    ))}
                  </div>
                </CardContent>
              </Card>
            )}

            {/* –û—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π */}
            <Card>
              <CardContent className="flex flex-col items-center justify-center py-16 text-center">
                <div className="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                  <Database className="w-8 h-8 text-gray-400" />
                </div>
                <h3 className="mb-2">–ü–æ–∫–∞ –∑–¥–µ—Å—å –ø—É—Å—Ç–æ</h3>
                <p className="text-gray-600 mb-6">
                  –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã –∏–ª–∏ —Å—Å—ã–ª–∫–∏, —á—Ç–æ–±—ã Adapto –Ω–∞—á–∞–ª –æ–±—É—á–∞—Ç—å—Å—è
                </p>
                <Button onClick={() => setKbModalOpen(true)}>
                  <Plus className="w-4 h-4 mr-2" />
                  –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª –∏–ª–∏ —Å—Å—ã–ª–∫—É
                </Button>
              </CardContent>
            </Card>
            {kbModalOpen && (
              <div className="fixed inset-0 z-50 flex items-center justify-center">
                <div className="absolute inset-0 bg-black/50" onClick={() => setKbModalOpen(false)} />
                <div className="relative bg-white rounded-xl max-w-xl w-full p-6 shadow-lg">
                  <div className="flex justify-between items-center mb-4">
                    <h3 className="text-lg font-semibold">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π</h3>
                    <button className="text-gray-400" onClick={() => setKbModalOpen(false)}>‚úï</button>
          </div>
                  <div className="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6">
                    <div 
                      className={`border-2 rounded-lg p-4 flex flex-col items-center text-center cursor-pointer transition-all duration-200 ${
                        selectedKbType === 'site' 
                          ? 'border-blue-500 bg-blue-50 text-blue-700' 
                          : 'border-gray-200 bg-white text-gray-600 hover:border-gray-300 hover:bg-gray-50'
                      }`}
                      onClick={() => handleKbTypeSelect('site')}
                    >
                      <Globe className={`w-6 h-6 mb-2 ${selectedKbType === 'site' ? 'text-blue-600' : 'text-gray-500'}`} />
                      <div className="text-sm font-medium">–°–∞–π—Ç</div>
                    </div>
                    <div 
                      className={`border-2 rounded-lg p-4 flex flex-col items-center text-center cursor-pointer transition-all duration-200 ${
                        selectedKbType === 'feed' 
                          ? 'border-blue-500 bg-blue-50 text-blue-700' 
                          : 'border-gray-200 bg-white text-gray-600 hover:border-gray-300 hover:bg-gray-50'
                      }`}
                      onClick={() => handleKbTypeSelect('feed')}
                    >
                      <LinkIcon className={`w-6 h-6 mb-2 ${selectedKbType === 'feed' ? 'text-blue-600' : 'text-gray-500'}`} />
                      <div className="text-sm font-medium">–¢–æ–≤–∞—Ä–Ω—ã–π —Ñ–∏–¥</div>
                    </div>
                    <div 
                      className={`border-2 rounded-lg p-4 flex flex-col items-center text-center cursor-pointer transition-all duration-200 ${
                        selectedKbType === 'text' 
                          ? 'border-blue-500 bg-blue-50 text-blue-700' 
                          : 'border-gray-200 bg-white text-gray-600 hover:border-gray-300 hover:bg-gray-50'
                      }`}
                      onClick={() => handleKbTypeSelect('text')}
                    >
                      <EditIcon className={`w-6 h-6 mb-2 ${selectedKbType === 'text' ? 'text-blue-600' : 'text-gray-500'}`} />
                      <div className="text-sm font-medium">–°–≤–æ–π —Ç–µ–∫—Å—Ç</div>
                    </div>
                    <div 
                      className={`border-2 rounded-lg p-4 flex flex-col items-center text-center cursor-pointer transition-all duration-200 ${
                        selectedKbType === 'file' 
                          ? 'border-blue-500 bg-blue-50 text-blue-700' 
                          : 'border-gray-200 bg-white text-gray-600 hover:border-gray-300 hover:bg-gray-50'
                      }`}
                      onClick={() => handleKbTypeSelect('file')}
                    >
                      <FileIcon className={`w-6 h-6 mb-2 ${selectedKbType === 'file' ? 'text-blue-600' : 'text-gray-500'}`} />
                      <div className="text-sm font-medium">–§–∞–π–ª</div>
                    </div>
                  </div>
                  
                  {selectedKbType && (
                    <div className="mb-6">
                      {selectedKbType === 'site' && (
                        <div>
                          <label className="block text-sm font-medium mb-2">–°—Å—ã–ª–∫–∞ –Ω–∞ —Å–∞–π—Ç</label>
                          <input 
                            type="url" 
                            className="w-full h-12 border border-gray-300 rounded-lg px-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="https://example.com"
                            value={kbInputValue}
                            onChange={(e) => setKbInputValue(e.target.value)}
                          />
                    </div>
                      )}
                      {selectedKbType === 'feed' && (
                    <div>
                          <label className="block text-sm font-medium mb-2">–°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä–Ω—ã–π —Ñ–∏–¥</label>
                          <input 
                            type="url" 
                            className="w-full h-12 border border-gray-300 rounded-lg px-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="https://example.com/feed.xml"
                            value={kbInputValue}
                            onChange={(e) => setKbInputValue(e.target.value)}
                          />
                    </div>
                      )}
                      {selectedKbType === 'text' && (
                        <div>
                          <label className="block text-sm font-medium mb-2">–í–∞—à —Ç–µ–∫—Å—Ç</label>
                          <textarea 
                            className="w-full h-32 border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à —Ç–µ–∫—Å—Ç..."
                            value={kbInputValue}
                            onChange={(e) => setKbInputValue(e.target.value)}
                          />
                  </div>
                      )}
                      {selectedKbType === 'file' && (
                        <div>
                          <label className="block text-sm font-medium mb-2">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</label>
                          <div 
                            className="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-blue-500 transition-colors"
                            onClick={() => document.getElementById('file-input')?.click()}
                          >
                            <Plus className="w-8 h-8 mx-auto mb-2 text-gray-400" />
                            <div className="text-sm text-gray-600">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞</div>
                            <input 
                              id="file-input"
                              type="file" 
                              className="hidden" 
                              onChange={(e) => {
                                const file = e.target.files?.[0]
                                if (file) {
                                  setKbInputValue(file.name)
                                }
                              }}
                            />
                          </div>
                        </div>
                      )}
                    </div>
                  )}
                  
                  <Button 
                    className={`w-full transition-all duration-200 z-10 relative ${
                      !selectedKbType || !kbInputValue.trim() 
                        ? 'bg-white border-2 border-gray-200 text-gray-600 hover:bg-gray-50' 
                        : 'bg-blue-600 border-2 border-blue-600 text-white hover:bg-blue-700 hover:border-blue-700'
                    }`}
                    onClick={handleKbSubmit}
                    disabled={!selectedKbType || !kbInputValue.trim()}
                  >
                    –î–æ–±–∞–≤–∏—Ç—å –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
                  </Button>
                </div>
              </div>
            )}

            {kbItems.length > 0 && (
              <Card>
                <CardContent className="p-6">
                  {kbItems.map(item => (
                    <div key={item.id} className="flex items-center justify-between border rounded-lg p-3 mb-3">
                  <div className="flex items-center gap-3">
                        {item.type === 'site' && <Globe className="w-5 h-5" />}
                        {item.type === 'feed' && <LinkIcon className="w-5 h-5" />}
                        {item.type === 'text' && <EditIcon className="w-5 h-5" />}
                        {item.type === 'file' && <FileIcon className="w-5 h-5" />}
                        <div className="font-medium">{item.title}</div>
                    </div>
                      <div className="flex items-center gap-3 text-sm">
                        {item.status === '–û–±—Ä–∞–±–æ—Ç–∫–∞' && (
                          <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"></div>
                        )}
                        <span className={item.status === '–û–±—Ä–∞–±–æ—Ç–∫–∞' ? 'text-blue-600' : 'text-green-600'}>
                          {item.status}
                        </span>
                        <button 
                          onClick={() => setKbItems(prev => prev.filter(i => i.id !== item.id))}
                          className="text-gray-400 hover:text-red-600 transition-colors"
                        >
                          <Trash2 className="w-4 h-4" />
                        </button>
                    </div>
                  </div>
                  ))}
                </CardContent>
              </Card>
            )}
          </div>
        )



      case 'dashboard':
        return (
          <div className="space-y-6">
            <h1 className="text-2xl font-bold">–°–≤–æ–¥–∫–∞</h1>
            
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              <Card>
                <CardHeader>
                  <CardTitle>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π</CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold text-blue-600">
                    {chatHistory.length > 1 ? chatHistory.length - 1 : 0}
                    </div>
                  <p className="text-sm text-gray-600">–í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π</p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader>
                  <CardTitle>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∏–∞–ª–æ–≥–æ–≤</CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold text-green-600">
                    {chatHistory.length > 1 ? 1 : 0}
                    </div>
                  <p className="text-sm text-gray-600">–ê–∫—Ç–∏–≤–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤</p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader>
                  <CardTitle>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—è–≤–æ–∫</CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold text-purple-600">0</div>
                  <p className="text-sm text-gray-600">–ö–æ–Ω–≤–µ—Ä—Å–∏—è 0%</p>
                </CardContent>
              </Card>

              <Card>
                <CardHeader>
                  <CardTitle>–û—Ç–∫—Ä—ã—Ç–∏–µ –≤–∏–¥–∂–µ—Ç–∞</CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold text-orange-600">0</div>
                  <p className="text-sm text-gray-600">–ó–∞ —Å–µ–≥–æ–¥–Ω—è</p>
                </CardContent>
              </Card>
            </div>

            {/* –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ */}
              <Card>
                <CardHeader>
                <CardTitle>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="h-64 flex items-end justify-between gap-2">
                  {[12, 19, 15, 25, 22, 30, 28].map((value, index) => (
                    <div key={index} className="flex-1 bg-blue-100 rounded-t" style={{ height: `${(value / 30) * 100}%` }}>
                      <div className="bg-blue-500 h-full rounded-t"></div>
                    </div>
                  ))}
                    </div>
                <div className="flex justify-between text-xs text-gray-500 mt-2">
                  <span>–ü–Ω</span>
                  <span>–í—Ç</span>
                  <span>–°—Ä</span>
                  <span>–ß—Ç</span>
                  <span>–ü—Ç</span>
                  <span>–°–±</span>
                  <span>–í—Å</span>
                  </div>
                </CardContent>
              </Card>
          </div>
        )



      case 'model-settings':
        return (
          <div className="space-y-6">
            <h1 className="text-2xl font-bold">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥–µ–ª–∏</h1>
            
            {/* –®–∞–≥ 1: –¶–µ–ª–∏ Adapto */}
              <Card>
                <CardHeader>
                <CardTitle>–®–∞–≥ 1: –¶–µ–ª–∏ Adapto</CardTitle>
                <p className="text-gray-600">
                  –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ü–µ–ª–µ–π –∏ –∑–∞–¥–∞—á –≤–∞—à–µ–≥–æ –ò–ò-–∞–≥–µ–Ω—Ç–∞
                </p>
                </CardHeader>
              <CardContent className="space-y-4">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block mb-2 font-medium">–ó–∞–¥–∞—á–∞ Adapto</label>
                    <div className="grid grid-cols-2 gap-3">
                      <button
                        onClick={() => setSetupData({...setupData, task: '–ü—Ä–æ–¥–∞–≤–∞—Ç—å'})}
                        className={`p-4 rounded-lg border-2 transition-all ${
                          setupData.task === '–ü—Ä–æ–¥–∞–≤–∞—Ç—å' 
                            ? 'border-blue-500 ring-2 ring-blue-200' 
                            : 'border-gray-200 hover:border-gray-300'
                        }`}
                      >
                        <div className="text-center">
                          <div className="text-lg font-medium mb-1">–ü—Ä–æ–¥–∞–≤–∞—Ç—å</div>
                          <div className="text-sm text-gray-600">–ü–æ–º–æ–≥–∞—Ç—å –≤ –ø—Ä–æ–¥–∞–∂–∞—Ö</div>
                        </div>
                      </button>
                      <button
                        onClick={() => setSetupData({...setupData, task: '–ö–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞—Ç—å'})}
                        className={`p-4 rounded-lg border-2 transition-all ${
                          setupData.task === '–ö–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞—Ç—å' 
                            ? 'border-blue-500 ring-2 ring-blue-200' 
                            : 'border-gray-200 hover:border-gray-300'
                        }`}
                      >
                        <div className="text-center">
                          <div className="text-lg font-medium mb-1">–ö–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞—Ç—å</div>
                          <div className="text-sm text-gray-600">–î–∞–≤–∞—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏</div>
                        </div>
                      </button>
                    </div>
                  </div>
                  <div>
                    <label className="block mb-2 font-medium">–ì–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å</label>
                    <div className="space-y-3">
                      {[
                        '–ó–∞–ø–∏—Å–∞—Ç—å –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é',
                        '–ü—Ä–æ–¥–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç',
                        '–†–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –∫–ª–∏–µ–Ω—Ç–∞',
                        '–î—Ä—É–≥–æ–µ'
                      ].map(goal => (
                        <button
                          key={goal}
                          onClick={() => setSetupData({...setupData, mainGoal: goal})}
                          className={`w-full p-3 rounded-lg border-2 transition-all text-left ${
                            setupData.mainGoal === goal 
                              ? 'border-blue-500 ring-2 ring-blue-200' 
                              : 'border-gray-200 hover:border-gray-300'
                          }`}
                        >
                          {goal}
                        </button>
                      ))}
                    </div>
                    {setupData.mainGoal === '–î—Ä—É–≥–æ–µ' && (
                      <input
                        type="text"
                        value={setupData.mainGoalCustom}
                        onChange={(e) => setSetupData({...setupData, mainGoalCustom: e.target.value})}
                        placeholder="–£–∫–∞–∂–∏—Ç–µ –≤–∞—à—É —Ü–µ–ª—å"
                        className="mt-3 w-full p-3 border rounded-lg border-gray-300"
                      />
                    )}
                  </div>
                  <div>
                    <label className="block mb-2 font-medium">–¶–∏–∫–ª —Å–¥–µ–ª–∫–∏</label>
                    <textarea
                      value={setupData.salesCycle}
                      onChange={(e) => setSetupData({...setupData, salesCycle: e.target.value})}
                      placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–¥–∞–∂–∏ –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –¥–æ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–¥–µ–ª–∫–∏"
                      className="w-full p-3 border border-gray-300 rounded-lg resize-none"
                      rows={3}
                    />
                  </div>
                  <div>
                    <label className="block mb-2 font-medium">–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è</label>
                    <textarea
                      value={setupData.targetAudience}
                      onChange={(e) => setSetupData({...setupData, targetAudience: e.target.value})}
                      placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à—É —Ü–µ–ª–µ–≤—É—é –∞—É–¥–∏—Ç–æ—Ä–∏—é"
                      className="w-full p-3 border border-gray-300 rounded-lg resize-none"
                      rows={3}
                    />
                  </div>
                </div>
                </CardContent>
              </Card>

            {/* –®–∞–≥ 2: –ü—Ä–∞–≤–∏–ª–∞ –æ–±—â–µ–Ω–∏—è */}
              <Card>
                <CardHeader>
                <CardTitle>–®–∞–≥ 2: –ü—Ä–∞–≤–∏–ª–∞ –æ–±—â–µ–Ω–∏—è</CardTitle>
                <p className="text-gray-600">
                  –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç–∏–ª—è –æ–±—â–µ–Ω–∏—è –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
                </p>
                </CardHeader>
              <CardContent className="space-y-4">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block mb-2 font-medium">–û–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é</label>
                    <div className="flex gap-3">
                      <button 
                        onClick={() => setSetupData({...setupData, addressing: '–¢—ã'})}
                        className={`flex-1 border rounded-full h-10 transition-colors ${
                          setupData.addressing === '–¢—ã' ? 'bg-blue-600 text-white border-blue-600' : 'bg-white hover:bg-gray-50'
                        }`}
                      >
                        –Ω–∞ "–¢—ã"
                      </button>
                      <button 
                        onClick={() => setSetupData({...setupData, addressing: '–í—ã'})}
                        className={`flex-1 border rounded-full h-10 transition-colors ${
                          setupData.addressing === '–í—ã' ? 'bg-blue-600 text-white border-blue-600' : 'bg-white hover:bg-gray-50'
                        }`}
                      >
                        –Ω–∞ "–í—ã"
                      </button>
                    </div>
                  </div>
                  <div>
                    <label className="block mb-2 font-medium">–°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è</label>
                    <div className="flex flex-wrap gap-2">
                      {[
                        { text: '–î—Ä—É–∂–µ–ª—é–±–Ω—ã–π', emoji: 'üòä' },
                        { text: '–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π', emoji: 'üòê' },
                        { text: '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π', emoji: 'üíº' },
                        { text: '–Æ–º–æ—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π', emoji: 'üòÑ' }
                      ].map(t => (
                        <button 
                          key={t.text} 
                          onClick={() => setSetupData({...setupData, communicationStyle: t.text})} 
                          className={`px-4 h-10 rounded-full border flex items-center gap-2 ${
                            setupData.communicationStyle === t.text ? 'bg-blue-600 text-white border-blue-600' : 'bg-white hover:bg-gray-50'
                          }`}
                        >
                          <span>{t.emoji}</span>
                          <span>{t.text}</span>
                        </button>
                      ))}
                    </div>
                  </div>
                </div>

                <div className="border rounded-xl p-4 bg-gray-50">
                  <div className="font-medium mb-2">–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Adapto</div>
                  <div className="flex flex-wrap gap-2">
                    {[
                      '–ù–µ –æ–±—Å—É–∂–¥–∞–π —Ü–µ–Ω—ã',
                      '–ù–µ –¥–∞–≤–∞–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Å–æ–≤–µ—Ç–æ–≤',
                      '–ù–µ –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–π –ø–æ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º –≤–æ–ø—Ä–æ—Å–∞–º',
                      '–ù–µ —Ä–∞–∑—ä—è—Å–Ω—è–π —É—Å–ª–æ–≤–∏—è –¥–æ–≥–æ–≤–æ—Ä–æ–≤',
                      '–ù–µ —Å–æ–∑–¥–∞–≤–∞–π –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –æ—Ç –ª–∏—Ü–∞ –∫–æ–º–ø–∞–Ω–∏–∏',
                      '–ù–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–π –Ω–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–∞ –∏–ª–∏ —É—Å–ª—É–≥–∏',
                      '–î—Ä—É–≥–æ–µ'
                    ].map(restriction => (
                      <button
                        key={restriction}
                        onClick={() => {
                          if (restriction === '–î—Ä—É–≥–æ–µ') {
                            // –ï—Å–ª–∏ "–î—Ä—É–≥–æ–µ" —É–∂–µ –∞–∫—Ç–∏–≤–Ω–æ, —É–±–∏—Ä–∞–µ–º –µ–≥–æ –∏ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                            if (setupData.restrictionsCustom !== undefined) {
                              setSetupData({
                                ...setupData, 
                                restrictionsCustom: undefined,
                                restrictions: setupData.restrictions.filter(r => r !== '–î—Ä—É–≥–æ–µ')
                              });
                            } else {
                              // –ï—Å–ª–∏ "–î—Ä—É–≥–æ–µ" –Ω–µ –∞–∫—Ç–∏–≤–Ω–æ, –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –µ–≥–æ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤
                              setSetupData({
                                ...setupData, 
                                restrictionsCustom: '',
                                restrictions: [...setupData.restrictions, '–î—Ä—É–≥–æ–µ']
                              });
                            }
                          } else {
                            const newRestrictions = setupData.restrictions.includes(restriction)
                              ? setupData.restrictions.filter(r => r !== restriction)
                              : [...setupData.restrictions, restriction];
                            setSetupData({...setupData, restrictions: newRestrictions});
                          }
                        }}
                        className={`px-4 py-2 rounded-full border-2 transition-all text-sm ${
                          setupData.restrictions.includes(restriction)
                            ? 'border-blue-500 bg-blue-50 text-blue-700' 
                            : 'border-gray-200 bg-white text-gray-700 hover:border-gray-300'
                        }`}
                      >
                        {restriction}
                      </button>
                    ))}
                  </div>
                  {setupData.restrictions.includes('–î—Ä—É–≥–æ–µ') && setupData.restrictionsCustom !== undefined && (
                    <input
                      type="text"
                      value={setupData.restrictionsCustom}
                      onChange={(e) => setSetupData({...setupData, restrictionsCustom: e.target.value})}
                      placeholder="–£–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ"
                      className="mt-3 w-full p-3 border border-gray-300 rounded-lg"
                    />
                  )}
                </div>

                <div className="border rounded-xl p-4 bg-gray-50">
                  <div className="font-medium mb-2">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</div>
                  <div className="flex flex-wrap gap-2">
                    {[
                      '–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç',
                      '–ü–æ—è—Å–Ω—è—Ç—å —Å—Å—ã–ª–∫–∏ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π',
                      '–ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–Ω–∏–º–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞',
                      '–ò–∑–±–µ–≥–∞—Ç—å –¥–ª–∏–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π',
                      '–£—Ç–æ—á–Ω—è—Ç—å –∑–∞–¥–∞—á—É –≤ –Ω–∞—á–∞–ª–µ –æ–±—â–µ–Ω–∏—è',
                      '–ù–µ –æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞',
                      '–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—Ç—å –æ–± –æ–∂–∏–¥–∞–Ω–∏–∏ –æ—Ç–≤–µ—Ç–∞',
                      '–ò–∑–±–µ–≥–∞—Ç—å —Å–ø–æ—Ä–æ–≤',
                      '–û—Ç–≤–µ—á–∞—Ç—å –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞',
                      '–î—Ä—É–≥–æ–µ'
                    ].map(setting => (
                      <button
                        key={setting}
                        onClick={() => {
                          if (setting === '–î—Ä—É–≥–æ–µ') {
                            // –ï—Å–ª–∏ "–î—Ä—É–≥–æ–µ" —É–∂–µ –∞–∫—Ç–∏–≤–Ω–æ, —É–±–∏—Ä–∞–µ–º –µ–≥–æ –∏ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                            if (setupData.additionalSettingsCustom !== undefined) {
                              setSetupData({
                                ...setupData, 
                                additionalSettingsCustom: undefined,
                                additionalSettings: setupData.additionalSettings.filter(s => s !== '–î—Ä—É–≥–æ–µ')
                              });
                            } else {
                              // –ï—Å–ª–∏ "–î—Ä—É–≥–æ–µ" –Ω–µ –∞–∫—Ç–∏–≤–Ω–æ, –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –µ–≥–æ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤
                              setSetupData({
                                ...setupData, 
                                additionalSettingsCustom: '',
                                additionalSettings: [...setupData.additionalSettings, '–î—Ä—É–≥–æ–µ']
                              });
                            }
                          } else {
                            const newSettings = setupData.additionalSettings.includes(setting)
                              ? setupData.additionalSettings.filter(s => s !== setting)
                              : [...setupData.additionalSettings, setting];
                            setSetupData({...setupData, additionalSettings: newSettings});
                          }
                        }}
                        className={`px-4 py-2 rounded-full border-2 transition-all text-sm ${
                          setupData.additionalSettings.includes(setting)
                            ? 'border-blue-500 bg-blue-50 text-blue-700' 
                            : 'border-gray-200 bg-white text-gray-700 hover:border-gray-300'
                        }`}
                      >
                        {setting}
                      </button>
                    ))}
                  </div>
                  {setupData.additionalSettings.includes('–î—Ä—É–≥–æ–µ') && setupData.additionalSettingsCustom !== undefined && (
                    <input
                      type="text"
                      value={setupData.additionalSettingsCustom}
                      onChange={(e) => setSetupData({...setupData, additionalSettingsCustom: e.target.value})}
                      placeholder="–£–∫–∞–∂–∏—Ç–µ –≤–∞—à—É –Ω–∞—Å—Ç—Ä–æ–π–∫—É"
                      className="mt-3 w-full p-3 border border-gray-300 rounded-lg"
                    />
                  )}
                </div>

                <div className="border rounded-xl p-4 bg-gray-50">
                  <div className="font-medium mb-2">–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö</div>
                  <div className="flex flex-wrap gap-2">
                    {[
                      '–ò–º—è',
                      '–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞',
                      '–ü–æ—á—Ç–∞',
                      '–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏',
                      '–ì–æ—Ä–æ–¥',
                      '–í–æ–∑—Ä–∞—Å—Ç',
                      '–ù–µ —Å–æ–±–∏—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ',
                      '–î–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ'
                    ].map(dataType => (
                      <button
                        key={dataType}
                        onClick={() => {
                          if (dataType === '–î–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ') {
                            // –ï—Å–ª–∏ "–î–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ" —É–∂–µ –∞–∫—Ç–∏–≤–Ω–æ, —É–±–∏—Ä–∞–µ–º –µ–≥–æ –∏ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                            if (setupData.dataCollectionCustom !== undefined) {
                              setSetupData({
                                ...setupData, 
                                dataCollectionCustom: undefined,
                                dataCollection: setupData.dataCollection.filter(d => d !== '–î–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ')
                              });
                            } else {
                              // –ï—Å–ª–∏ "–î–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ" –Ω–µ –∞–∫—Ç–∏–≤–Ω–æ, –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –µ–≥–æ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤
                              setSetupData({
                                ...setupData, 
                                dataCollectionCustom: '',
                                dataCollection: [...setupData.dataCollection, '–î–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ']
                              });
                            }
                          } else if (dataType === '–ù–µ —Å–æ–±–∏—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ') {
                            setSetupData({...setupData, dataCollection: []});
                          } else {
                            const newDataCollection = setupData.dataCollection.includes(dataType)
                              ? setupData.dataCollection.filter(d => d !== dataType)
                              : [...setupData.dataCollection, dataType];
                            setSetupData({...setupData, dataCollection: newDataCollection});
                          }
                        }}
                        className={`px-4 py-2 rounded-full border-2 transition-all text-sm ${
                          (dataType === '–ù–µ —Å–æ–±–∏—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ' && setupData.dataCollection.length === 0) ||
                          setupData.dataCollection.includes(dataType)
                            ? 'border-blue-500 bg-blue-50 text-blue-700' 
                            : 'border-gray-200 bg-white text-gray-700 hover:border-gray-300'
                        }`}
                      >
                        {dataType}
                      </button>
                    ))}
                  </div>
                  {setupData.dataCollection.includes('–î–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ') && setupData.dataCollectionCustom !== undefined && (
                    <input
                      type="text"
                      value={setupData.dataCollectionCustom}
                      onChange={(e) => setSetupData({...setupData, dataCollectionCustom: e.target.value})}
                      placeholder="–£–∫–∞–∂–∏—Ç–µ –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–±–∏—Ä–∞—Ç—å"
                      className="mt-3 w-full p-3 border border-gray-300 rounded-lg"
                    />
                  )}
                </div>

                <div className="border rounded-xl p-4 bg-gray-50">
                  <div className="font-medium mb-2">–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–º–∞–π–ª–∏–∫–æ–≤</div>
                  <div className="grid grid-cols-3 gap-4 text-center">
                    {([
                      { text: '–ù–∏–∫–æ–≥–¥–∞', emoji: '' },
                      { text: '–†–µ–¥–∫–æ', emoji: 'üòä' },
                      { text: '–ß–∞—Å—Ç–æ', emoji: 'üòä üòÑ' }
                    ] as const).map(opt => (
                      <button 
                        key={opt.text} 
                        onClick={() => setSetupData({...setupData, emojiUsage: opt.text})}
                        className={`border rounded-xl p-6 ${setupData.emojiUsage === opt.text ? 'ring-2 ring-blue-500 bg-blue-50' : 'bg-white hover:bg-gray-50'}`}
                      >
                        <div className="text-2xl mb-2">{opt.emoji}</div>
                        <div className="text-sm">{opt.text}</div>
                      </button>
                    ))}
                  </div>
                </div>

                </CardContent>
              </Card>

            {/* –®–∞–≥ 3: –≠—Ç–∞–ø—ã –¥–∏–∞–ª–æ–≥–∞ */}
              <Card>
                <CardHeader>
                <CardTitle>–®–∞–≥ 3: –≠—Ç–∞–ø—ã –¥–∏–∞–ª–æ–≥–∞</CardTitle>
                <p className="text-gray-600">
                  –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —ç—Ç–∞–ø—ã –¥–∏–∞–ª–æ–≥–∞ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏
                </p>
                </CardHeader>
                <CardContent>
                <div className="space-y-4">
                  {setupData.dialogStages.map((stage, index) => (
                    <div key={index} className="border border-gray-200 rounded-lg p-4">
                      <div className="flex items-start gap-3">
                        <div className="w-6 h-6 bg-gray-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                          <span className="text-white text-sm">{index + 1}</span>
                        </div>
                        <div className="flex-1">
                          <textarea
                            value={stage}
                            onChange={(e) => {
                              const newStages = [...setupData.dialogStages];
                              newStages[index] = e.target.value;
                              setSetupData({...setupData, dialogStages: newStages});
                            }}
                            className="w-full p-3 border border-gray-300 rounded-lg resize-none"
                            rows={2}
                          />
                        </div>
                        <button
                          onClick={() => {
                            const newStages = setupData.dialogStages.filter((_, i) => i !== index);
                            setSetupData({...setupData, dialogStages: newStages});
                          }}
                          className="text-red-500 hover:text-red-700 p-2"
                        >
                          √ó
                        </button>
                      </div>
                    </div>
                  ))}
                  
                  <button
                    onClick={() => {
                      const newStages = [...setupData.dialogStages, '–ù–æ–≤—ã–π —ç—Ç–∞–ø'];
                      setSetupData({...setupData, dialogStages: newStages});
                    }}
                    className="w-full p-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-gray-400 hover:text-gray-800 transition-colors"
                  >
                    + –î–æ–±–∞–≤–∏—Ç—å —ç—Ç–∞–ø
                  </button>
                </div>
                </CardContent>
              </Card>

            {/* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */}
            <div className="flex gap-3">
              <Button className="flex-1" onClick={handleSaveSettings}>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</Button>
              <Button className="flex-1" variant="outline" onClick={handleTestAdapto}>–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Adapto</Button>
            </div>
          </div>
        )

      case 'dialogs':
        return (
          <div className="space-y-6">
            <div className="flex justify-between items-center">
              <h1 className="text-2xl font-bold">–î–∏–∞–ª–æ–≥–∏</h1>
              <div className="flex gap-2">
                <Button variant="outline" size="sm">
                  <Download className="w-4 h-4 mr-2" />
                  CSV
                </Button>
                <Button variant="outline" size="sm">
                  <Download className="w-4 h-4 mr-2" />
                  XLS
                </Button>
              </div>
            </div>

            {/* –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è */}
            <Card>
              <CardContent className="p-4">
                <div className="flex flex-wrap gap-2 items-center">
                  <span className="text-sm font-medium text-gray-700">–§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ:</span>
                  {[
                    { label: '–°–µ–≥–æ–¥–Ω—è', value: 'today' },
                    { label: '–í—á–µ—Ä–∞', value: 'yesterday' },
                    { label: '7 –¥–Ω–µ–π', value: '7days' },
                    { label: '–ú–µ—Å—è—Ü', value: 'month' }
                  ].map(filter => (
                    <button
                      key={filter.value}
                      className="px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50"
                    >
                      {filter.label}
                    </button>
                  ))}
                  <div className="flex items-center gap-2">
                    <span className="text-sm text-gray-600">–í—ã–±–æ—Ä –¥–∞—Ç:</span>
                    <input 
                      type="date" 
                      className="px-2 py-1 text-sm border border-gray-300 rounded"
                    />
                    <span className="text-sm text-gray-600">‚Äî</span>
                    <input 
                      type="date" 
                      className="px-2 py-1 text-sm border border-gray-300 rounded"
                    />
                  </div>
                </div>
              </CardContent>
            </Card>

            {!showConversationDetail ? (
              <div className="space-y-4">
            <Card>
              <CardHeader>
                    <CardTitle>–°–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤</CardTitle>
              </CardHeader>
              <CardContent>
                    <div className="space-y-2">
                      {conversations.length === 0 ? (
                        <div className="text-center py-8 text-gray-500">
                          <MessageSquare className="w-12 h-12 mx-auto mb-4 text-gray-300" />
                          <p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –≤–∞—à–∏ –¥–∏–∞–ª–æ–≥–∏</p>
                          <p className="text-sm">–ü—Ä–∏—Å—Ç—É–ø–∏—Ç–µ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ò–ò-–∞–≥–µ–Ω—Ç–∞</p>
                  </div>
                      ) : (
                        conversations.map((conv) => (
                          <div 
                            key={conv.id}
                            onClick={() => {
                              setSelectedConversation(conv);
                              setShowConversationDetail(true);
                            }}
                            className="border rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors"
                          >
                            <div className="flex justify-between items-start">
                              <div>
                                <div className="font-medium">{conv.client_name || '–ö–ª–∏–µ–Ω—Ç'}</div>
                                <div className="text-sm text-gray-500">{conv.last_message}</div>
                    </div>
                              <div className="text-xs text-gray-400">{conv.last_message_time}</div>
                    </div>
                    </div>
                        ))
                      )}
                    </div>
                  </CardContent>
                </Card>
                  </div>
            ) : (
              <div className="space-y-4">
                <div className="flex items-center gap-4">
                  <button 
                    onClick={() => setShowConversationDetail(false)}
                    className="text-blue-600 hover:text-blue-700"
                  >
                    ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
                  </button>
                  <h2>–î–∏–∞–ª–æ–≥ —Å {selectedConversation?.client_name || '–ö–ª–∏–µ–Ω—Ç–æ–º'}</h2>
                </div>
                
                <Card>
                  <CardContent className="p-4">
                    <div className="space-y-4 max-h-96 overflow-y-auto">
                      {selectedConversation?.messages?.map((msg, idx) => (
                        <div 
                          key={idx}
                          className={`flex ${msg.type === 'user' ? 'justify-end' : 'justify-start'}`}
                        >
                          <div className={`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${
                            msg.type === 'user' 
                              ? 'bg-blue-600 text-white' 
                              : 'bg-gray-100 text-gray-900'
                          }`}>
                            {msg.text}
                          </div>
                        </div>
                      ))}
                </div>
              </CardContent>
            </Card>
              </div>
            )}
          </div>
        )

      case 'integrations':
        return (
          <div className="space-y-6">
            <div className="flex justify-between items-center">
              <h1 className="text-2xl font-bold">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</h1>
            </div>

            {/* –ü–µ—Ä–≤–∞—è –ø–ª–∞—à–∫–∞ - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∏–¥–∂–µ—Ç–∞ */}
            <Card 
              className="cursor-pointer hover:shadow-md transition-shadow"
              onClick={() => handleIntegrationClick('widget')}
            >
              <CardContent className="p-6">
                <div className="flex items-center gap-4">
                  <div className="w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center">
                    <span className="text-white font-bold">W</span>
                </div>
                  <div className="flex-1">
                    <h3 className="font-medium mb-1">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∏–¥–∂–µ—Ç–∞</h3>
                    <p className="text-sm text-gray-600">–ß–∞—Ç-–≤–∏–¥–∂–µ—Ç –¥–ª—è —Å–∞–π—Ç–∞</p>
                  </div>
                  <div className="text-gray-400">‚Üí</div>
                </div>
              </CardContent>
            </Card>

            {/* –í—Ç–æ—Ä–∞—è –≥—Ä—É–ø–ø–∞ - –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—ã */}
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              <Card 
                className="cursor-pointer hover:shadow-md transition-shadow"
                onClick={() => handleIntegrationClick('telegram')}
              >
                <CardContent className="p-6">
                  <div className="text-center">
                    <div className="w-12 h-12 bg-blue-500 rounded-lg mx-auto mb-4 flex items-center justify-center">
                      <span className="text-white font-bold">TG</span>
                </div>
                    <h3 className="font-medium mb-2">Telegram</h3>
                    <p className="text-sm text-gray-600">–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –±–æ—Ç–∞ –∫ Telegram</p>
                  </div>
                </CardContent>
              </Card>

              <Card 
                className="cursor-pointer hover:shadow-md transition-shadow"
                onClick={() => handleIntegrationClick('whatsapp')}
              >
                <CardContent className="p-6">
                  <div className="text-center">
                    <div className="w-12 h-12 bg-green-500 rounded-lg mx-auto mb-4 flex items-center justify-center">
                      <span className="text-white font-bold">WA</span>
                </div>
                    <h3 className="font-medium mb-2">WhatsApp</h3>
                    <p className="text-sm text-gray-600">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å WhatsApp Business</p>
                  </div>
                </CardContent>
              </Card>

              <Card 
                className="cursor-pointer hover:shadow-md transition-shadow"
                onClick={() => handleIntegrationClick('instagram')}
              >
                <CardContent className="p-6">
                  <div className="text-center">
                    <div className="w-12 h-12 bg-pink-500 rounded-lg mx-auto mb-4 flex items-center justify-center">
                      <span className="text-white font-bold">IG</span>
                    </div>
                    <h3 className="font-medium mb-2">Instagram</h3>
                    <p className="text-sm text-gray-600">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Instagram</p>
                  </div>
              </CardContent>
            </Card>
            </div>

            {/* –¢—Ä–µ—Ç—å—è –≥—Ä—É–ø–ø–∞ - CRM —Å–∏—Å—Ç–µ–º—ã */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <Card 
                className="cursor-pointer hover:shadow-md transition-shadow"
                onClick={() => handleIntegrationClick('amocrm')}
              >
                <CardContent className="p-6">
                  <div className="text-center">
                    <div className="w-12 h-12 bg-blue-600 rounded-lg mx-auto mb-4 flex items-center justify-center">
                      <span className="text-white font-bold">A</span>
                    </div>
                    <h3 className="font-medium mb-2">AmoCRM</h3>
                    <p className="text-sm text-gray-600">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AmoCRM</p>
                  </div>
                </CardContent>
              </Card>

              <Card 
                className="cursor-pointer hover:shadow-md transition-shadow"
                onClick={() => handleIntegrationClick('bitrix24')}
              >
                <CardContent className="p-6">
                  <div className="text-center">
                    <div className="w-12 h-12 bg-orange-500 rounded-lg mx-auto mb-4 flex items-center justify-center">
                      <span className="text-white font-bold">B</span>
                    </div>
                    <h3 className="font-medium mb-2">–ë–∏—Ç—Ä–∏–∫—Å24</h3>
                    <p className="text-sm text-gray-600">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ë–∏—Ç—Ä–∏–∫—Å24</p>
                  </div>
                </CardContent>
              </Card>
            </div>


          </div>
        )

      default:
        return <div>–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</div>
    }
  }

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ—à–µ–ª –≤ —Å–∏—Å—Ç–µ–º—É
  if (isLoggedIn || currentStep === 'dashboard') {
        return (
    <div className="flex h-screen w-full bg-gray-50">
      {/* Success Modal */}
      {showSuccessModal && (
        <div className="fixed inset-0 z-50 flex items-center justify-center">
          <div className="absolute inset-0 bg-black/50" onClick={() => setShowSuccessModal(false)} />
          <div className="relative bg-white rounded-xl max-w-md w-full p-8 shadow-lg text-center">
            <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <div className="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                <span className="text-white text-xl">‚úì</span>
              </div>
            </div>
            <h3 className="text-xl font-bold mb-2">–°–ø–∞—Å–∏–±–æ –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é!</h3>
            <p className="text-gray-600 mb-6">
              –ü—Ä–æ–π–¥–∏—Ç–µ –ø–æ –≤—Å–µ–º —à–∞–≥–∞–º, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–µ–≥–æ –ò–ò-–∞–≥–µ–Ω—Ç–∞ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ –≤ —Ä–∞–±–æ—Ç—É
            </p>
            <button 
              onClick={() => setShowSuccessModal(false)}
              className="w-full h-12 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors"
            >
              –û—Ç–ª–∏—á–Ω–æ!
            </button>
          </div>
        </div>
      )}

      {/* Notification */}
      {showNotification && (
        <div className="fixed top-4 right-4 z-50 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform transition-all duration-300">
          {notificationMessage}
        </div>
      )}

      {/* Setup Wizard */}
      {showSetupWizard && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50">
          <div className="bg-white rounded-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div className="p-6 border-b border-gray-200">
              <div className="flex items-center justify-between">
                <h2 className="text-2xl font-bold">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ò–ò-–∞–≥–µ–Ω—Ç–∞</h2>
                <div className="flex items-center gap-4">
                  <div className="text-sm text-gray-600">
                    –®–∞–≥ {setupStep} –∏–∑ 4
                  </div>
                  <button 
                    onClick={() => setShowSetupWizard(false)}
                    className="text-gray-400 hover:text-gray-600 text-xl"
                  >
                    √ó
                  </button>
                </div>
              </div>
              <div className="mt-4 flex gap-2">
                {[1, 2, 3, 4].map(step => (
                  <div 
                    key={step}
                    className={`h-2 flex-1 rounded-full ${
                      step <= setupStep ? 'bg-blue-500' : 'bg-gray-200'
                    }`}
                  />
                ))}
              </div>
            </div>
            
            <div className="p-6" id="setup-content">
              {showValidationMessage && (
                <div className="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg">
                  <div className="text-red-800 font-medium">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è</div>
                </div>
              )}
              
              {setupStep === 1 && (
          <div className="space-y-6">
                  <h3 className="text-xl font-semibold">–®–∞–≥ 1. –£—Ç–æ—á–Ω–∏—Ç–µ —Ü–µ–ª–∏ Adapto</h3>
                  
                <div>
                    <label className="block text-sm font-medium mb-3">
                      –ö–∞–∫—É—é –∑–∞–¥–∞—á—É –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω—è—Ç—å –ê–¥–∞–ø—Ç–æ?
                      <span className="text-red-500 ml-1">*</span>
                    </label>
                    <div className="grid grid-cols-2 gap-3">
                      <button
                        onClick={() => setSetupData({...setupData, task: '–ü—Ä–æ–¥–∞–≤–∞—Ç—å'})}
                        className={`p-4 rounded-lg border-2 transition-all ${
                          setupData.task === '–ü—Ä–æ–¥–∞–≤–∞—Ç—å' 
                            ? 'border-blue-500 ring-2 ring-blue-200' 
                            : validationErrors.task 
                              ? 'border-red-500 ring-2 ring-red-200' 
                              : 'border-gray-200 hover:border-gray-300'
                        }`}
                      >
                        <div className="text-center">
                          <div className="text-lg font-medium mb-1">–ü—Ä–æ–¥–∞–≤–∞—Ç—å</div>
                          <div className="text-sm text-gray-600">–ü–æ–º–æ–≥–∞—Ç—å –≤ –ø—Ä–æ–¥–∞–∂–∞—Ö</div>
                        </div>
                      </button>
                      <button
                        onClick={() => setSetupData({...setupData, task: '–ö–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞—Ç—å'})}
                        className={`p-4 rounded-lg border-2 transition-all ${
                          setupData.task === '–ö–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞—Ç—å' 
                            ? 'border-blue-500 ring-2 ring-blue-200' 
                            : validationErrors.task 
                              ? 'border-red-500 ring-2 ring-red-200' 
                              : 'border-gray-200 hover:border-gray-300'
                        }`}
                      >
                        <div className="text-center">
                          <div className="text-lg font-medium mb-1">–ö–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞—Ç—å</div>
                          <div className="text-sm text-gray-600">–î–∞–≤–∞—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏</div>
                        </div>
                      </button>
                    </div>
                </div>
                
                <div>
                    <label className="block text-sm font-medium mb-3">
                      –ö–∞–∫–∞—è –≥–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å –ò–ò-–∞–≥–µ–Ω—Ç–∞?
                      <span className="text-red-500 ml-1">*</span>
                    </label>
                    <div className="space-y-3">
                      {[
                        '–ó–∞–ø–∏—Å–∞—Ç—å –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é',
                        '–ü—Ä–æ–¥–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç',
                        '–†–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –∫–ª–∏–µ–Ω—Ç–∞',
                        '–î—Ä—É–≥–æ–µ'
                      ].map(goal => (
                        <button
                          key={goal}
                          onClick={() => setSetupData({...setupData, mainGoal: goal})}
                          className={`w-full p-3 rounded-lg border-2 transition-all text-left ${
                            setupData.mainGoal === goal 
                              ? 'border-blue-500 ring-2 ring-blue-200' 
                              : validationErrors.mainGoal 
                                ? 'border-red-500 ring-2 ring-red-200' 
                                : 'border-gray-200 hover:border-gray-300'
                          }`}
                        >
                          {goal}
                        </button>
                      ))}
                    </div>
                    {setupData.mainGoal === '–î—Ä—É–≥–æ–µ' && (
                      <input
                        type="text"
                        value={setupData.mainGoalCustom}
                        onChange={(e) => setSetupData({...setupData, mainGoalCustom: e.target.value})}
                        placeholder="–£–∫–∞–∂–∏—Ç–µ –≤–∞—à—É —Ü–µ–ª—å"
                        className={`mt-3 w-full p-3 border rounded-lg ${
                          validationErrors.mainGoalCustom 
                            ? 'border-red-500 ring-2 ring-red-200' 
                            : 'border-gray-300'
                        }`}
                      />
                    )}
                </div>

                <div>
                    <label className="block text-sm font-medium mb-2">
                      –ö–∞–∫–æ–π —Ü–∏–∫–ª —Å–¥–µ–ª–∫–∏ —É –≤–∞—Å –≤ –∫–æ–º–ø–∞–Ω–∏–∏?
                      <span className="text-red-500 ml-1">*</span>
                    </label>
                    <textarea
                      value={setupData.salesCycle}
                      onChange={(e) => setSetupData({...setupData, salesCycle: e.target.value})}
                      placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–¥–∞–∂–∏ –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –¥–æ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–¥–µ–ª–∫–∏"
                      className={`w-full p-3 border rounded-lg resize-none ${
                        validationErrors.salesCycle 
                          ? 'border-red-500 ring-2 ring-red-200' 
                          : 'border-gray-300'
                      }`}
                      rows={3}
                  />
                </div>

                  <div>
                    <label className="block text-sm font-medium mb-2">
                      –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è
                      <span className="text-red-500 ml-1">*</span>
                    </label>
                    <textarea
                      value={setupData.targetAudience}
                      onChange={(e) => setSetupData({...setupData, targetAudience: e.target.value})}
                      placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à—É —Ü–µ–ª–µ–≤—É—é –∞—É–¥–∏—Ç–æ—Ä–∏—é"
                      className={`w-full p-3 border rounded-lg resize-none ${
                        validationErrors.targetAudience 
                          ? 'border-red-500 ring-2 ring-red-200' 
                          : 'border-gray-300'
                      }`}
                      rows={3}
                    />
          </div>
                </div>
              )}

              {setupStep === 2 && (
                <div className="space-y-6">
                  <h3 className="text-xl font-semibold">–®–∞–≥ 2. –ü—Ä–∞–≤–∏–ª–∞ –æ–±—â–µ–Ω–∏—è</h3>
                  
                  <div>
                    <label className="block text-sm font-medium mb-3">–û–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é</label>
                    <div className="grid grid-cols-2 gap-3">
                      <button
                        onClick={() => setSetupData({...setupData, addressing: '–¢—ã'})}
                        className={`p-4 rounded-lg border-2 transition-all ${
                          setupData.addressing === '–¢—ã' 
                            ? 'border-blue-500 ring-2 ring-blue-200' 
                            : 'border-gray-200 hover:border-gray-300'
                        }`}
                      >
                        <div className="text-center">
                          <div className="text-lg font-medium">–Ω–∞ "–¢—ã"</div>
                        </div>
                      </button>
                      <button
                        onClick={() => setSetupData({...setupData, addressing: '–í—ã'})}
                        className={`p-4 rounded-lg border-2 transition-all ${
                          setupData.addressing === '–í—ã' 
                            ? 'border-blue-500 ring-2 ring-blue-200' 
                            : 'border-gray-200 hover:border-gray-300'
                        }`}
                      >
                        <div className="text-center">
                          <div className="text-lg font-medium">–Ω–∞ "–í—ã"</div>
                        </div>
                      </button>
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-medium mb-3">–°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è</label>
                    <div className="grid grid-cols-2 gap-3">
                      {[
                        { label: '–î—Ä—É–∂–µ–ª—é–±–Ω—ã–π', emoji: 'üòä' },
                        { label: '–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π', emoji: 'üòê' },
                        { label: '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π', emoji: 'üíº' },
                        { label: '–Æ–º–æ—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π', emoji: 'üòÑ' }
                      ].map(style => (
                        <button
                          key={style.label}
                          onClick={() => setSetupData({...setupData, communicationStyle: style.label})}
                          className={`p-4 rounded-lg border-2 transition-all ${
                            setupData.communicationStyle === style.label 
                              ? 'border-blue-500 ring-2 ring-blue-200' 
                              : 'border-gray-200 hover:border-gray-300'
                          }`}
                        >
                          <div className="text-center">
                            <div className="text-lg font-medium mb-1">{style.emoji}</div>
                            <div className="text-sm">{style.label}</div>
                          </div>
                        </button>
                      ))}
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-medium mb-3">–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–º–∞–π–ª–∏–∫–æ–≤</label>
                    <div className="grid grid-cols-3 gap-3">
                      {[
                        { label: '–ù–∏–∫–æ–≥–¥–∞', emoji: '' },
                        { label: '–†–µ–¥–∫–æ', emoji: 'üòä' },
                        { label: '–ß–∞—Å—Ç–æ', emoji: 'üòä üòÑ' }
                      ].map(option => (
                        <button
                          key={option.label}
                          onClick={() => setSetupData({...setupData, emojiUsage: option.label})}
                          className={`p-4 rounded-lg border-2 transition-all ${
                            setupData.emojiUsage === option.label 
                              ? 'border-blue-500 ring-2 ring-blue-200' 
                              : 'border-gray-200 hover:border-gray-300'
                          }`}
                        >
                          <div className="text-center">
                            <div className="text-lg font-medium mb-1">{option.emoji}</div>
                            <div className="text-sm">{option.label}</div>
                          </div>
                        </button>
                      ))}
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-medium mb-3">
                      –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ê–¥–∞–ø—Ç–æ
                      <span className="text-red-500 ml-1">*</span>
                    </label>
                    <div className="flex flex-wrap gap-2">
                      {[
                        '–ù–µ –æ–±—Å—É–∂–¥–∞–π —Ü–µ–Ω—ã',
                        '–ù–µ –¥–∞–≤–∞–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Å–æ–≤–µ—Ç–æ–≤',
                        '–ù–µ –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–π –ø–æ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º –≤–æ–ø—Ä–æ—Å–∞–º',
                        '–ù–µ —Ä–∞–∑—ä—è—Å–Ω—è–π —É—Å–ª–æ–≤–∏—è –¥–æ–≥–æ–≤–æ—Ä–æ–≤',
                        '–ù–µ —Å–æ–∑–¥–∞–≤–∞–π –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –æ—Ç –ª–∏—Ü–∞ –∫–æ–º–ø–∞–Ω–∏–∏',
                        '–ù–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–π –Ω–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–∞ –∏–ª–∏ —É—Å–ª—É–≥–∏',
                        '–î—Ä—É–≥–æ–µ'
                      ].map(restriction => (
                        <button
                          key={restriction}
                          onClick={() => {
                            if (restriction === '–î—Ä—É–≥–æ–µ') {
                              // –ï—Å–ª–∏ "–î—Ä—É–≥–æ–µ" —É–∂–µ –∞–∫—Ç–∏–≤–Ω–æ, —É–±–∏—Ä–∞–µ–º –µ–≥–æ –∏ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                              if (setupData.restrictionsCustom !== undefined) {
                                setSetupData({
                                  ...setupData, 
                                  restrictionsCustom: undefined,
                                  restrictions: setupData.restrictions.filter(r => r !== '–î—Ä—É–≥–æ–µ')
                                });
                              } else {
                                // –ï—Å–ª–∏ "–î—Ä—É–≥–æ–µ" –Ω–µ –∞–∫—Ç–∏–≤–Ω–æ, –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –µ–≥–æ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤
                                setSetupData({
                                  ...setupData, 
                                  restrictionsCustom: '',
                                  restrictions: [...setupData.restrictions, '–î—Ä—É–≥–æ–µ']
                                });
                              }
                            } else {
                              const newRestrictions = setupData.restrictions.includes(restriction)
                                ? setupData.restrictions.filter(r => r !== restriction)
                                : [...setupData.restrictions, restriction];
                              setSetupData({...setupData, restrictions: newRestrictions});
                            }
                          }}
                          className={`px-4 py-2 rounded-full border-2 transition-all text-sm ${
                            setupData.restrictions.includes(restriction)
                              ? 'border-blue-500 bg-blue-50 text-blue-700' 
                              : validationErrors.restrictions 
                                ? 'border-red-300 bg-red-50 text-red-700' 
                                : 'border-gray-200 bg-white text-gray-700 hover:border-gray-300'
                          }`}
                        >
                          {restriction}
                        </button>
                      ))}
                    </div>
                    {setupData.restrictions.includes('–î—Ä—É–≥–æ–µ') && setupData.restrictionsCustom !== undefined && (
                      <input
                        type="text"
                        value={setupData.restrictionsCustom}
                        onChange={(e) => setSetupData({...setupData, restrictionsCustom: e.target.value})}
                        placeholder="–£–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ"
                        className="mt-3 w-full p-3 border border-gray-300 rounded-lg"
                      />
                    )}
                  </div>

                  <div>
                    <label className="block text-sm font-medium mb-3">
                      –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç–∏–ª—è –æ–±—â–µ–Ω–∏—è
                      <span className="text-red-500 ml-1">*</span>
                    </label>
                    <div className="flex flex-wrap gap-2">
                      {[
                        '–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç',
                        '–ü–æ—è—Å–Ω—è—Ç—å —Å—Å—ã–ª–∫–∏ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π',
                        '–ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–Ω–∏–º–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞',
                        '–ò–∑–±–µ–≥–∞—Ç—å –¥–ª–∏–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π',
                        '–£—Ç–æ—á–Ω—è—Ç—å –∑–∞–¥–∞—á—É –≤ –Ω–∞—á–∞–ª–µ –æ–±—â–µ–Ω–∏—è',
                        '–ù–µ –æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞',
                        '–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—Ç—å –æ–± –æ–∂–∏–¥–∞–Ω–∏–∏ –æ—Ç–≤–µ—Ç–∞',
                        '–ò–∑–±–µ–≥–∞—Ç—å —Å–ø–æ—Ä–æ–≤',
                        '–û—Ç–≤–µ—á–∞—Ç—å –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞',
                        '–î—Ä—É–≥–æ–µ'
                      ].map(setting => (
                        <button
                          key={setting}
                          onClick={() => {
                            if (setting === '–î—Ä—É–≥–æ–µ') {
                              // –ï—Å–ª–∏ "–î—Ä—É–≥–æ–µ" —É–∂–µ –∞–∫—Ç–∏–≤–Ω–æ, —É–±–∏—Ä–∞–µ–º –µ–≥–æ –∏ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                              if (setupData.additionalSettingsCustom !== undefined) {
                                setSetupData({
                                  ...setupData, 
                                  additionalSettingsCustom: undefined,
                                  additionalSettings: setupData.additionalSettings.filter(s => s !== '–î—Ä—É–≥–æ–µ')
                                });
                              } else {
                                // –ï—Å–ª–∏ "–î—Ä—É–≥–æ–µ" –Ω–µ –∞–∫—Ç–∏–≤–Ω–æ, –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –µ–≥–æ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤
                                setSetupData({
                                  ...setupData, 
                                  additionalSettingsCustom: '',
                                  additionalSettings: [...setupData.additionalSettings, '–î—Ä—É–≥–æ–µ']
                                });
                              }
                            } else {
                              const newSettings = setupData.additionalSettings.includes(setting)
                                ? setupData.additionalSettings.filter(s => s !== setting)
                                : [...setupData.additionalSettings, setting];
                              setSetupData({...setupData, additionalSettings: newSettings});
                            }
                          }}
                          className={`px-4 py-2 rounded-full border-2 transition-all text-sm ${
                            setupData.additionalSettings.includes(setting) 
                              ? 'border-blue-500 bg-blue-50 text-blue-700' 
                              : validationErrors.additionalSettings 
                                ? 'border-red-300 bg-red-50 text-red-700' 
                                : 'border-gray-200 bg-white text-gray-700 hover:border-gray-300'
                          }`}
                        >
                          {setting}
                        </button>
                      ))}
                    </div>
                    {setupData.additionalSettings.includes('–î—Ä—É–≥–æ–µ') && setupData.additionalSettingsCustom !== undefined && (
                      <input
                        type="text"
                        value={setupData.additionalSettingsCustom}
                        onChange={(e) => setSetupData({...setupData, additionalSettingsCustom: e.target.value})}
                        placeholder="–£–∫–∞–∂–∏—Ç–µ –≤–∞—à—É –Ω–∞—Å—Ç—Ä–æ–π–∫—É"
                        className="mt-3 w-full p-3 border border-gray-300 rounded-lg"
                      />
                    )}
                  </div>

                  <div>
                    <label className="block text-sm font-medium mb-3">–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö</label>
                    <div className="flex flex-wrap gap-2">
                      {[
                        '–ò–º—è',
                        '–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞',
                        '–ü–æ—á—Ç–∞',
                        '–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏',
                        '–ì–æ—Ä–æ–¥',
                        '–í–æ–∑—Ä–∞—Å—Ç',
                        '–ù–µ —Å–æ–±–∏—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ',
                        '–î–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ'
                      ].map(dataType => (
                        <button
                          key={dataType}
                          onClick={() => {
                            if (dataType === '–î–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ') {
                              // –ï—Å–ª–∏ "–î–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ" —É–∂–µ –∞–∫—Ç–∏–≤–Ω–æ, —É–±–∏—Ä–∞–µ–º –µ–≥–æ –∏ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                              if (setupData.dataCollectionCustom !== undefined) {
                                setSetupData({
                                  ...setupData, 
                                  dataCollectionCustom: undefined,
                                  dataCollection: setupData.dataCollection.filter(d => d !== '–î–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ')
                                });
                              } else {
                                // –ï—Å–ª–∏ "–î–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ" –Ω–µ –∞–∫—Ç–∏–≤–Ω–æ, –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –µ–≥–æ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤
                                setSetupData({
                                  ...setupData, 
                                  dataCollectionCustom: '',
                                  dataCollection: [...setupData.dataCollection, '–î–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ']
                                });
                              }
                            } else {
                              const newDataCollection = setupData.dataCollection.includes(dataType)
                                ? setupData.dataCollection.filter(d => d !== dataType)
                                : [...setupData.dataCollection, dataType];
                              setSetupData({...setupData, dataCollection: newDataCollection});
                            }
                          }}
                          className={`px-4 py-2 rounded-full border-2 transition-all text-sm ${
                            setupData.dataCollection.includes(dataType)
                              ? 'border-blue-500 bg-blue-50 text-blue-700' 
                              : 'border-gray-200 bg-white text-gray-700 hover:border-gray-300'
                          }`}
                        >
                          {dataType}
                        </button>
                      ))}
                    </div>
                    {setupData.dataCollection.includes('–î–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ') && setupData.dataCollectionCustom !== undefined && (
                      <input
                        type="text"
                        value={setupData.dataCollectionCustom}
                        onChange={(e) => setSetupData({...setupData, dataCollectionCustom: e.target.value})}
                        placeholder="–£–∫–∞–∂–∏—Ç–µ –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–±–∏—Ä–∞—Ç—å"
                        className="mt-3 w-full p-3 border border-gray-300 rounded-lg"
                      />
                    )}
                  </div>

                  <div>
                    <label className="block text-sm font-medium mb-3">–£—Ç–æ—á–Ω–µ–Ω–∏–µ –∏ –≤–æ–ø—Ä–æ—Å—ã</label>
                    <div className="flex flex-wrap gap-2">
                      {[
                        '–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ–ø–æ–ª–Ω—ã–π',
                        '–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —Å–æ–º–Ω–µ–≤–∞–µ—Ç—Å—è',
                        '–ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∏—Å–∫ –æ—à–∏–±–∫–∏',
                        '–ü—Ä–∏ –≤—ã–±–æ—Ä–µ –ø—Ä–æ–¥—É–∫—Ç–∞ –∏–ª–∏ —É—Å–ª—É–≥–∏',
                        '–ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–Ω–∫–æ—Å—Ç–µ–π',
                        '–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –ø—Ä–æ—è–≤–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å –∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –≤–∞—Ä–∏–∞–Ω—Ç–∞–º',
                        '–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ',
                        '–ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ–¥–±–æ—Ä',
                        '–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –∑–∞–¥–∞—ë—Ç –≤–æ–ø—Ä–æ—Å—ã –≤–Ω–µ —Å–≤–æ–µ–π –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏',
                        '–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ –≤–µ—â–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –∑–Ω–∞–Ω–∏–π',
                        '–ü—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞—è–≤–∫–∏ –∏–ª–∏ –∑–∞–∫–∞–∑–∞',
                        '–ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –æ—Ñ–æ—Ä–º–∏—Ç—å —á—Ç–æ-—Ç–æ –≤–∞–∂–Ω–æ–µ',
                        '–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –¥–æ–ª–≥–æ –º–æ–ª—á–∏—Ç',
                        '–î—Ä—É–≥–æ–µ'
                      ].map(rule => (
                        <button
                          key={rule}
                          onClick={() => {
                            if (rule === '–î—Ä—É–≥–æ–µ') {
                              // –ï—Å–ª–∏ "–î—Ä—É–≥–æ–µ" —É–∂–µ –∞–∫—Ç–∏–≤–Ω–æ, —É–±–∏—Ä–∞–µ–º –µ–≥–æ –∏ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                              if (setupData.clarificationRulesCustom !== undefined) {
                                setSetupData({
                                  ...setupData, 
                                  clarificationRulesCustom: undefined,
                                  clarificationRules: setupData.clarificationRules.filter(r => r !== '–î—Ä—É–≥–æ–µ')
                                });
                              } else {
                                // –ï—Å–ª–∏ "–î—Ä—É–≥–æ–µ" –Ω–µ –∞–∫—Ç–∏–≤–Ω–æ, –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –µ–≥–æ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤
                                setSetupData({
                                  ...setupData, 
                                  clarificationRulesCustom: '',
                                  clarificationRules: [...setupData.clarificationRules, '–î—Ä—É–≥–æ–µ']
                                });
                              }
                            } else {
                              const newRules = setupData.clarificationRules.includes(rule)
                                ? setupData.clarificationRules.filter(r => r !== rule)
                                : [...setupData.clarificationRules, rule];
                              setSetupData({...setupData, clarificationRules: newRules});
                            }
                          }}
                          className={`px-4 py-2 rounded-full border-2 transition-all text-sm ${
                            setupData.clarificationRules.includes(rule) 
                              ? 'border-blue-500 bg-blue-50 text-blue-700' 
                              : 'border-gray-200 bg-white text-gray-700 hover:border-gray-300'
                          }`}
                        >
                          {rule}
                        </button>
                      ))}
                    </div>
                    {setupData.clarificationRules.includes('–î—Ä—É–≥–æ–µ') && setupData.clarificationRulesCustom !== undefined && (
                      <input
                        type="text"
                        value={setupData.clarificationRulesCustom}
                        onChange={(e) => setSetupData({...setupData, clarificationRulesCustom: e.target.value})}
                        placeholder="–£–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –ø—Ä–∞–≤–∏–ª–æ"
                        className="mt-3 w-full p-3 border border-gray-300 rounded-lg"
                      />
                    )}
                  </div>
                </div>
              )}

              {setupStep === 3 && (
                <div className="space-y-6">
                  <h3 className="text-xl font-semibold">–®–∞–≥ 3. –≠—Ç–∞–ø—ã –¥–∏–∞–ª–æ–≥–∞</h3>
                  
                  <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <div className="flex items-start gap-3">
                      <div className="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                        <span className="text-white text-sm">!</span>
                      </div>
                      <div>
                        <div className="font-medium text-blue-800 mb-1">–£–¥–µ–ª–∏—Ç–µ –≤—Ä–µ–º—è –¥–µ—Ç–∞–ª—å–Ω–æ–º—É –æ–ø–∏—Å–∞–Ω–∏—é –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞</div>
                        <div className="text-sm text-blue-700">
                          –≠—Ç–æ –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ –¥–ª—è —Ö–æ—Ä–æ—à–µ–π —Ä–∞–±–æ—Ç—ã –≤–∞—à–µ–≥–æ –ò–ò-–ø—Ä–æ–¥–∞–∂–Ω–∏–∫–∞. –í—ã —Å–º–æ–∂–µ—Ç–µ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–∑–∂–µ, –Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ–π—á–∞—Å –¥–∞—Å—Ç –ª—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ä–∞–∑—É. –ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω —à–∞–±–ª–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π –≤–∞–º –Ω—É–∂–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å.
                        </div>
                      </div>
                    </div>
                  </div>

                  <div className="space-y-4">
                    {setupData.dialogStages.map((stage, index) => (
                      <div key={index} className="border border-gray-200 rounded-lg p-4">
                        <div className="flex items-start gap-3">
                          <div className="w-6 h-6 bg-gray-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                            <span className="text-white text-sm">{index + 1}</span>
                          </div>
                          <div className="flex-1">
                            <textarea
                              value={stage}
                              onChange={(e) => {
                                const newStages = [...setupData.dialogStages];
                                newStages[index] = e.target.value;
                                setSetupData({...setupData, dialogStages: newStages});
                              }}
                              className="w-full p-3 border border-gray-300 rounded-lg resize-none"
                              rows={2}
                            />
                          </div>
                          <button
                            onClick={() => {
                              const newStages = setupData.dialogStages.filter((_, i) => i !== index);
                              setSetupData({...setupData, dialogStages: newStages});
                            }}
                            className="text-red-500 hover:text-red-700 p-2"
                          >
                            √ó
                          </button>
                        </div>
                      </div>
                    ))}
                    
                    <button
                      onClick={() => {
                        const newStages = [...setupData.dialogStages, '–ù–æ–≤—ã–π —ç—Ç–∞–ø'];
                        setSetupData({...setupData, dialogStages: newStages});
                      }}
                      className="w-full p-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-gray-400 hover:text-gray-800 transition-colors"
                    >
                      + –î–æ–±–∞–≤–∏—Ç—å —ç—Ç–∞–ø
                    </button>
                  </div>
                </div>
              )}

              {setupStep === 4 && (
                <div className="space-y-6">
                  <h3 className="text-xl font-semibold">–®–∞–≥ 4. –û–±—É—á–µ–Ω–∏–µ –ê–¥–∞–ø—Ç–æ</h3>
                  
                  <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <div className="flex items-start gap-3">
                      <div className="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                        <span className="text-white text-sm">!</span>
                      </div>
                      <div>
                        <div className="font-medium text-blue-800 mb-1">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –º–∏–Ω–∏–º—É–º 1 —Ä–µ—Å—É—Ä—Å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–æ–º–ø–∞–Ω–∏–∏</div>
                        <div className="text-sm text-blue-700">
                          –ß—Ç–æ–±—ã –ê–¥–∞–ø—Ç–æ —Å–º–æ–≥ –æ–±—É—á–∏—Ç—å—Å—è –Ω–∞ –Ω–µ–π
                        </div>
                      </div>
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-medium mb-3">
                      –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ä–µ—Å—É—Ä—Å–∞
                      <span className="text-red-500 ml-1">*</span>
                    </label>
                    <div className="grid grid-cols-2 sm:grid-cols-4 gap-3">
                      {[
                        { type: 'site', label: '–°–∞–π—Ç', icon: 'üåê' },
                        { type: 'feed', label: '–¢–æ–≤–∞—Ä–Ω—ã–π —Ñ–∏–¥', icon: 'üìã' },
                        { type: 'text', label: '–ù–∞–ø–∏—Å–∞—Ç—å —Å–∞–º–æ–º—É', icon: '‚úèÔ∏è' },
                        { type: 'file', label: '–§–∞–π–ª', icon: 'üìÅ' }
                      ].map(item => (
                        <button
                          key={item.type}
                          onClick={() => {
                            setSetupData({
                              ...setupData, 
                              selectedKnowledgeType: item.type
                            });
                          }}
                          className={`p-4 border-2 rounded-lg transition-colors ${
                            setupData.selectedKnowledgeType === item.type 
                              ? 'border-blue-500 bg-blue-50' 
                              : 'border-gray-200 hover:border-gray-300'
                          }`}
                        >
                          <div className="text-center">
                            <div className="text-2xl mb-2">{item.icon}</div>
                            <div className="text-sm">{item.label}</div>
                          </div>
                        </button>
                      ))}
                    </div>
                  </div>

                  {/* –ü–æ–ª—è –¥–ª—è –≤–≤–æ–¥–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ */}
                  {setupData.selectedKnowledgeType === 'site' && (
                    <div>
                      <label className="block text-sm font-medium mb-2">–°—Å—ã–ª–∫–∞ –Ω–∞ —Å–∞–π—Ç</label>
                      <input
                        type="url"
                        value={setupData.knowledgeInputValue || ''}
                        onChange={(e) => setSetupData({...setupData, knowledgeInputValue: e.target.value})}
                        placeholder="https://example.com"
                        className="w-full p-3 border border-gray-300 rounded-lg"
                      />
                      <button
                        onClick={() => {
                          if (setupData.knowledgeInputValue?.trim()) {
                            // –í–∞–ª–∏–¥–∞—Ü–∏—è URL
                            const urlRegex = /^https?:\/\/.+/;
                            if (!urlRegex.test(setupData.knowledgeInputValue)) {
                              alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π URL (–Ω–∞—á–∏–Ω–∞—é—â–∏–π—Å—è —Å http:// –∏–ª–∏ https://)');
                              return;
                            }
                            
                            setSetupData({
                              ...setupData,
                              knowledgeItems: [...setupData.knowledgeItems, { 
                                type: 'site', 
                                content: setupData.knowledgeInputValue 
                              }],
                              knowledgeInputValue: '',
                              selectedKnowledgeType: ''
                            });
                          }
                        }}
                        className="mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                      >
                        –î–æ–±–∞–≤–∏—Ç—å —Å–∞–π—Ç
                      </button>
                    </div>
                  )}

                  {setupData.selectedKnowledgeType === 'feed' && (
                    <div>
                      <label className="block text-sm font-medium mb-2">–°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä–Ω—ã–π —Ñ–∏–¥</label>
                      <input
                        type="url"
                        value={setupData.knowledgeInputValue || ''}
                        onChange={(e) => setSetupData({...setupData, knowledgeInputValue: e.target.value})}
                        placeholder="https://example.com/feed.xml"
                        className="w-full p-3 border border-gray-300 rounded-lg"
                      />
                      <button
                        onClick={() => {
                          if (setupData.knowledgeInputValue?.trim()) {
                            // –í–∞–ª–∏–¥–∞—Ü–∏—è URL
                            const urlRegex = /^https?:\/\/.+/;
                            if (!urlRegex.test(setupData.knowledgeInputValue)) {
                              alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π URL (–Ω–∞—á–∏–Ω–∞—é—â–∏–π—Å—è —Å http:// –∏–ª–∏ https://)');
                              return;
                            }
                            
                            setSetupData({
                              ...setupData,
                              knowledgeItems: [...setupData.knowledgeItems, { 
                                type: 'feed', 
                                content: setupData.knowledgeInputValue 
                              }],
                              knowledgeInputValue: '',
                              selectedKnowledgeType: ''
                            });
                          }
                        }}
                        className="mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                      >
                        –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–¥
                      </button>
                    </div>
                  )}

                  {setupData.selectedKnowledgeType === 'text' && (
                    <div>
                      <label className="block text-sm font-medium mb-2">–¢–µ–∫—Å—Ç –æ –∫–æ–º–ø–∞–Ω–∏–∏</label>
                      <textarea
                        value={setupData.knowledgeInputValue || ''}
                        onChange={(e) => setSetupData({...setupData, knowledgeInputValue: e.target.value})}
                        placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à—É –∫–æ–º–ø–∞–Ω–∏—é, –ø—Ä–æ–¥—É–∫—Ç—ã, —É—Å–ª—É–≥–∏..."
                        className="w-full p-3 border border-gray-300 rounded-lg resize-none"
                        rows={4}
                      />
                      <button
                        onClick={() => {
                          if (setupData.knowledgeInputValue?.trim()) {
                            setSetupData({
                              ...setupData,
                              knowledgeItems: [...setupData.knowledgeItems, { 
                                type: 'text', 
                                content: setupData.knowledgeInputValue 
                              }],
                              knowledgeInputValue: '',
                              selectedKnowledgeType: ''
                            });
                          }
                        }}
                        className="mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                      >
                        –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç
                      </button>
                    </div>
                  )}

                  {setupData.selectedKnowledgeType === 'file' && (
                    <div>
                      <label className="block text-sm font-medium mb-2">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</label>
                      <input
                        type="file"
                        onChange={(e) => {
                          const file = e.target.files?.[0];
                          if (file) {
                            setSetupData({
                              ...setupData,
                              knowledgeItems: [...setupData.knowledgeItems, { 
                                type: 'file', 
                                content: file.name 
                              }],
                              selectedKnowledgeType: ''
                            });
                          }
                        }}
                        className="w-full p-3 border border-gray-300 rounded-lg"
                        accept=".pdf,.doc,.docx,.txt"
                      />
                    </div>
                  )}

                  {setupData.knowledgeItems.length > 0 && (
                    <div className="space-y-2">
                      <h4 className="font-medium">–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:</h4>
                      {setupData.knowledgeItems.map((item, index) => (
                        <div key={index} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                          <span>{item.type}: {item.content}</span>
                          <button
                            onClick={() => {
                              const newItems = setupData.knowledgeItems.filter((_, i) => i !== index);
                              setSetupData({...setupData, knowledgeItems: newItems});
                            }}
                            className="text-red-500 hover:text-red-700"
                          >
                            √ó
                          </button>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              )}

              <div className="flex justify-between mt-8 pt-6 border-t border-gray-200">
                                    <Button
                      onClick={() => setSetupStep(Math.max(1, setupStep - 1))}
                      disabled={setupStep === 1}
                      variant="outline"
                    >
                      –ù–∞–∑–∞–¥
                    </Button>
                
                {setupStep < 4 ? (
                  <Button
                    onClick={() => {
                      // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞
                      if (!validateStep(setupStep)) {
                        // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –≤–µ—Ä—Ö—É –¥–ª—è –ø–æ–∫–∞–∑–∞ –æ—à–∏–±–æ–∫
                        document.getElementById('setup-content')?.scrollIntoView({ behavior: 'smooth' });
                        return;
                      }
                      
                      if (setupStep === 3) {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–∑–º–µ–Ω–∏–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —ç—Ç–∞–ø—ã –¥–∏–∞–ª–æ–≥–∞
                        const hasChanges = setupData.dialogStages.some((stage, index) => 
                          stage !== originalDialogStages[index]
                        ) || setupData.dialogStages.length !== originalDialogStages.length;
                        
                        if (!hasChanges) {
                          setShowDialogWarning(true);
                          return;
                        }
                      }
                      
                      setSetupStep(setupStep + 1);
                      // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –≤–µ—Ä—Ö—É –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥
                      setTimeout(() => {
                        document.getElementById('setup-content')?.scrollIntoView({ behavior: 'smooth' });
                      }, 100);
                    }}
                  >
                    –î–∞–ª–µ–µ
                  </Button>
                ) : (
                  <Button
                    onClick={async () => {
                      try {
                        // –í—Ä–µ–º–µ–Ω–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ localStorage (–ø–æ–∫–∞ –±—ç–∫–µ–Ω–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
                        localStorage.setItem('setupData', JSON.stringify(setupData));
                        localStorage.setItem('hasShownSetupWizard', 'true');
                        
                        setShowSetupWizard(false);
                        setShowLoadingScreen(true);
                        
                        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
                        const timer = setInterval(() => {
                          setLoadingTime(prev => {
                            if (prev <= 1) {
                              clearInterval(timer);
                              setShowLoadingScreen(false);
                              return 0;
                            }
                            return prev - 1;
                          });
                        }, 1000);
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
                        showNotificationMessage('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã! –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤–∞—à–µ–≥–æ –ò–ò-–∞–≥–µ–Ω—Ç–∞...');
                      } catch (error) {
                        console.error('Error saving settings:', error);
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
                      }
                    }}
                    disabled={setupData.knowledgeItems.length === 0}
                    className={setupData.knowledgeItems.length === 0 ? 'bg-gray-300 text-gray-500' : 'bg-green-600 hover:bg-green-700'}
                  >
                    –ó–∞–≤–µ—Ä—à–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É
                  </Button>
                )}
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Loading Screen */}
      {showLoadingScreen && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-white">
          <div className="text-center">
            <div className="mb-8">
              <div className="w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mx-auto mb-4"></div>
              <h2 className="text-2xl font-bold text-gray-800 mb-2">–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤–∞—à–µ–≥–æ –ò–ò-–∞–≥–µ–Ω—Ç–∞</h2>
              <p className="text-gray-600 mb-4">–≠—Ç–æ –∑–∞–π–º–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç</p>
              <div className="text-3xl font-bold text-blue-600">
                {Math.floor(loadingTime / 60)}:{(loadingTime % 60).toString().padStart(2, '0')}
              </div>
            </div>
            <div className="w-64 bg-gray-200 rounded-full h-2 mx-auto">
              <div 
                className="bg-blue-600 h-2 rounded-full transition-all duration-1000"
                style={{ width: `${((300 - loadingTime) / 300) * 100}%` }}
              ></div>
            </div>
          </div>
        </div>
      )}

      {/* Dialog Warning Modal */}
      {showDialogWarning && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50">
          <div className="bg-white rounded-xl max-w-md w-full mx-4 p-6">
            <div className="text-center">
              <div className="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <span className="text-orange-600 text-xl">‚ö†</span>
              </div>
              <h3 className="text-xl font-semibold mb-2">–í—ã –Ω–µ –≤–Ω–µ—Å–ª–∏ –Ω–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π</h3>
              <p className="text-gray-600 mb-6">
                –û–Ω –Ω–µ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ–¥ –≤–∞—à –±–∏–∑–Ω–µ—Å —ç—Ç–æ –º–æ–∂–µ—Ç —Å–∫–∞–∑–∞—Ç—å—Å—è –Ω–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ò–ò-–∞–≥–µ–Ω—Ç–∞.
              </p>
              <div className="flex gap-3">
                <button
                  onClick={() => setShowDialogWarning(false)}
                  className="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors"
                >
                  –í–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
                </button>
                <button
                  onClick={() => {
                    setShowDialogWarning(false);
                    setSetupStep(4);
                  }}
                  className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                >
                  –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
                </button>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Progress Bar */}
      {showProgressBar && (
        <div className="fixed bottom-4 left-4 z-50 bg-white rounded-xl shadow-lg border border-gray-200 w-80 max-h-96 overflow-hidden">
          <div className="p-4 border-b border-gray-200">
            <div className="flex items-center justify-between">
              <h3 className="font-semibold text-gray-900">–ó–∞–ø—É—Å–∫ Adapto {progressTasks.filter(t => t.completed).length}/3</h3>
              <button 
                onClick={() => setShowProgressBar(false)}
                className="text-gray-400 hover:text-gray-600"
              >
                √ó
              </button>
            </div>
            <div className="mt-2 w-full bg-gray-200 rounded-full h-2">
              <div 
                className="bg-green-500 h-2 rounded-full transition-all duration-300"
                style={{ width: `${(progressTasks.filter(t => t.completed).length / 3) * 100}%` }}
              ></div>
            </div>
          </div>
          <div className="p-4 space-y-3 max-h-64 overflow-y-auto">
            {progressTasks.map((task) => (
              <div key={task.id} className="flex items-start gap-3">
                <div
                  className={`w-5 h-5 rounded-full border-2 flex items-center justify-center mt-0.5 ${
                    task.completed 
                      ? 'bg-green-500 border-green-500 text-white' 
                      : 'border-gray-300'
                  }`}
                >
                  {task.completed && <span className="text-xs">‚úì</span>}
                </div>
                <div className="flex-1">
                  <div className="flex items-center justify-between">
                    <span className={`text-sm font-medium ${task.completed ? 'text-green-600' : 'text-gray-900'}`}>
                      {task.title}
                    </span>
                    <button
                      onClick={() => handleProgressTaskAction(task.id)}
                      className="text-blue-600 hover:text-blue-700 text-xs font-medium"
                    >
                      –ü–µ—Ä–µ–π—Ç–∏ ‚Üí
                    </button>
                  </div>
                  <p className="text-xs text-gray-600 mt-1">{task.description}</p>
                </div>
              </div>
            ))}
          </div>
        </div>
      )}
      {/* Mobile sidebar overlay */}
      {sidebarOpen && (
        <div 
          className="fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden"
          onClick={() => setSidebarOpen(false)}
        />
      )}

      {/* Sidebar */}
      <div className={`fixed md:relative z-50 md:z-auto transform transition-transform duration-300 ease-in-out ${
        sidebarOpen ? 'translate-x-0' : '-translate-x-full'
      } md:translate-x-0 w-64 h-full bg-white border-r border-gray-200 flex flex-col`}>
        
        {/* Header */}
        <div className="p-4 border-b border-gray-200">
          <div className="flex items-center gap-2">
            <div className="w-8 h-8 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center">
              <div className="flex items-center justify-center w-5 h-5">
                <div className="w-2 h-2 bg-white rounded-full mr-1"></div>
                <div className="w-1 h-1 bg-white rounded-full"></div>
              </div>
            </div>
            <div>
              <div className="font-medium">{currentUser?.name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}</div>
              <div className="text-xs text-gray-500">{currentUser?.company_name || '–ö–æ–º–ø–∞–Ω–∏—è'}</div>
            </div>
          </div>
        </div>
        
        {/* Navigation */}
        <div className="flex-1 p-4">
          <nav className="space-y-2">
            {menuItems.map((item) => (
              <button
                key={item.id}
                onClick={() => {
                  setActiveSection(item.id)
                  setCurrentSection(item.id)
                  localStorage.setItem('currentSection', item.id)
                  setSidebarOpen(false)
                }}
                className={`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-colors ${
                  activeSection === item.id 
                    ? 'bg-gray-100 text-gray-900' 
                    : 'hover:bg-gray-50 text-gray-700'
                }`}
              >
                <item.icon className="w-4 h-4" />
                {item.label}
              </button>
            ))}
          </nav>
        </div>

        {/* Footer */}
        <div className="p-4 border-t border-gray-200 space-y-2">
          <button 
            onClick={() => setShowProgressBar(!showProgressBar)}
            className="w-full flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer"
          >
            <div className="w-2 h-2 bg-green-500 rounded-full"></div>
            <span className="text-sm">–ó–∞–ø—É—Å–∫ Adapto</span>
          </button>
          
          <div className="space-y-1">
            <button className="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left hover:bg-gray-50 transition-colors">
              <Settings className="w-4 h-4" />
              <span className="text-sm">–ü—Ä–∞–≤–∏–ª–∞ –∏ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è</span>
            </button>
            <button className="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left hover:bg-gray-50 transition-colors">
              <MessageSquare className="w-4 h-4" />
              <span className="text-sm">–ß–∞—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π</span>
            </button>
            <button className="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left hover:bg-gray-50 transition-colors" onClick={handleLogout}>
              <ExternalLink className="w-4 h-4" />
              <span className="text-sm">–í—ã–π—Ç–∏</span>
            </button>
          </div>
        </div>
      </div>

      {/* Main content */}
      <div className="flex-1 flex flex-col overflow-hidden">
        {/* Mobile header */}
        <div className="md:hidden flex items-center gap-4 p-4 border-b border-gray-200 bg-white">
          <Button 
            variant="ghost" 
            size="sm"
            onClick={() => setSidebarOpen(true)}
          >
            <Menu className="w-4 h-4" />
          </Button>
          <h1 className="font-medium">Adapto AI Platform</h1>
        </div>

        {/* Content */}
        <main className="flex-1 overflow-auto p-6 bg-white">
          {renderContent()}
        </main>
      </div>

      {/* Integration Modal */}
      {showIntegrationModal && (
        <div className="fixed inset-0 z-50 flex items-center justify-center">
          <div className="absolute inset-0 bg-black/50" onClick={() => setShowIntegrationModal(false)} />
          <div className="relative bg-white rounded-xl p-6 max-w-lg w-full mx-4 max-h-[80vh] overflow-y-auto">
            <div className="flex items-center justify-between mb-4">
              <h3 className="text-xl font-semibold">
                {selectedIntegration === 'telegram' ? 'Telegram' : 'WhatsApp'} –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
              </h3>
              <button 
                onClick={() => setShowIntegrationModal(false)}
                className="text-gray-400 hover:text-gray-600 text-xl"
              >
                √ó
              </button>
            </div>
            
            {selectedIntegration === 'telegram' && (
              <div className="space-y-4">
                <div className="bg-blue-50 p-4 rounded-lg">
                  <h4 className="font-medium text-blue-900 mb-2">üì± –°–æ–∑–¥–∞–Ω–∏–µ Telegram –±–æ—Ç–∞</h4>
                  <ol className="text-sm text-blue-800 space-y-2">
                    <li>1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –∏ –Ω–∞–π–¥–∏—Ç–µ @BotFather</li>
                    <li>2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É <code className="bg-blue-100 px-1 rounded">/newbot</code></li>
                    <li>3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –∏ —Å–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞</li>
                    <li>4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω</li>
                  </ol>
                </div>
                
                <div className="bg-gray-50 p-4 rounded-lg">
                  <h4 className="font-medium text-gray-900 mb-2">üîó –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</h4>
                  <div className="space-y-3">
                    <div>
                      <label className="block text-sm font-medium mb-1">–¢–æ–∫–µ–Ω –±–æ—Ç–∞</label>
                      <input 
                        type="text" 
                        placeholder="1234567890:ABCdefGHIjklMNOpqrsTUVwxyz"
                        className="w-full p-2 border border-gray-300 rounded-lg text-sm"
                      />
                    </div>
                    <button className="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                      –ü–æ–¥–∫–ª—é—á–∏—Ç—å –±–æ—Ç–∞
                    </button>
                  </div>
                </div>
              </div>
            )}

            {selectedIntegration === 'whatsapp' && (
              <div className="space-y-4">
                <div className="bg-green-50 p-4 rounded-lg">
                  <h4 className="font-medium text-green-900 mb-2">üì± WhatsApp Business API</h4>
                  <ol className="text-sm text-green-800 space-y-2">
                    <li>1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ <a href="https://business.whatsapp.com" target="_blank" className="text-blue-600 hover:underline">business.whatsapp.com</a></li>
                    <li>2. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Meta for Developers</li>
                    <li>3. –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –±–∏–∑–Ω–µ—Å–∞</li>
                    <li>4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook URL</li>
                  </ol>
                </div>
                
                <div className="bg-gray-50 p-4 rounded-lg">
                  <h4 className="font-medium text-gray-900 mb-2">üîó –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</h4>
                  <div className="space-y-3">
                    <div>
                      <label className="block text-sm font-medium mb-1">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                      <input 
                        type="text" 
                        placeholder="+1234567890"
                        className="w-full p-2 border border-gray-300 rounded-lg text-sm"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-1">Access Token</label>
                      <input 
                        type="text" 
                        placeholder="EAA..."
                        className="w-full p-2 border border-gray-300 rounded-lg text-sm"
                      />
                    </div>
                    <button className="w-full bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors">
                      –ü–æ–¥–∫–ª—é—á–∏—Ç—å WhatsApp
                    </button>
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      )}

      {/* Widget Constructor Modal */}
      {showWidgetConstructor && (
        <div className="fixed inset-0 z-50 flex items-center justify-center">
          <div className="absolute inset-0 bg-black/50" onClick={() => setShowWidgetConstructor(false)} />
          <div className="relative bg-white rounded-xl w-full max-w-4xl mx-4 max-h-[90vh] overflow-hidden flex flex-col">
            {/* Header */}
            <div className="flex items-center justify-between p-6 border-b border-gray-200">
              <div className="flex items-center gap-3">
                <button 
                  onClick={() => setShowWidgetConstructor(false)}
                  className="text-gray-400 hover:text-gray-600"
                >
                  ‚Üê
                </button>
                <h3 className="text-xl font-semibold">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ / –í–∏–¥–∂–µ—Ç</h3>
              </div>
              <button 
                onClick={() => {
                  navigator.clipboard.writeText('<script src="https://adapto.ai/widget.js"></script>');
                  showNotificationMessage('–°–∫—Ä–∏–ø—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
                }}
                className="bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-lg text-sm font-medium transition-colors"
              >
                –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç
              </button>
            </div>

            {/* Content */}
            <div className="flex-1 overflow-y-auto p-6">
              <div className="space-y-8">
                {/* Settings */}
                <div className="space-y-6">
                                     {/* Accent Color */}
                   <div>
                     <label className="block text-sm font-medium mb-3">–ê–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ü–≤–µ—Ç</label>
                     <div className="flex items-center gap-3">
                       <input 
                         type="text" 
                         value={widgetSettings.accentColor}
                         onChange={(e) => setWidgetSettings({...widgetSettings, accentColor: e.target.value})}
                         className="flex-1 p-2 border border-gray-300 rounded-lg text-sm"
                         placeholder="HEX"
                       />
                       <input 
                         type="color" 
                         value={widgetSettings.accentColor}
                         onChange={(e) => setWidgetSettings({...widgetSettings, accentColor: e.target.value})}
                         className="w-10 h-10 rounded-lg border-2 border-gray-300 cursor-pointer"
                       />
                       <button 
                         onClick={() => setWidgetSettings({...widgetSettings, accentColor: '#1354FC'})}
                         className="text-gray-400 hover:text-gray-600"
                       >
                         √ó
                       </button>
                     </div>
                   </div>

                  {/* Button Color */}
                  <div>
                    <label className="block text-sm font-medium mb-3">–¶–≤–µ—Ç –∫–Ω–æ–ø–∫–∏</label>
                    <div className="grid grid-cols-3 gap-3">
                      {[
                        { id: 'light', label: '–°–≤–µ—Ç–ª—ã–π —Ñ–æ–Ω', bg: 'bg-white', border: 'border-blue-500', text: 'text-blue-500' },
                        { id: 'dark', label: '–¢–µ–º–Ω—ã–π —Ñ–æ–Ω', bg: 'bg-gray-900', border: 'border-white', text: 'text-white' },
                        { id: 'custom', label: '–ó–∞–¥–∞—Ç—å —Å–≤–æ–π —Ü–≤–µ—Ç', bg: 'bg-gradient-to-r from-yellow-400 via-pink-500 to-blue-500', border: 'border-blue-500', text: 'text-white' }
                                             ].map((style) => (
                         <button
                           key={style.id}
                           onClick={() => setWidgetSettings({...widgetSettings, buttonColor: style.id})}
                           className={`p-3 rounded-lg border-2 transition-all ${
                             widgetSettings.buttonColor === style.id 
                               ? 'border-blue-500 ring-2 ring-blue-200' 
                               : 'border-gray-200 hover:border-gray-300'
                           }`}
                         >
                           <div 
                             className={`w-[140px] h-[42px] rounded-xl flex items-center justify-center gap-2 mb-2 mx-auto ${
                               style.id === 'light' ? 'bg-white border-2 border-gray-300' :
                               style.id === 'dark' ? 'bg-gray-900' :
                               'bg-gradient-to-r from-yellow-400 via-pink-500 to-blue-500'
                             }`}
                             style={{
                               borderColor: style.id === 'light' ? widgetSettings.accentColor : 'transparent',
                               color: style.id === 'light' ? widgetSettings.accentColor : 'white'
                             }}
                           >
                             <div 
                               className="w-4 h-4 rounded-full opacity-80"
                               style={{ backgroundColor: style.id === 'light' ? widgetSettings.accentColor : 'currentColor' }}
                             ></div>
                             <span className="text-sm font-medium" style={{ maxWidth: '90px', overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>
                               –°–ø—Ä–æ—Å–∏—Ç—å –ò–ò
                             </span>
                           </div>
                           <span className={`text-xs ${widgetSettings.buttonColor === style.id ? 'text-blue-600' : 'text-gray-600'}`}>
                             {style.label}
                           </span>
                         </button>
                       ))}
                    </div>
                  </div>

                                     {/* Button Text */}
                   <div>
                     <label className="block text-sm font-medium mb-3">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏</label>
                     <input 
                       type="text" 
                       value={widgetSettings.buttonText}
                       onChange={(e) => setWidgetSettings({...widgetSettings, buttonText: e.target.value})}
                       className="w-full p-2 border border-gray-300 rounded-lg text-sm"
                       placeholder="–°–ø—Ä–æ—Å–∏—Ç—å –ò–ò"
                     />
                   </div>

                  {/* Avatar */}
                  <div>
                    <label className="block text-sm font-medium mb-3">–ê–≤–∞—Ç–∞—Ä Adapto</label>
                    <div className="grid grid-cols-2 gap-3">
                      <button
                        onClick={() => setWidgetSettings({...widgetSettings, avatar: 'default'})}
                        className={`p-3 rounded-lg border-2 transition-all ${
                          widgetSettings.avatar === 'default' 
                            ? 'border-blue-500 ring-2 ring-blue-200' 
                            : 'border-gray-200 hover:border-gray-300'
                        }`}
                      >
                        <div className="w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full mx-auto mb-2 flex items-center justify-center">
                          <div className="flex items-center justify-center w-6 h-6">
                            <div className="w-3 h-3 bg-white rounded-full mr-1"></div>
                            <div className="w-1.5 h-1.5 bg-white rounded-full"></div>
                          </div>
                        </div>
                        <span className="text-xs text-center block">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</span>
                      </button>
                                             <button
                         onClick={() => document.getElementById('avatar-input')?.click()}
                         className={`p-3 rounded-lg border-2 transition-all ${
                           widgetSettings.avatar === 'custom' 
                             ? 'border-blue-500 ring-2 ring-blue-200' 
                             : 'border-gray-200 hover:border-gray-300'
                         }`}
                       >
                         <div className="w-12 h-12 bg-gray-200 rounded-full mx-auto mb-2 flex items-center justify-center">
                           <span className="text-gray-500">+</span>
                         </div>
                         <span className="text-xs text-center block">–ó–∞–≥—Ä—É–∑–∏—Ç—å</span>
                         <input 
                           id="avatar-input"
                           type="file" 
                           accept="image/*"
                           className="hidden" 
                           onChange={(e) => {
                             const file = e.target.files?.[0];
                             if (file) {
                               setWidgetSettings({...widgetSettings, avatar: 'custom'});
                               showNotificationMessage('–ê–≤–∞—Ç–∞—Ä –∑–∞–≥—Ä—É–∂–µ–Ω!');
                             }
                           }}
                         />
                       </button>
                    </div>
                  </div>
                </div>

                                 {/* Custom Color Picker */}
                 {widgetSettings.buttonColor === 'custom' && (
                   <div>
                     <label className="block text-sm font-medium mb-3">–í–≤–µ–¥–∏—Ç–µ —Ü–≤–µ—Ç –¥–ª—è —Ñ–æ–Ω–∞</label>
                     <div className="flex items-center gap-3">
                       <input 
                         type="text" 
                         value={widgetSettings.customButtonColor}
                         onChange={(e) => setWidgetSettings({...widgetSettings, customButtonColor: e.target.value})}
                         className="flex-1 p-2 border border-gray-300 rounded-lg text-sm"
                         placeholder="HEX"
                       />
                       <input 
                         type="color" 
                         value={widgetSettings.customButtonColor}
                         onChange={(e) => setWidgetSettings({...widgetSettings, customButtonColor: e.target.value})}
                         className="w-10 h-10 rounded-lg border-2 border-gray-300 cursor-pointer"
                       />
                     </div>
                   </div>
                 )}

                                 {/* Widget Location */}
                 <div>
                   <label className="block text-sm font-medium mb-3">–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞</label>
                   <div className="flex gap-3">
                     <button
                       onClick={() => setWidgetSettings({...widgetSettings, widgetLocation: 'default'})}
                       className={`px-4 py-2 rounded-lg border-2 transition-all ${
                         widgetSettings.widgetLocation === 'default' 
                           ? 'border-blue-500 bg-blue-50 text-blue-700' 
                           : 'border-gray-200 hover:border-gray-300'
                       }`}
                     >
                       –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
                     </button>
                     <button
                       onClick={() => setWidgetSettings({...widgetSettings, widgetLocation: 'custom'})}
                       className={`px-4 py-2 rounded-lg border-2 transition-all ${
                         widgetSettings.widgetLocation === 'custom' 
                           ? 'border-blue-500 bg-blue-50 text-blue-700' 
                           : 'border-gray-200 hover:border-gray-300'
                       }`}
                     >
                       –ù–∞—Å—Ç—Ä–æ–∏—Ç—å
                     </button>
                   </div>
                   {widgetSettings.widgetLocation === 'custom' && (
                     <div className="mt-4 space-y-4">
                       <div>
                         <h4 className="text-sm font-medium mb-2">–î–ª—è –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤</h4>
                         <div className="grid grid-cols-2 gap-3">
                           <div>
                             <label className="block text-xs text-gray-600 mb-1">–û—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É</label>
                             <input 
                               type="number" 
                               value={widgetSettings.desktopBottomOffset}
                               onChange={(e) => setWidgetSettings({...widgetSettings, desktopBottomOffset: parseInt(e.target.value)})}
                               className="w-full p-2 border border-gray-300 rounded-lg text-sm"
                             />
                           </div>
                           <div>
                             <label className="block text-xs text-gray-600 mb-1">–û—Ç—Å—Ç—É–ø —Å–ø—Ä–∞–≤–∞</label>
                             <input 
                               type="number" 
                               value={widgetSettings.desktopRightOffset}
                               onChange={(e) => setWidgetSettings({...widgetSettings, desktopRightOffset: parseInt(e.target.value)})}
                               className="w-full p-2 border border-gray-300 rounded-lg text-sm"
                             />
                           </div>
                         </div>
                       </div>
                       <div>
                         <h4 className="text-sm font-medium mb-2">–î–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤</h4>
                         <div className="grid grid-cols-2 gap-3">
                           <div>
                             <label className="block text-xs text-gray-600 mb-1">–û—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É</label>
                             <input 
                               type="number" 
                               value={widgetSettings.mobileBottomOffset}
                               onChange={(e) => setWidgetSettings({...widgetSettings, mobileBottomOffset: parseInt(e.target.value)})}
                               className="w-full p-2 border border-gray-300 rounded-lg text-sm"
                             />
                           </div>
                           <div>
                             <label className="block text-xs text-gray-600 mb-1">–û—Ç—Å—Ç—É–ø —Å–ø—Ä–∞–≤–∞</label>
                             <input 
                               type="number" 
                               value={widgetSettings.mobileRightOffset}
                               onChange={(e) => setWidgetSettings({...widgetSettings, mobileRightOffset: parseInt(e.target.value)})}
                               className="w-full p-2 border border-gray-300 rounded-lg text-sm"
                             />
                           </div>
                         </div>
                       </div>
                       <div>
                         <label className="block text-xs text-gray-600 mb-1">z-index</label>
                         <input 
                           type="number" 
                           value={widgetSettings.zIndex}
                           onChange={(e) => setWidgetSettings({...widgetSettings, zIndex: parseInt(e.target.value)})}
                           className="w-full p-2 border border-gray-300 rounded-lg text-sm"
                         />
                       </div>
                     </div>
                   )}
                 </div>

                                 {/* Welcome Message */}
                 <div>
                   <label className="block text-sm font-medium mb-3">
                     –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                   </label>
                   <div className="space-y-3">
                     {widgetSettings.welcomeMessages.map((message, index) => (
                       <div key={index} className="flex gap-2">
                         <textarea 
                           value={message}
                           onChange={(e) => {
                             const newMessages = [...widgetSettings.welcomeMessages];
                             newMessages[index] = e.target.value;
                             setWidgetSettings({...widgetSettings, welcomeMessages: newMessages});
                           }}
                           className="flex-1 p-3 border border-gray-300 rounded-lg text-sm resize-none"
                           rows={2}
                           placeholder="–ü—Ä–∏–≤–µ—Ç! –ú–µ–Ω—è –∑–æ–≤—É—Ç Adapto, —è –ò–ò –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç."
                         />
                         {widgetSettings.welcomeMessages.length > 1 && (
                           <button 
                             onClick={() => {
                               const newMessages = widgetSettings.welcomeMessages.filter((_, i) => i !== index);
                               setWidgetSettings({...widgetSettings, welcomeMessages: newMessages});
                             }}
                             className="px-3 py-2 text-red-600 hover:text-red-700 text-sm border border-red-300 rounded-lg hover:bg-red-50"
                           >
                             √ó
                           </button>
                         )}
                       </div>
                     ))}
                   </div>
                   <button 
                     onClick={() => {
                       const newMessages = [...widgetSettings.welcomeMessages, '–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ'];
                       setWidgetSettings({...widgetSettings, welcomeMessages: newMessages});
                     }}
                     className="mt-2 text-blue-600 hover:text-blue-700 text-sm"
                   >
                     –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ +
                   </button>
                 </div>

                                 {/* Trigger Question */}
                 <div>
                   <label className="block text-sm font-medium mb-3">–¢—Ä–∏–≥–≥–µ—Ä–Ω—ã–π –≤–æ–ø—Ä–æ—Å</label>
                   <div className="grid grid-cols-2 gap-3">
                     <button
                       onClick={() => setWidgetSettings({...widgetSettings, triggerQuestionEnabled: 'no'})}
                       className={`p-3 rounded-lg border-2 transition-all ${
                         widgetSettings.triggerQuestionEnabled === 'no' 
                           ? 'border-blue-500 ring-2 ring-blue-200' 
                           : 'border-gray-200 hover:border-gray-300'
                       }`}
                     >
                       <div className="w-[140px] h-[42px] rounded-xl flex items-center justify-center gap-2 mb-2 bg-white border-2 border-gray-300">
                         <div className="w-4 h-4 rounded-full bg-blue-500 opacity-80"></div>
                         <span className="text-sm font-medium text-gray-700">–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å</span>
                       </div>
                       <span className="text-xs text-center block">–ù–µ—Ç</span>
                     </button>
                     <button
                       onClick={() => setWidgetSettings({...widgetSettings, triggerQuestionEnabled: 'yes'})}
                       className={`p-3 rounded-lg border-2 transition-all ${
                         widgetSettings.triggerQuestionEnabled === 'yes' 
                           ? 'border-blue-500 ring-2 ring-blue-200' 
                           : 'border-gray-200 hover:border-gray-300'
                       }`}
                     >
                       <div className="w-[140px] h-[42px] rounded-xl flex items-center justify-center gap-2 mb-2 bg-white border-2 border-gray-300">
                         <div className="w-4 h-4 rounded-full bg-blue-500 opacity-80"></div>
                         <span className="text-sm font-medium text-gray-700">–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å</span>
                       </div>
                       <span className="text-xs text-center block">–ï—Å—Ç—å</span>
                     </button>
                   </div>
                   
                   {widgetSettings.triggerQuestionEnabled === 'yes' && (
                     <div className="mt-4 space-y-3">
                       <div>
                         <label className="block text-sm font-medium mb-1">–ß–µ—Ä–µ–∑ –∫–∞–∫–æ–µ –≤—Ä–µ–º—è –ø–æ–∫–∞–∑–∞—Ç—å:</label>
                         <div className="flex items-center gap-2">
                           <input 
                             type="number" 
                             value={widgetSettings.triggerQuestionDelay}
                             onChange={(e) => setWidgetSettings({...widgetSettings, triggerQuestionDelay: parseInt(e.target.value)})}
                             className="w-20 p-2 border border-gray-300 rounded-lg text-sm"
                           />
                           <span className="text-sm text-gray-600">—Å–µ–∫</span>
                         </div>
                       </div>
                       <div>
                         <label className="block text-sm font-medium mb-1">–í–æ–ø—Ä–æ—Å:</label>
                         <input 
                           type="text" 
                           value={widgetSettings.triggerQuestionText}
                           onChange={(e) => setWidgetSettings({...widgetSettings, triggerQuestionText: e.target.value})}
                           className="w-full p-2 border border-gray-300 rounded-lg text-sm"
                           placeholder="–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ï—Å–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è –≤–æ–ø—Ä–æ—Å, –º–æ–∂–µ—Ç–µ –∑–∞–¥–∞—Ç—å –µ–≥–æ –≤ —á–∞—Ç–µ, —è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ –æ—Ç–≤–µ—á—É"
                         />
                       </div>
                       <div>
                         <label className="block text-sm font-medium mb-1">–ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã:</label>
                         <input 
                           type="text" 
                           value={widgetSettings.triggerQuickReply}
                           onChange={(e) => setWidgetSettings({...widgetSettings, triggerQuickReply: e.target.value})}
                           className="w-full p-2 border border-gray-300 rounded-lg text-sm"
                           placeholder="–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å"
                         />
                       </div>
                     </div>
                   )}
                 </div>

                {/* Follow Up Message */}
                <div>
                  <label className="block text-sm font-medium mb-3">Follow up —Å–æ–æ–±—â–µ–Ω–∏–µ</label>
                  <p className="text-sm text-gray-600 mb-3">–°–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —É–≤–∏–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –µ—Å–ª–∏ –≤—ã–π–¥–µ—Ç –∏–∑ –¥–∏–∞–ª–æ–≥–∞</p>
                  <div className="grid grid-cols-2 gap-3 mb-4">
                    <button
                      onClick={() => setWidgetSettings({...widgetSettings, followUpMessage: 'no'})}
                      className={`p-3 rounded-lg border-2 transition-all ${
                        widgetSettings.followUpMessage === 'no' 
                          ? 'border-blue-500 ring-2 ring-blue-200' 
                          : 'border-gray-200 hover:border-gray-300'
                      }`}
                    >
                      <div className="w-[200px] h-[42px] rounded-xl flex items-center justify-center mb-2 bg-white border-2 border-gray-300">
                        <span className="text-sm font-medium text-gray-700">–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å</span>
                      </div>
                      <span className="text-xs text-center block">–ù–µ—Ç</span>
                    </button>
                    <button
                      onClick={() => setWidgetSettings({...widgetSettings, followUpMessage: 'yes'})}
                      className={`p-3 rounded-lg border-2 transition-all ${
                        widgetSettings.followUpMessage === 'yes' 
                          ? 'border-blue-500 ring-2 ring-blue-200' 
                          : 'border-gray-200 hover:border-gray-300'
                      }`}
                    >
                      <div className="w-[140px] h-[42px] rounded-xl flex items-center justify-center mb-2 bg-white border-2 border-gray-300">
                        <div className="flex items-center gap-2">
                          <div className="w-4 h-4 rounded-full bg-blue-500"></div>
                          <div className="w-16 h-3 bg-gray-200 rounded"></div>
                        </div>
                        <div className="w-[200px] h-[42px] rounded-xl flex items-center justify-center mt-2 bg-white border-2 border-gray-300">
                          <span className="text-sm font-medium text-gray-700">–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å</span>
                        </div>
                      </div>
                      <span className="text-xs text-center block">–ï—Å—Ç—å</span>
                    </button>
                  </div>
                  
                                     {widgetSettings.followUpMessage === 'yes' && (
                     <div className="mt-4 space-y-3">
                       <div>
                         <label className="block text-sm font-medium mb-1">–ß–µ—Ä–µ–∑ –∫–∞–∫–æ–µ –≤—Ä–µ–º—è –ø–æ–∫–∞–∑–∞—Ç—å:</label>
                         <div className="flex items-center gap-2">
                           <input 
                             type="number" 
                             value={widgetSettings.followUpDelay}
                             onChange={(e) => setWidgetSettings({...widgetSettings, followUpDelay: parseInt(e.target.value)})}
                             className="w-20 p-2 border border-gray-300 rounded-lg text-sm"
                           />
                           <span className="text-sm text-gray-600">—Å–µ–∫</span>
                         </div>
                       </div>
                       <div>
                         <label className="block text-sm font-medium mb-1">–í–æ–ø—Ä–æ—Å:</label>
                         <input 
                           type="text" 
                           value={widgetSettings.followUpQuestion}
                           onChange={(e) => setWidgetSettings({...widgetSettings, followUpQuestion: e.target.value})}
                           className="w-full p-2 border border-gray-300 rounded-lg text-sm"
                           placeholder="–ü—Ä–æ–¥–æ–ª–∂–∏–º –¥–∏–∞–ª–æ–≥?"
                         />
                       </div>
                       <div>
                         <label className="block text-sm font-medium mb-1">–ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã:</label>
                         <input 
                           type="text" 
                           value={widgetSettings.followUpQuickReply}
                           onChange={(e) => setWidgetSettings({...widgetSettings, followUpQuickReply: e.target.value})}
                           className="w-full p-2 border border-gray-300 rounded-lg text-sm"
                           placeholder="–†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ"
                         />
                       </div>
                     </div>
                   )}
                </div>

                {/* Quick Replies */}
                <div>
                  <label className="block text-sm font-medium mb-3">–ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã:</label>
                  <div className="space-y-2">
                    {widgetSettings.quickReplies.map((reply, index) => (
                      <div key={index} className="flex items-center gap-2">
                        <input 
                          type="text" 
                          value={reply}
                          onChange={(e) => {
                            const newReplies = [...widgetSettings.quickReplies];
                            newReplies[index] = e.target.value;
                            setWidgetSettings({...widgetSettings, quickReplies: newReplies});
                          }}
                          className="flex-1 p-2 border border-gray-300 rounded-lg text-sm"
                          placeholder="–†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ"
                        />
                        <button 
                          onClick={() => {
                            const newReplies = widgetSettings.quickReplies.filter((_, i) => i !== index);
                            setWidgetSettings({...widgetSettings, quickReplies: newReplies});
                          }}
                          className="text-gray-400 hover:text-red-600"
                        >
                          √ó
                        </button>
                      </div>
                    ))}
                    <button 
                      onClick={() => setWidgetSettings({...widgetSettings, quickReplies: [...widgetSettings.quickReplies, '']})}
                      className="text-blue-600 hover:text-blue-700 text-sm"
                    >
                      –î–æ–±–∞–≤–∏—Ç—å –±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç +
                    </button>
                  </div>
                </div>

                {/* Privacy Policy */}
                <div>
                  <label className="block text-sm font-medium mb-3">–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª–∏—Ç–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</label>
                  <p className="text-sm text-gray-600 mb-2">–£–∫–∞–∂–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Å–≤–æ—é –ø–æ–ª–∏—Ç–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö ‚Äî —ç—Ç–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ 152-–§–ó</p>
                  <input 
                    type="url" 
                    value={widgetSettings.privacyPolicyUrl}
                    onChange={(e) => setWidgetSettings({...widgetSettings, privacyPolicyUrl: e.target.value})}
                    className="w-full p-2 border border-gray-300 rounded-lg text-sm"
                    placeholder="https://"
                  />
                </div>

                {/* Data Tags */}
                <div>
                  <label className="block text-sm font-medium mb-3">–ö–∞–∫–∏–µ –º–µ—Ç–∫–∏ —Å–æ–±–∏—Ä–∞—Ç—å</label>
                  <p className="text-sm text-gray-600 mb-3">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Å–µ –º–µ—Ç–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–µ–Ω —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å Adapto. –ï—Å–ª–∏ –º–µ—Ç–∫–∏ –Ω–µ—Ç –≤ —Å–ø–∏—Å–∫–µ ‚Äî –≤–≤–µ–¥–∏—Ç–µ –µ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</p>
                  <div className="flex flex-wrap gap-2 mb-3">
                    {widgetSettings.dataTags.map((tag, index) => (
                      <div key={index} className="flex items-center gap-1 bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">
                        <span>{tag}</span>
                        <button 
                          onClick={() => {
                            const newTags = widgetSettings.dataTags.filter((_, i) => i !== index);
                            setWidgetSettings({...widgetSettings, dataTags: newTags});
                          }}
                          className="text-blue-600 hover:text-red-600"
                        >
                          √ó
                        </button>
                      </div>
                    ))}
                    <button 
                      onClick={() => setWidgetSettings({...widgetSettings, dataTags: [...widgetSettings.dataTags, '']})}
                      className="text-blue-600 hover:text-blue-700 text-sm border border-gray-300 rounded-lg px-3 py-1"
                    >
                      –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∫—É +
                    </button>
                  </div>
                </div>

                                 {/* Excluded Pages */}
                 <div>
                   <label className="block text-sm font-medium mb-3">–ò—Å–∫–ª—é—á–µ–Ω–∏–µ Adapto</label>
                   <p className="text-sm text-gray-600 mb-3">–£–∫–∞–∂–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö Adapto –Ω–µ –¥–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è</p>
                   <div className="space-y-2">
                     {widgetSettings.excludedPages.map((page, index) => (
                       <div key={index} className="flex items-center gap-2">
                         <input 
                           type="url" 
                           value={page}
                           onChange={(e) => {
                             const newPages = [...widgetSettings.excludedPages];
                             newPages[index] = e.target.value;
                             setWidgetSettings({...widgetSettings, excludedPages: newPages});
                           }}
                           className="flex-1 p-2 border border-gray-300 rounded-lg text-sm"
                           placeholder="https://example.com/page"
                         />
                         <button 
                           onClick={() => {
                             const newPages = widgetSettings.excludedPages.filter((_, i) => i !== index);
                             setWidgetSettings({...widgetSettings, excludedPages: newPages});
                           }}
                           className="text-gray-400 hover:text-red-600"
                         >
                           √ó
                         </button>
                       </div>
                     ))}
                     <button 
                       onClick={() => setWidgetSettings({...widgetSettings, excludedPages: [...widgetSettings.excludedPages, '']})}
                       className="text-blue-600 hover:text-blue-700 text-sm border border-gray-300 rounded-lg px-3 py-1"
                     >
                       –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É +
                     </button>
                   </div>
                 </div>
              </div>
            </div>

            {/* Fixed Bottom Buttons */}
            <div className="p-6 border-t border-gray-200 bg-white">
              <div className="flex gap-3">
                <button 
                  onClick={() => {
                    showNotificationMessage('–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
                    setShowWidgetConstructor(false);
                  }}
                  className="flex-1 bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors font-medium"
                >
                  –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                </button>
                <button 
                  onClick={() => {
                    window.open('/preview', '_blank');
                    showNotificationMessage('–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç–∫—Ä—ã—Ç –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ');
                  }}
                  className="bg-white border border-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-50 transition-colors font-medium flex items-center gap-2"
                >
                  <span>üëÅ</span>
                  –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                </button>
                <button 
                  onClick={() => {
                    navigator.clipboard.writeText('<script src="https://adapto.ai/widget.js"></script>');
                    showNotificationMessage('–°–∫—Ä–∏–ø—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
                  }}
                  className="bg-white border border-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-50 transition-colors font-medium flex items-center gap-2"
                >
                  <span>üìã</span>
                  –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  )
}