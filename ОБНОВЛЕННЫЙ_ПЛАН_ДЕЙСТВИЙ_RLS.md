# üìã –û–ë–ù–û–í–õ–ï–ù–ù–´–ô –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô RLS

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (–®–ê–ì 1-4):
1. **users** - ‚úÖ `id = auth.uid()`
2. **projects** - ‚úÖ `owner_id = auth.uid()`
3. **project_members** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())`
4. **assistants** - ‚úÖ `owner_id = auth.uid()`

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (–®–ê–ì 6-18):
5. **autoswitch_settings** - ‚úÖ `user_id = auth.uid()` (–ª–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
6. **conversations** - ‚úÖ `owner_id = auth.uid()` (—Ä–∞–∑–≥–æ–≤–æ—Ä—ã –≤–ª–∞–¥–µ–ª—å—Ü–∞)
7. **user_niches** - ‚úÖ `user_id = auth.uid() AND project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è)
8. **niche_synonyms** - ‚úÖ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫: —á—Ç–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö, –∑–∞–ø–∏—Å—å –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤
9. **ai_agent_settings** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
10. **dialogs** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
11. **chat_messages** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
12. **widget_development_settings** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞)

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (—Ç—Ä–µ–±—É—é—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è):
1. **telegram_settings** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram –ø—Ä–æ–µ–∫—Ç–∞
2. **knowledge_sources** - –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∑–Ω–∞–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞
3. **knowledge_chunks** - —á–∞–Ω–∫–∏ –∑–Ω–∞–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞
4. **crm_clients** - –∫–ª–∏–µ–Ω—Ç—ã CRM –ø—Ä–æ–µ–∫—Ç–∞
5. **crm_deals** - —Å–¥–µ–ª–∫–∏ CRM –ø—Ä–æ–µ–∫—Ç–∞
6. **crm_operators** - –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã CRM –ø—Ä–æ–µ–∫—Ç–∞

### –í–æ–∑–º–æ–∂–Ω—ã–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏:
7. **niches** - –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–∂–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫
8. **chunk_synonyms** - –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–∂–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫

## üöÄ –ì–û–¢–û–í–´–ï –°–ö–†–ò–ü–¢–´

### –ù–ï–ú–ï–î–õ–ï–ù–ù–û –í–´–ü–û–õ–ù–ò–¢–¨:
1. **`–®–ê–ì_16_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_TELEGRAM_SETTINGS_–ü–†–û–ï–ö–¢.sql`** - –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `telegram_settings`
2. **`–®–ê–ì_18_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_KNOWLEDGE_SOURCES_–ü–†–û–ï–ö–¢.sql`** - –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `knowledge_sources`

### –ü–û–°–õ–ï –£–°–ü–ï–•–ê –°–û–ó–î–ê–¢–¨:
3. **`–®–ê–ì_19_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_KNOWLEDGE_CHUNKS_–ü–†–û–ï–ö–¢.sql`** - –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `knowledge_chunks`
4. **`–®–ê–ì_20_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_CRM_CLIENTS_–ü–†–û–ï–ö–¢.sql`** - –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `crm_clients`
5. **`–®–ê–ì_21_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_CRM_DEALS_–ü–†–û–ï–ö–¢.sql`** - –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `crm_deals`
6. **`–®–ê–ì_22_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_CRM_OPERATORS_–ü–†–û–ï–ö–¢.sql`** - –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `crm_operators`

## üîç –õ–û–ì–ò–ö–ê RLS

### 1. PROJECT_ID –ª–æ–≥–∏–∫–∞ (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞):
- `telegram_settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram –ø—Ä–æ–µ–∫—Ç–∞
- `knowledge_sources` - –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∑–Ω–∞–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞
- `knowledge_chunks` - —á–∞–Ω–∫–∏ –∑–Ω–∞–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞
- `crm_clients` - –∫–ª–∏–µ–Ω—Ç—ã CRM –ø—Ä–æ–µ–∫—Ç–∞
- `crm_deals` - —Å–¥–µ–ª–∫–∏ CRM –ø—Ä–æ–µ–∫—Ç–∞
- `crm_operators` - –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã CRM –ø—Ä–æ–µ–∫—Ç–∞

### 2. –°–ø—Ä–∞–≤–æ—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ (–æ–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ):
- `niches` - –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–∂–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫
- `chunk_synonyms` - –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–∂–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫

## üìû –¢–†–ï–ë–£–ï–¢–°–Ø –î–ï–ô–°–¢–í–ò–ï

### –°–ï–ô–ß–ê–°:
1. –í—ã–ø–æ–ª–Ω–∏—Ç—å `–®–ê–ì_16_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_TELEGRAM_SETTINGS_–ü–†–û–ï–ö–¢.sql`
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å `–®–ê–ì_18_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_KNOWLEDGE_SOURCES_–ü–†–û–ï–ö–¢.sql`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü–û–°–õ–ï –£–°–ü–ï–•–ê:
–°–æ–∑–¥–∞–º —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü

## üí° –í–ê–ñ–ù–û

**–¢–∞–±–ª–∏—Ü–∞ `bot_corrections` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç** - —É–±—Ä–∞–Ω–∞ –∏–∑ –ø–ª–∞–Ω–∞.

–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ —Ç—Ä–µ–±—É—é—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è RLS.
