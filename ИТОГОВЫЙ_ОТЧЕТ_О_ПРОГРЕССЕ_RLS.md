# üìä –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢ –û –ü–†–û–ì–†–ï–°–°–ï RLS

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (–®–ê–ì 1-4):
1. **users** - ‚úÖ `id = auth.uid()`
2. **projects** - ‚úÖ `owner_id = auth.uid()`
3. **project_members** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())`
4. **assistants** - ‚úÖ `owner_id = auth.uid()`

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (–®–ê–ì 6-25):
5. **autoswitch_settings** - ‚úÖ `user_id = auth.uid()` (–ª–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
6. **conversations** - ‚úÖ `owner_id = auth.uid()` (—Ä–∞–∑–≥–æ–≤–æ—Ä—ã –≤–ª–∞–¥–µ–ª—å—Ü–∞)
7. **user_niches** - ‚úÖ `user_id = auth.uid() AND project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è)
8. **niche_synonyms** - ‚úÖ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫: —á—Ç–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö, –∑–∞–ø–∏—Å—å –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤
9. **ai_agent_settings** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
10. **dialogs** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
11. **chat_messages** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
12. **widget_development_settings** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
13. **telegram_settings** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
14. **knowledge_sources** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
15. **knowledge_chunks** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
16. **crm_clients** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
17. **crm_deals** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
18. **crm_operators** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
19. **crm_tasks** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
20. **crm_deal_notes** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
21. **dialog_crm_connections** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞)

## üéØ –ü–†–ò–ú–ï–ù–ï–ù–ù–´–ï –°–¢–†–ê–¢–ï–ì–ò–ò

### 1. PROJECT_ID –ª–æ–≥–∏–∫–∞ (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞):
- `ai_agent_settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≥–µ–Ω—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞
- `dialogs` - –¥–∏–∞–ª–æ–≥–∏ –ø—Ä–æ–µ–∫—Ç–∞
- `chat_messages` - —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ
- `widget_development_settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏–¥–∂–µ—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞
- `telegram_settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram –ø—Ä–æ–µ–∫—Ç–∞
- `knowledge_sources` - –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∑–Ω–∞–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞
- `knowledge_chunks` - —á–∞–Ω–∫–∏ –∑–Ω–∞–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞
- `crm_clients` - –∫–ª–∏–µ–Ω—Ç—ã CRM –ø—Ä–æ–µ–∫—Ç–∞
- `crm_deals` - —Å–¥–µ–ª–∫–∏ CRM –ø—Ä–æ–µ–∫—Ç–∞
- `crm_operators` - –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã CRM –ø—Ä–æ–µ–∫—Ç–∞
- `crm_tasks` - –∑–∞–¥–∞—á–∏ CRM –ø—Ä–æ–µ–∫—Ç–∞
- `crm_deal_notes` - –∑–∞–º–µ—Ç–∫–∏ –∫ —Å–¥–µ–ª–∫–∞–º CRM –ø—Ä–æ–µ–∫—Ç–∞
- `dialog_crm_connections` - —Å–≤—è–∑–∏ –¥–∏–∞–ª–æ–≥–æ–≤ —Å CRM –ø—Ä–æ–µ–∫—Ç–∞

### 2. USER_ID –ª–æ–≥–∏–∫–∞ (–ª–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏):
- `autoswitch_settings` - –ª–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 3. OWNER_ID –ª–æ–≥–∏–∫–∞ (–≤–ª–∞–¥–µ–ª–µ—Ü):
- `conversations` - —Ä–∞–∑–≥–æ–≤–æ—Ä—ã –≤–ª–∞–¥–µ–ª—å—Ü–∞

### 4. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ (–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ):
- `user_niches` - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∏—à–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø—Ä–æ–µ–∫—Ç–µ

### 5. –°–ø—Ä–∞–≤–æ—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ (–æ–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ):
- `niche_synonyms` - —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Å–∏–Ω–æ–Ω–∏–º–æ–≤

## üìã –û–°–¢–ê–í–®–ò–ï–°–Ø –¢–ê–ë–õ–ò–¶–´

### –ì–æ—Ç–æ–≤—ã–µ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é:
1. **faq_cache** - –∫—ç—à FAQ –ø—Ä–æ–µ–∫—Ç–∞
2. **help_requests** - –∑–∞–ø—Ä–æ—Å—ã –ø–æ–º–æ—â–∏ –ø—Ä–æ–µ–∫—Ç–∞

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (—Ç—Ä–µ–±—É—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏):
3. **dialog_with_operators** - –¥–∏–∞–ª–æ–≥–∏ —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏ (–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ)

### –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
4. **integration_dialogs** - –¥–∏–∞–ª–æ–≥–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π –ø—Ä–æ–µ–∫—Ç–∞
5. **integration_messages** - —Å–æ–æ–±—â–µ–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π –ø—Ä–æ–µ–∫—Ç–∞
6. **messages** - —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
7. **messenger_contacts** - –∫–æ–Ω—Ç–∞–∫—Ç—ã –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞
8. **notification_logs** - –ª–æ–≥–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞
9. **notifications** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
10. **prompt_logs** - –ª–æ–≥–∏ –ø—Ä–æ–º–ø—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞
11. **stories** - –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
12. **telegram_bots** - Telegram –±–æ—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞
13. **telegram_notifications** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è Telegram –ø—Ä–æ–µ–∫—Ç–∞
14. **user_integrations** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–æ–µ–∫—Ç–∞
15. **widget_api_keys** - API –∫–ª—é—á–∏ –≤–∏–¥–∂–µ—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞
16. **working_hours** - —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã –ø—Ä–æ–µ–∫—Ç–∞

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –ù–ï–ú–ï–î–õ–ï–ù–ù–û:
1. –í—ã–ø–æ–ª–Ω–∏—Ç—å `–®–ê–ì_27_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_FAQ_CACHE_–ü–†–û–ï–ö–¢.sql`
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å `–®–ê–ì_28_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_HELP_REQUESTS_–ü–†–û–ï–ö–¢.sql`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü–û–°–õ–ï –£–°–ü–ï–•–ê:
1. –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å PROJECT_ID –ª–æ–≥–∏–∫—É –¥–ª—è –≤—Å–µ—Ö –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Ç–∞–±–ª–∏—Ü
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å—é —Å–∏—Å—Ç–µ–º—É

## üí° –í–´–í–û–î–´

### 1. –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç:
- PROJECT_ID –ª–æ–≥–∏–∫–∞ –¥–ª—è –∫–æ–º–∞–Ω–¥–Ω–æ–π —Ä–∞–±–æ—Ç—ã
- USER_ID –ª–æ–≥–∏–∫–∞ –¥–ª—è –ª–∏—á–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–æ–µ–∫—Ç–µ
- –°–ø—Ä–∞–≤–æ—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –æ–±—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

### 2. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- –ü—Ä–æ—Å—Ç—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –±—ã—Å—Ç—Ä–æ
- –ù–µ—Ç —Å–ª–æ–∂–Ω—ã—Ö UNION –∑–∞–ø—Ä–æ—Å–æ–≤
- –ò–Ω–¥–µ–∫—Å—ã –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è –ø–æ–∫–∞

### 3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- –î–∞–Ω–Ω—ã–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
- –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–º

### 4. –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö:
- –í—Å–µ `user_id` –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –∫ —Ç–∏–ø—É `uuid`
- –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- RLS –ø–æ–ª–∏—Ç–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üìû –¢–†–ï–ë–£–ï–¢–°–Ø –î–ï–ô–°–¢–í–ò–ï
–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∏ —Å–æ–æ–±—â–∏—Ç–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã.

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ JOIN –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –£–±—Ä–∞–Ω—ã –æ—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- –°–æ–∑–¥–∞–Ω—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∞–Ω—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (views)

## üéØ –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–°
- ‚úÖ 21 —Ç–∞–±–ª–∏—Ü–∞ —Å RLS –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏
- ‚úÖ –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –¢–µ—Å—Ç –∏–∑–æ–ª—è—Ü–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞
