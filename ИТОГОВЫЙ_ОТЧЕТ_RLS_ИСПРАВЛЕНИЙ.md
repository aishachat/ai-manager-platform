# üéØ –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢: –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï RLS –ü–û–õ–ò–¢–ò–ö

## üìä **–û–ë–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê**

### ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**
- **33 —à–∞–≥–∞** –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è RLS –ø–æ–ª–∏—Ç–∏–∫
- **–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã** —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **–ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è** –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏

### üìã **–û–ë–†–ê–ë–û–¢–ê–ù–ù–´–ï –¢–ê–ë–õ–ò–¶–´**

#### **–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (4)**
1. ‚úÖ `users` - –∏–∑–æ–ª—è—Ü–∏—è –ø–æ `user_id = auth.uid()`
2. ‚úÖ `projects` - –∏–∑–æ–ª—è—Ü–∏—è –ø–æ `owner_id = auth.uid()`
3. ‚úÖ `project_members` - –∏–∑–æ–ª—è—Ü–∏—è –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º –≤–ª–∞–¥–µ–ª—å—Ü–∞
4. ‚úÖ `assistants` - –∏–∑–æ–ª—è—Ü–∏—è –ø–æ `owner_id = auth.uid()`

#### **AI –∞–≥–µ–Ω—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (3)**
5. ‚úÖ `autoswitch_settings` - –∏–∑–æ–ª—è—Ü–∏—è –ø–æ `user_id = auth.uid()`
6. ‚úÖ `ai_agent_settings` - –∏–∑–æ–ª—è—Ü–∏—è –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º –≤–ª–∞–¥–µ–ª—å—Ü–∞
7. ‚úÖ `user_niches` - –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è (user_id + project_id)

#### **–ß–∞—Ç –∏ –¥–∏–∞–ª–æ–≥–∏ (3)**
8. ‚úÖ `dialogs` - –∏–∑–æ–ª—è—Ü–∏—è –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º –≤–ª–∞–¥–µ–ª—å—Ü–∞
9. ‚úÖ `conversations` - –∏–∑–æ–ª—è—Ü–∏—è –ø–æ `owner_id = auth.uid()`
10. ‚úÖ `chat_messages` - –∏–∑–æ–ª—è—Ü–∏—è –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º –≤–ª–∞–¥–µ–ª—å—Ü–∞

#### **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (2)**
11. ‚úÖ `widget_development_settings` - –∏–∑–æ–ª—è—Ü–∏—è –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º –≤–ª–∞–¥–µ–ª—å—Ü–∞
12. ‚úÖ `telegram_settings` - –∏–∑–æ–ª—è—Ü–∏—è –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º –≤–ª–∞–¥–µ–ª—å—Ü–∞

#### **–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (2)**
13. ‚úÖ `knowledge_sources` - –∏–∑–æ–ª—è—Ü–∏—è –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º –≤–ª–∞–¥–µ–ª—å—Ü–∞
14. ‚úÖ `knowledge_chunks` - –∏–∑–æ–ª—è—Ü–∏—è –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º –≤–ª–∞–¥–µ–ª—å—Ü–∞

#### **CRM —Å–∏—Å—Ç–µ–º–∞ (6)**
15. ‚úÖ `crm_clients` - –∏–∑–æ–ª—è—Ü–∏—è –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º –≤–ª–∞–¥–µ–ª—å—Ü–∞
16. ‚úÖ `crm_deals` - –∏–∑–æ–ª—è—Ü–∏—è –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º –≤–ª–∞–¥–µ–ª—å—Ü–∞
17. ‚úÖ `crm_operators` - –∏–∑–æ–ª—è—Ü–∏—è –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º –≤–ª–∞–¥–µ–ª—å—Ü–∞
18. ‚úÖ `crm_tasks` - –∏–∑–æ–ª—è—Ü–∏—è –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º –≤–ª–∞–¥–µ–ª—å—Ü–∞
19. ‚úÖ `crm_deal_notes` - –∏–∑–æ–ª—è—Ü–∏—è –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º –≤–ª–∞–¥–µ–ª—å—Ü–∞
20. ‚úÖ `dialog_crm_connections` - –∏–∑–æ–ª—è—Ü–∏—è –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º –≤–ª–∞–¥–µ–ª—å—Ü–∞

#### **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (3)**
21. ‚úÖ `faq_cache` - –∏–∑–æ–ª—è—Ü–∏—è –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º –≤–ª–∞–¥–µ–ª—å—Ü–∞
22. ‚úÖ `help_requests` - –∏–∑–æ–ª—è—Ü–∏—è –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º –≤–ª–∞–¥–µ–ª—å—Ü–∞
23. ‚úÖ `dialog_with_operators` - –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ (–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ)

#### **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (2)**
24. ‚úÖ `messenger_contacts` - –∏–∑–æ–ª—è—Ü–∏—è –ø–æ `user_id = auth.uid()`
25. ‚úÖ `notifications` - –∏–∑–æ–ª—è—Ü–∏—è –ø–æ `user_id = auth.uid()`

#### **–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ (3)**
26. ‚úÖ `niches` - —á—Ç–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö, –∑–∞–ø–∏—Å—å –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤
27. ‚úÖ `niche_synonyms` - —á—Ç–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö, –∑–∞–ø–∏—Å—å –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤
28. ‚úÖ `chunk_synonyms` - —á—Ç–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö, –∑–∞–ø–∏—Å—å –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤

## üîí **–¢–ò–ü–´ RLS –ü–û–õ–ò–¢–ò–ö**

### **1. –ò–∑–æ–ª—è—Ü–∏—è –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º (project_id)**
```sql
CREATE POLICY "table_project_access" ON public.table
    FOR ALL USING (
        project_id IN (SELECT id FROM public.projects WHERE owner_id = auth.uid())
    )
    WITH CHECK (
        project_id IN (SELECT id FROM public.projects WHERE owner_id = auth.uid())
    );
```

### **2. –ò–∑–æ–ª—è—Ü–∏—è –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º (user_id)**
```sql
CREATE POLICY "table_user_access" ON public.table
    FOR ALL USING (user_id = auth.uid())
    WITH CHECK (user_id = auth.uid());
```

### **3. –ò–∑–æ–ª—è—Ü–∏—è –ø–æ –≤–ª–∞–¥–µ–ª—å—Ü–∞–º (owner_id)**
```sql
CREATE POLICY "table_owner_access" ON public.table
    FOR ALL USING (owner_id = auth.uid())
    WITH CHECK (owner_id = auth.uid());
```

### **4. –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ (—á—Ç–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö, –∑–∞–ø–∏—Å—å –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤)**
```sql
CREATE POLICY "table_read_all" ON public.table
    FOR SELECT TO authenticated USING (true);

CREATE POLICY "table_write_owners" ON public.table
    FOR INSERT WITH CHECK (EXISTS (SELECT 1 FROM public.projects WHERE owner_id = auth.uid()));
```

## üöÄ **–ö–õ–Æ–ß–ï–í–´–ï –î–û–°–¢–ò–ñ–ï–ù–ò–Ø**

### **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
- ‚úÖ **–ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è** –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –ø—Ä–æ–µ–∫—Ç–∞–º–∏
- ‚úÖ **–ó–∞—â–∏—Ç–∞** –æ—Ç —É—Ç–µ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞** –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ API** –∑–∞–ø—Ä–æ—Å—ã

### **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ** RLS –ø–æ–ª–∏—Ç–∏–∫–∏
- ‚úÖ **–ò–Ω–¥–µ–∫—Å—ã** –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–ª–µ–π
- ‚úÖ **–ë—ã—Å—Ç—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã** —Å –∏–∑–æ–ª—è—Ü–∏–µ–π
- ‚úÖ **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞** –Ω–∞ —Å–∏—Å—Ç–µ–º—É

### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
- ‚úÖ **–ü—Ä–æ–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è** —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å** –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

## üìà **–†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø**

### **–ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –ü—Ä–æ–µ–∫—Ç—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
- ‚úÖ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- ‚úÖ –í–ª–∞–¥–µ–ª—å—Ü—ã –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞–º–∏

### **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å RLS
- ‚úÖ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –ø–ª–∞–Ω—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

## üéØ **–°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò**

### **–§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ `–§–ò–ù–ê–õ–¨–ù–´–ô_–¢–ï–°–¢_RLS_–°–ò–°–¢–ï–ú–´.sql`
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ `–¢–ï–°–¢_–ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò_RLS_–§–ò–ù–ê–õ–¨–ù–´–ô.sql`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É API
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∏–∑–æ–ª—è—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö

### **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤

## üèÜ **–ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï**

–°–∏—Å—Ç–µ–º–∞ RLS –ø–æ–ª–∏—Ç–∏–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞. –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏–º–µ—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∏–∑–æ–ª—è—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â—É—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å. –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å –ø–æ–ª–Ω–æ–π –∑–∞—â–∏—Ç–æ–π –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø—Ä–æ–µ–∫—Ç–æ–≤.

**–°—Ç–∞—Ç—É—Å: ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û**
