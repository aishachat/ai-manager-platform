# üéØ –ò–¢–û–ì–û–í–´–ô –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô –ü–û RLS

## ‚úÖ –£–ñ–ï –í–´–ü–û–õ–ù–ï–ù–û

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
1. **users** - ‚úÖ `id = auth.uid()`
2. **projects** - ‚úÖ `owner_id = auth.uid()`
3. **project_members** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())`
4. **assistants** - ‚úÖ `owner_id = auth.uid()`
5. **autoswitch_settings** - ‚úÖ `user_id = auth.uid()`

### –ì–æ—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:
6. **conversations** - ‚úÖ `owner_id = auth.uid()` (—Å–∫—Ä–∏–ø—Ç –≥–æ—Ç–æ–≤)
7. **user_niches** - ‚úÖ `user_id = auth.uid() AND project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (—Å–∫—Ä–∏–ø—Ç –≥–æ—Ç–æ–≤)
8. **niche_synonyms** - ‚úÖ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫: —á—Ç–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö, –∑–∞–ø–∏—Å—å –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ (—Å–∫—Ä–∏–ø—Ç –≥–æ—Ç–æ–≤)
9. **ai_agent_settings** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (—Å–∫—Ä–∏–ø—Ç –≥–æ—Ç–æ–≤)
10. **dialogs** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (—Å–∫—Ä–∏–ø—Ç –≥–æ—Ç–æ–≤)
11. **chat_messages** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (—Å–∫—Ä–∏–ø—Ç –≥–æ—Ç–æ–≤)

## üîç –¢–†–ï–ë–£–ï–¢–°–Ø –ü–†–û–í–ï–†–ö–ê –°–¢–†–£–ö–¢–£–†–´

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
1. **ai_agent_settings** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ `project_id` –∏–ª–∏ `user_id`
2. **dialogs** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ `project_id` –∏–ª–∏ `owner_id`
3. **chat_messages** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ `project_id` –∏–ª–∏ `user_id`

### –¢–∞–±–ª–∏—Ü—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π:
4. **widget_development_settings** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
5. **telegram_settings** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
6. **bot_corrections** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É

### –¢–∞–±–ª–∏—Ü—ã –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π:
7. **knowledge_sources** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
8. **knowledge_chunks** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É

### –¢–∞–±–ª–∏—Ü—ã –Ω–∏—à:
9. **niches** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
10. **niche_synonyms** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
11. **user_niches** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É

## üöÄ –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### 1. –°–ï–ô–ß–ê–° - –í—ã–ø–æ–ª–Ω–∏—Ç—å –≥–æ—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:
- ‚úÖ `–®–ê–ì_8_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_CONVERSATIONS_–ü–†–ê–í–ò–õ–¨–ù–´–ô.sql`

### 2. –°–õ–ï–î–£–Æ–©–ò–ô –®–ê–ì - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
- –í—ã–ø–æ–ª–Ω–∏—Ç—å `–ü–†–û–í–ï–†–ö–ê_–í–°–ï–•_–û–°–¢–ê–í–®–ò–•–°–Ø_–¢–ê–ë–õ–ò–¶.sql`
- –ü–æ–ª—É—á–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤—Å–µ—Ö –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Ç–∞–±–ª–∏—Ü

### 3. –ü–û–°–õ–ï –ü–†–û–í–ï–†–ö–ò - –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã:
- –°–æ–∑–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã
- –£—á–µ—Å—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —Å–≤—è–∑–∏

### 4. –ü–û–®–ê–ì–û–í–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï:
- –ò—Å–ø—Ä–∞–≤–ª—è—Ç—å RLS –ø–æ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

## üéØ –ü–†–ò–ù–¶–ò–ü–´ RLS –ü–û–õ–ò–¢–ò–ö

### –î–ª—è —Ç–∞–±–ª–∏—Ü —Å `project_id`:
```sql
project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())
```

### –î–ª—è —Ç–∞–±–ª–∏—Ü —Å `user_id`:
```sql
user_id = auth.uid()
```

### –î–ª—è —Ç–∞–±–ª–∏—Ü —Å `owner_id`:
```sql
owner_id = auth.uid()
```

### –î–ª—è —Ç–∞–±–ª–∏—Ü –±–µ–∑ —ç—Ç–∏—Ö –∫–æ–ª–æ–Ω–æ–∫:
- –ù–∞–π—Ç–∏ —Å–≤—è–∑—å —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏ —á–µ—Ä–µ–∑ –¥—Ä—É–≥–∏–µ –∫–æ–ª–æ–Ω–∫–∏
- –í–æ–∑–º–æ–∂–Ω–æ, —á–µ—Ä–µ–∑ `assistant_id`, `dialog_id`, `conversation_id` –∏ —Ç.–¥.

## üìã –°–û–ó–î–ê–ù–ù–´–ï –§–ê–ô–õ–´

### –ì–æ—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:
1. ‚úÖ `–®–ê–ì_8_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_CONVERSATIONS_–ü–†–ê–í–ò–õ–¨–ù–´–ô.sql`
2. ‚úÖ `–ò–ù–°–¢–†–£–ö–¶–ò–Ø_–í–´–ü–û–õ–ù–ï–ù–ò–Ø_–®–ê–ì_8_–ü–†–ê–í–ò–õ–¨–ù–´–ô.md`

### –°–∫—Ä–∏–ø—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:
3. ‚úÖ `–ü–†–û–í–ï–†–ö–ê_–í–°–ï–•_–û–°–¢–ê–í–®–ò–•–°–Ø_–¢–ê–ë–õ–ò–¶.sql`
4. ‚úÖ `–ü–õ–ê–ù_RLS_–ü–û–õ–ò–¢–ò–ö_–î–õ–Ø_–í–°–ï–•_–¢–ê–ë–õ–ò–¶.md`

## üìû –¢–†–ï–ë–£–ï–¢–°–Ø –î–ï–ô–°–¢–í–ò–ï

### –ù–ï–ú–ï–î–õ–ï–ù–ù–û:
1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ `–®–ê–ì_8_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_CONVERSATIONS_–ü–†–ê–í–ò–õ–¨–ù–´–ô.sql`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü–û–°–õ–ï –í–´–ü–û–õ–ù–ï–ù–ò–Ø:
1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ `–ü–†–û–í–ï–†–ö–ê_–í–°–ï–•_–û–°–¢–ê–í–®–ò–•–°–Ø_–¢–ê–ë–õ–ò–¶.sql`
2. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤

## üí° –í–ê–ñ–ù–û
- –ö–∞–∂–¥–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∏–º–µ–µ—Ç —Å–≤–æ—é –ª–æ–≥–∏–∫—É RLS
- –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã
- RLS –¥–æ–ª–∂–µ–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å –∏–∑–æ–ª—è—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ API
- –ü—Ä–∏–Ω—Ü–∏–ø: 1 –ø—Ä–æ–µ–∫—Ç = –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
