# üìä –û–¢–ß–ï–¢ –û –°–¢–†–£–ö–¢–£–†–ï AUTOSWITCH_SETTINGS

## üîç –û–ë–ù–ê–†–£–ñ–ï–ù–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê

### –¢–∞–±–ª–∏—Ü–∞: `autoswitch_settings`
```sql
–°—Ç—Ä—É–∫—Ç—É—Ä–∞:
- user_id (FK -> users.id) - –æ—Å–Ω–æ–≤–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ –¥–ª—è RLS
- –¥—Ä—É–≥–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞–≤—Ç–æ–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
```

### –°–≤—è–∑–∏:
```json
{
  "table_name": "autoswitch_settings",
  "column_name": "user_id", 
  "foreign_table_name": "users",
  "foreign_column_name": "id"
}
```

## üéØ –õ–û–ì–ò–ö–ê RLS

### ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–ª–æ—Å—å):
```sql
-- –ü–æ–ª–∏—Ç–∏–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ project_id
project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())
```

### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (—Ä–µ–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞):
```sql
-- –ü–æ–ª–∏—Ç–∏–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ user_id
user_id = auth.uid()
```

## üìã –ü–†–ò–ù–¶–ò–ü –†–ê–ë–û–¢–´

### –õ–æ–≥–∏–∫–∞ —Ç–∞–±–ª–∏—Ü—ã:
- **1 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = 1 –Ω–∞–±–æ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫** –∞–≤—Ç–æ–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### RLS –ø–æ–ª–∏—Ç–∏–∫–∞:
```sql
CREATE POLICY "autoswitch_settings_user_access" ON public.autoswitch_settings
    FOR ALL USING (user_id = auth.uid())
    WITH CHECK (user_id = auth.uid());
```

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –°–æ–∑–¥–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç:
- ‚úÖ `–®–ê–ì_6_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_AUTOSWITCH_SETTINGS_–ü–†–ê–í–ò–õ–¨–ù–´–ô.sql`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `user_id = auth.uid()`
- ‚úÖ –ë–µ–∑ –æ—à–∏–±–æ–∫ —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –∫–æ–ª–æ–Ω–∫–∞–º–∏

### 2. –°–æ–∑–¥–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:
- ‚úÖ `–ò–ù–°–¢–†–£–ö–¶–ò–Ø_–í–´–ü–û–õ–ù–ï–ù–ò–Ø_–®–ê–ì_6_–ü–†–ê–í–ò–õ–¨–ù–´–ô.md`
- ‚úÖ –û–±—ä—è—Å–Ω—è–µ—Ç –ª–æ–≥–∏–∫—É –Ω–∞ –æ—Å–Ω–æ–≤–µ user_id
- ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### 1. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
- –ó–∞–ø—É—Å—Ç–∏—Ç—å `–®–ê–ì_6_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_AUTOSWITCH_SETTINGS_–ü–†–ê–í–ò–õ–¨–ù–´–ô.sql`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥—Ä—É–≥–∏–µ —Ç–∞–±–ª–∏—Ü—ã:
–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü:
- `ai_agent_settings` - –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–∂–µ –Ω–∞ user_id
- `dialogs` - –≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞ project_id
- `conversations` - –≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞ project_id  
- `chat_messages` - –≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞ project_id

### 3. –°–æ–∑–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:
–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü —Å–æ–∑–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π.

## üí° –í–´–í–û–î–´

1. **–ù–µ –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ project_id** - –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–∞ user_id
2. **–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã** –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º RLS
3. **–õ–æ–≥–∏–∫–∞ RLS –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã**:
   - `project_id` ‚Üí –ø–æ–ª–∏—Ç–∏–∫–∞ —á–µ—Ä–µ–∑ –ø—Ä–æ–µ–∫—Ç—ã
   - `user_id` ‚Üí –ø–æ–ª–∏—Ç–∏–∫–∞ —á–µ—Ä–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - `owner_id` ‚Üí –ø–æ–ª–∏—Ç–∏–∫–∞ —á–µ—Ä–µ–∑ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤

## üìû –¢–†–ï–ë–£–ï–¢–°–Ø –î–ï–ô–°–¢–í–ò–ï
–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç `–®–ê–ì_6_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_AUTOSWITCH_SETTINGS_–ü–†–ê–í–ò–õ–¨–ù–´–ô.sql` –∏ —Å–æ–æ–±—â–∏—Ç–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö.
