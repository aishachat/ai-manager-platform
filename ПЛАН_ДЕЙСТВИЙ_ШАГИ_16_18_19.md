# üìã –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô - –®–ê–ì–ò 16, 18, 19

## üéØ –ì–û–¢–û–í–´–ï –°–ö–†–ò–ü–¢–´

### ‚úÖ –°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü:

1. **`–®–ê–ì_16_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_TELEGRAM_SETTINGS_–ü–†–û–ï–ö–¢.sql`** - –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `telegram_settings`
2. **`–®–ê–ì_18_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_KNOWLEDGE_SOURCES_–ü–†–û–ï–ö–¢.sql`** - –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `knowledge_sources`
3. **`–®–ê–ì_19_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_KNOWLEDGE_CHUNKS_–ü–†–û–ï–ö–¢.sql`** - –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `knowledge_chunks`

## üîß –õ–û–ì–ò–ö–ê RLS

### –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç **PROJECT_ID –ª–æ–≥–∏–∫—É** –¥–ª—è –∫–æ–º–∞–Ω–¥–Ω–æ–π —Ä–∞–±–æ—Ç—ã:
```sql
project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())
```

**–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è:**
- `telegram_settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram –±–æ—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞
- `knowledge_sources` - –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∑–Ω–∞–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞
- `knowledge_chunks` - —á–∞–Ω–∫–∏ –∑–Ω–∞–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞

## üöÄ –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û–°–¢–¨ –î–ï–ô–°–¢–í–ò–ô

### –ù–ï–ú–ï–î–õ–ï–ù–ù–û:
1. –í—ã–ø–æ–ª–Ω–∏—Ç—å `–®–ê–ì_16_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_TELEGRAM_SETTINGS_–ü–†–û–ï–ö–¢.sql`
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å `–®–ê–ì_18_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_KNOWLEDGE_SOURCES_–ü–†–û–ï–ö–¢.sql`
3. –í—ã–ø–æ–ª–Ω–∏—Ç—å `–®–ê–ì_19_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_KNOWLEDGE_CHUNKS_–ü–†–û–ï–ö–¢.sql`
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü–û–°–õ–ï –£–°–ü–ï–•–ê:
–°–æ–∑–¥–∞–º —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü:
- `crm_clients` - –∫–ª–∏–µ–Ω—Ç—ã CRM –ø—Ä–æ–µ–∫—Ç–∞
- `crm_deals` - —Å–¥–µ–ª–∫–∏ CRM –ø—Ä–æ–µ–∫—Ç–∞
- `crm_operators` - –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã CRM –ø—Ä–æ–µ–∫—Ç–∞

## üí° –í–ê–ñ–ù–û

### **–í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–æ—Å—Ç—É—é PROJECT_ID –ª–æ–≥–∏–∫—É
- ‚úÖ USER_ID –æ—Å—Ç–∞–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- ‚úÖ –ö–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞ - –≤—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ –≤–∏–¥—è—Ç –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### **–û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ RLS –≤–∫–ª—é—á–µ–Ω
- ‚úÖ –ü–æ–ª–∏—Ç–∏–∫–∏ —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ –ü—Ä–∞–≤–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã
- ‚úÖ –¢–µ—Å—Ç –∏–∑–æ–ª—è—Ü–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤ –≤–ª–∞–¥–µ–ª—å—Ü–∞

## üìû –¢–†–ï–ë–£–ï–¢–°–Ø –î–ï–ô–°–¢–í–ò–ï

### **–°–ï–ô–ß–ê–°:**
1. –í—ã–ø–æ–ª–Ω–∏—Ç—å –≥–æ—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
3. –°–æ–æ–±—â–∏—Ç—å –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö

### **–ü–û–°–õ–ï –£–°–ü–ï–•–ê:**
1. –°–æ–∑–¥–∞–º —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
2. –ü—Ä–∏–º–µ–Ω–∏–º —Ç—É –∂–µ –ª–æ–≥–∏–∫—É
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º –≤—Å—é —Å–∏—Å—Ç–µ–º—É

## üéØ –ü–†–û–ì–†–ï–°–°

### **‚úÖ –í–´–ü–û–õ–ù–ï–ù–û (12 —Ç–∞–±–ª–∏—Ü):**
1. **users** - ‚úÖ `id = auth.uid()`
2. **projects** - ‚úÖ `owner_id = auth.uid()`
3. **project_members** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())`
4. **assistants** - ‚úÖ `owner_id = auth.uid()`
5. **autoswitch_settings** - ‚úÖ `user_id = auth.uid()`
6. **conversations** - ‚úÖ `owner_id = auth.uid()`
7. **user_niches** - ‚úÖ `user_id = auth.uid() AND project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())`
8. **niche_synonyms** - ‚úÖ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫: —á—Ç–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö, –∑–∞–ø–∏—Å—å –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤
9. **ai_agent_settings** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())`
10. **dialogs** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())`
11. **chat_messages** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())`
12. **widget_development_settings** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())`

### **üéØ –ì–û–¢–û–í–´ –ö –í–´–ü–û–õ–ù–ï–ù–ò–Æ (3 —Ç–∞–±–ª–∏—Ü—ã):**
13. **telegram_settings** - –≥–æ—Ç–æ–≤ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é
14. **knowledge_sources** - –≥–æ—Ç–æ–≤ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é
15. **knowledge_chunks** - –≥–æ—Ç–æ–≤ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é

**–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!** üöÄ
