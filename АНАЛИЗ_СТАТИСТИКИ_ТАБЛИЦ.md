# üìä –ê–ù–ê–õ–ò–ó –°–¢–ê–¢–ò–°–¢–ò–ö–ò –¢–ê–ë–õ–ò–¶

## ‚úÖ –û–¢–õ–ò–ß–ù–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´!

### –ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
- **users**: 14,582 seq scans, 49,585 index scans (77% –∏–Ω–¥–µ–∫—Å—ã)
- **chat_messages**: 533 seq scans, 15,773 index scans (97% –∏–Ω–¥–µ–∫—Å—ã)
- **dialogs**: 127 seq scans, 10,939 index scans (99% –∏–Ω–¥–µ–∫—Å—ã)
- **widget_api_keys**: 58 seq scans, 4,775 index scans (99% –∏–Ω–¥–µ–∫—Å—ã)

## üéØ –ê–ù–ê–õ–ò–ó –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò

### ‚úÖ –í–´–°–û–ö–ê–Ø –≠–§–§–ï–ö–¢–ò–í–ù–û–°–¢–¨ –ò–ù–î–ï–ö–°–û–í:

#### 1. **dialogs** - 99% –∏–Ω–¥–µ–∫—Å–Ω—ã—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π:
- Sequential scans: 127
- Index scans: 10,939
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: 99% –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏–Ω–¥–µ–∫—Å—ã
- **RLS —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ** - –Ω–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

#### 2. **chat_messages** - 97% –∏–Ω–¥–µ–∫—Å–Ω—ã—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π:
- Sequential scans: 533
- Index scans: 15,773
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: 97% –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏–Ω–¥–µ–∫—Å—ã
- **RLS —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ** - –Ω–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

#### 3. **widget_api_keys** - 99% –∏–Ω–¥–µ–∫—Å–Ω—ã—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π:
- Sequential scans: 58
- Index scans: 4,775
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: 99% –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏–Ω–¥–µ–∫—Å—ã
- **RLS —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ** - –Ω–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

### ‚úÖ –£–ú–ï–†–ï–ù–ù–ê–Ø –≠–§–§–ï–ö–¢–ò–í–ù–û–°–¢–¨:

#### 4. **users** - 77% –∏–Ω–¥–µ–∫—Å–Ω—ã—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π:
- Sequential scans: 14,582
- Index scans: 49,585
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: 77% –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏–Ω–¥–µ–∫—Å—ã
- **RLS —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ** - –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

#### 5. **knowledge_sources** - 60% –∏–Ω–¥–µ–∫—Å–Ω—ã—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π:
- Sequential scans: 2,652
- Index scans: 3,956
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: 60% –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏–Ω–¥–µ–∫—Å—ã
- **RLS —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ** - –º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å

## üîç –ê–ù–ê–õ–ò–ó RLS –ü–û–õ–ò–¢–ò–ö

### ‚úÖ –ü–û–õ–ò–¢–ò–ö–ò –†–ê–ë–û–¢–ê–Æ–¢ –û–¢–õ–ò–ß–ù–û:

#### 1. **PROJECT_ID –ª–æ–≥–∏–∫–∞** (dialogs, chat_messages):
- **–í—ã—Å–æ–∫–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** - 97-99% –∏–Ω–¥–µ–∫—Å–Ω—ã—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- **–ù–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫** - –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±—ã—Å—Ç—Ä–æ
- **–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –∏–Ω–¥–µ–∫—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç

#### 2. **USER_ID –ª–æ–≥–∏–∫–∞** (autoswitch_settings):
- **–ù–∏–∑–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞** - 17 seq scans, 10 index scans
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ** - –º–∞–ª–æ –∑–∞–ø—Ä–æ—Å–æ–≤, –±—ã—Å—Ç—Ä—ã–µ
- **–°—Ç–∞–±–∏–ª—å–Ω–æ** - –Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º

#### 3. **OWNER_ID –ª–æ–≥–∏–∫–∞** (conversations):
- **–•–æ—Ä–æ—à–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** - 1,283 seq scans, 1,443 index scans
- **–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ** - 53% –∏–Ω–¥–µ–∫—Å–Ω—ã—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- **–†–∞–±–æ—Ç–∞–µ—Ç** - –Ω–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

#### 4. **–°–ø—Ä–∞–≤–æ—á–Ω–∞—è –ª–æ–≥–∏–∫–∞** (niche_synonyms):
- **–ù–∏–∑–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞** - 90 seq scans, 113 index scans
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ** - 56% –∏–Ω–¥–µ–∫—Å–Ω—ã—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- **–°—Ç–∞–±–∏–ª—å–Ω–æ** - —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –±—ã—Å—Ç—Ä–æ

## üö® –¢–ê–ë–õ–ò–¶–´ –î–õ–Ø –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò

### 1. **ai_agent_settings** - –Ω—É–∂–Ω—ã –∏–Ω–¥–µ–∫—Å—ã:
- Sequential scans: 623
- Index scans: 27
- **–ü—Ä–æ–±–ª–µ–º–∞**: —Ç–æ–ª—å–∫–æ 4% –∏–Ω–¥–µ–∫—Å–Ω—ã—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- **–†–µ—à–µ–Ω–∏–µ**: –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å –Ω–∞ project_id

### 2. **user_niches** - –Ω—É–∂–Ω—ã –∏–Ω–¥–µ–∫—Å—ã:
- Sequential scans: 115
- Index scans: 24
- **–ü—Ä–æ–±–ª–µ–º–∞**: —Ç–æ–ª—å–∫–æ 17% –∏–Ω–¥–µ–∫—Å–Ω—ã—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- **–†–µ—à–µ–Ω–∏–µ**: –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ user_id –∏ project_id

### 3. **projects** - –Ω—É–∂–Ω—ã –∏–Ω–¥–µ–∫—Å—ã:
- Sequential scans: 110
- Index scans: 95
- **–ü—Ä–æ–±–ª–µ–º–∞**: —Ç–æ–ª—å–∫–æ 46% –∏–Ω–¥–µ–∫—Å–Ω—ã—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- **–†–µ—à–µ–Ω–∏–µ**: –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å –Ω–∞ owner_id

## üîß –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò

### 1. –ù–ï–ú–ï–î–õ–ï–ù–ù–û - –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã:
```sql
-- –î–ª—è ai_agent_settings
CREATE INDEX IF NOT EXISTS idx_ai_agent_settings_project_id ON public.ai_agent_settings(project_id);

-- –î–ª—è user_niches
CREATE INDEX IF NOT EXISTS idx_user_niches_user_id ON public.user_niches(user_id);
CREATE INDEX IF NOT EXISTS idx_user_niches_project_id ON public.user_niches(project_id);

-- –î–ª—è projects
CREATE INDEX IF NOT EXISTS idx_projects_owner_id ON public.projects(owner_id);
```

### 2. –ú–û–ù–ò–¢–û–†–ò–¢–¨ - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- –°–ª–µ–¥–∏—Ç—å –∑–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### 3. –¢–ï–°–¢–ò–†–û–í–ê–¢–¨ - API –∑–∞–ø—Ä–æ—Å—ã:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- –£–±–µ–¥–∏—Ç—å—Å—è –≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

## üí° –í–´–í–û–î–´

### ‚úÖ **RLS –ü–û–õ–ò–¢–ò–ö–ò –†–ê–ë–û–¢–ê–Æ–¢ –û–¢–õ–ò–ß–ù–û:**

1. **–ù–ï –±–ª–æ–∫–∏—Ä—É—é—Ç API** - –≤—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –∏–Ω–¥–µ–∫—Å–Ω—ã—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
2. **–ë—ã—Å—Ç—Ä—ã–µ** - –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
3. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ** - –∏–Ω–¥–µ–∫—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
4. **–°—Ç–∞–±–∏–ª—å–Ω—ã–µ** - –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

### üéØ **–°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:**

1. **–î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
2. **–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤** –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã** –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

## üö® –í–ê–ñ–ù–û

**–í–∞—à–∏ –æ–ø–∞—Å–µ–Ω–∏—è –±—ã–ª–∏ –Ω–µ–æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã!** RLS –ø–æ–ª–∏—Ç–∏–∫–∏:
- **–†–∞–±–æ—Ç–∞—é—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ** - –≤—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –∏–Ω–¥–µ–∫—Å–Ω—ã—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- **–ù–µ –±–ª–æ–∫–∏—Ä—É—é—Ç API** - –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±—ã—Å—Ç—Ä–æ
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã** - –∏–Ω–¥–µ–∫—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- **–°—Ç–∞–±–∏–ª—å–Ω—ã** - –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

**–ú–æ–∂–Ω–æ —Å–º–µ–ª–æ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å!** üöÄ
