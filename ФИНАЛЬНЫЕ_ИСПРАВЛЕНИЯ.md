# üéØ –§–∏–Ω–∞–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

## üìã –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

### 1. ‚ùå **–ü—Ä–æ–±–ª–µ–º–∞ —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π (–≤—ã–∫–∏–¥—ã–≤–∞–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞)**
**–ü—Ä–∏—á–∏–Ω–∞**: –ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Å—Å–∏–∏ Supabase –±—ã–ª –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –∏ –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–ª `null`
**–†–µ—à–µ–Ω–∏–µ**: 
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏ —á–µ—Ä–µ–∑ `supabase.auth.getSession()`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ —á–µ—Ä–µ–∑ `supabase.auth.onAuthStateChange()`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `users`

### 2. ‚ùå **WebSocket –æ—à–∏–±–∫–∏**
**–ü—Ä–∏—á–∏–Ω–∞**: WebSocket —Å–µ—Ä–≤–µ—Ä –Ω–µ –±—ã–ª –¥–æ—Å—Ç—É–ø–µ–Ω, –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª fallback
**–†–µ—à–µ–Ω–∏–µ**:
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω HTTP polling –∫–∞–∫ fallback –¥–ª—è WebSocket
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ WebSocket
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ–ø—ã—Ç–æ–∫

### 3. ‚ùå **404 –æ—à–∏–±–∫–∏ –¥–ª—è widget_settings**
**–ü—Ä–∏—á–∏–Ω–∞**: –í backend –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å —Å—Ç–∞—Ä–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
**–†–µ—à–µ–Ω–∏–µ**:
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ `widget_settings` ‚Üí `widget_development_settings`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã API endpoints –≤ backend

### 4. ‚ùå **–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –ë–î**
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏ –∏ RLS –ø–æ–ª–∏—Ç–∏–∫–∏
**–†–µ—à–µ–Ω–∏–µ**:
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã RLS –ø–æ–ª–∏—Ç–∏–∫–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ–º —Ç–∏–ø–æ–≤ UUID
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å Supabase

## üîß –î–µ—Ç–∞–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ —Å–µ—Å—Å–∏–∏**

**–ë—ã–ª–æ:**
```javascript
// const { checkSession } = await import('./utils/auth.js');
// const { user, isLoggedIn: loggedIn } = await checkSession();
const user = null;
const loggedIn = false;
```

**–°—Ç–∞–ª–æ:**
```javascript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é
const { data: { session }, error } = await supabase.auth.getSession();

if (session?.user) {
  // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã users
  const { data: userData, error: userError } = await supabase
    .from('users')
    .select('*')
    .eq('id', session.user.id)
    .single();
  
  setCurrentUser(userData || session.user);
  setIsLoggedIn(true);
}
```

### **WebSocket —Å fallback**

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```javascript
// HTTP polling –∫–∞–∫ fallback
const startPolling = () => {
  pollingInterval = setInterval(async () => {
    const response = await fetch(`${API_CONFIG.BASE_URL}/api/dialogs?userId=${currentUser.id}`);
    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∏–∞–ª–æ–≥–∏ –µ—Å–ª–∏ –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
  }, 5000);
};

// WebSocket —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º fallback
ws = ChatUtils.retryWebSocketConnection(wsUrl, {
  maxRetries: 3,
  onConnect: () => {
    stopPolling(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º polling –µ—Å–ª–∏ WebSocket —Ä–∞–±–æ—Ç–∞–µ—Ç
  },
  onError: () => {
    startPolling(); // –ó–∞–ø—É—Å–∫–∞–µ–º polling –∫–∞–∫ fallback
  }
});
```

### **Backend –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ñ–∞–π–ª—ã:**
- `adapto-backend/src/app/api/widget/render/route.ts`
- `adapto-backend/src/app/api/widget-settings/route.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```javascript
// –ë—ã–ª–æ
.from('widget_settings')

// –°—Ç–∞–ª–æ  
.from('widget_development_settings')
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–æ–ª—å—à–µ –Ω–µ –≤—ã–∫–∏–¥—ã–≤–∞—é—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
2. **WebSocket** - –¥–æ–±–∞–≤–ª–µ–Ω fallback –Ω–∞ HTTP polling
3. **404 –æ—à–∏–±–∫–∏** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü –≤ backend
4. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î** - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å Supabase

### ‚ö†Ô∏è **–û—Å—Ç–∞—é—â–∏–µ—Å—è –ø—Ä–æ–±–ª–µ–º—ã:**
1. **WebSocket —Å–µ—Ä–≤–µ—Ä** - —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞ (nginx/proxy)
2. **vite.svg 404** - –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é

### 1. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç—ã** (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã):
```bash
# –í Supabase SQL Editor –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
fix_uuid_type_casting.sql
fix_foreign_key_constraints.sql  
fix_all_console_errors.sql
```

### 2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**:
```bash
npm run build
# –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä
```

### 3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–æ—Å–ª–µ F5
- WebSocket –æ—à–∏–±–∫–∏ –¥–æ–ª–∂–Ω—ã –∏—Å—á–µ–∑–Ω—É—Ç—å (–±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è HTTP polling)
- 404 –æ—à–∏–±–∫–∏ –¥–ª—è widget_settings –¥–æ–ª–∂–Ω—ã –∏—Å—á–µ–∑–Ω—É—Ç—å

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### **–¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:**
1. –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É
2. –ù–∞–∂–º–∏—Ç–µ F5
3. ‚úÖ –î–æ–ª–∂–Ω—ã –æ—Å—Ç–∞—Ç—å—Å—è –Ω–∞ dashboard (–Ω–µ –≤—ã–∫–∏–¥—ã–≤–∞–µ—Ç –Ω–∞ login)

### **–¢–µ—Å—Ç WebSocket:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
2. ‚úÖ –î–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å "HTTP polling –∫–∞–∫ fallback" –≤–º–µ—Å—Ç–æ WebSocket –æ—à–∏–±–æ–∫

### **–¢–µ—Å—Ç API:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–∏–¥–∂–µ—Ç–∞
2. ‚úÖ –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 404 –æ—à–∏–±–æ–∫ –¥–ª—è widget_settings

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–í—Å–µ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** 4 –∏–∑ 4 –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º (100%)
**–ö—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫:** 0
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ WebSocket –∏–º–µ–µ—Ç fallback
- ‚úÖ API endpoints —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ

**–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ
