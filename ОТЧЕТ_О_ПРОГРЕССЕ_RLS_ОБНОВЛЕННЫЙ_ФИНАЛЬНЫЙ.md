# üìä –û–¢–ß–ï–¢ –û –ü–†–û–ì–†–ï–°–°–ï RLS (–û–ë–ù–û–í–õ–ï–ù–ù–´–ô –§–ò–ù–ê–õ–¨–ù–´–ô)

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (–®–ê–ì 1-4):
1. **users** - ‚úÖ `id = auth.uid()`
2. **projects** - ‚úÖ `owner_id = auth.uid()`
3. **project_members** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())`
4. **assistants** - ‚úÖ `owner_id = auth.uid()`

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (–®–ê–ì 6-15):
5. **autoswitch_settings** - ‚úÖ `user_id = auth.uid()` (–ª–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
6. **conversations** - ‚úÖ `owner_id = auth.uid()` (—Ä–∞–∑–≥–æ–≤–æ—Ä—ã –≤–ª–∞–¥–µ–ª—å—Ü–∞)
7. **user_niches** - ‚úÖ `user_id = auth.uid() AND project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è)
8. **niche_synonyms** - ‚úÖ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫: —á—Ç–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö, –∑–∞–ø–∏—Å—å –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤
9. **ai_agent_settings** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
10. **dialogs** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
11. **chat_messages** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
12. **widget_development_settings** - ‚úÖ `project_id IN (SELECT id FROM projects WHERE owner_id = auth.uid())` (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞)

## üéØ –ü–†–ò–ú–ï–ù–ï–ù–ù–´–ï –°–¢–†–ê–¢–ï–ì–ò–ò

### 1. PROJECT_ID –ª–æ–≥–∏–∫–∞ (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞):
- `ai_agent_settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≥–µ–Ω—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞
- `dialogs` - –¥–∏–∞–ª–æ–≥–∏ –ø—Ä–æ–µ–∫—Ç–∞
- `chat_messages` - —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ
- `widget_development_settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏–¥–∂–µ—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞

### 2. USER_ID –ª–æ–≥–∏–∫–∞ (–ª–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏):
- `autoswitch_settings` - –ª–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 3. OWNER_ID –ª–æ–≥–∏–∫–∞ (–≤–ª–∞–¥–µ–ª–µ—Ü):
- `conversations` - —Ä–∞–∑–≥–æ–≤–æ—Ä—ã –≤–ª–∞–¥–µ–ª—å—Ü–∞

### 4. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ (–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ):
- `user_niches` - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∏—à–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø—Ä–æ–µ–∫—Ç–µ

### 5. –°–ø—Ä–∞–≤–æ—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ (–æ–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ):
- `niche_synonyms` - —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Å–∏–Ω–æ–Ω–∏–º–æ–≤

## üìã –û–°–¢–ê–í–®–ò–ï–°–Ø –¢–ê–ë–õ–ò–¶–´

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (—Ç—Ä–µ–±—É—é—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è):
1. **telegram_settings** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram –ø—Ä–æ–µ–∫—Ç–∞
2. **knowledge_sources** - –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∑–Ω–∞–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞
3. **knowledge_chunks** - —á–∞–Ω–∫–∏ –∑–Ω–∞–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞
4. **crm_clients** - –∫–ª–∏–µ–Ω—Ç—ã CRM –ø—Ä–æ–µ–∫—Ç–∞
5. **crm_deals** - —Å–¥–µ–ª–∫–∏ CRM –ø—Ä–æ–µ–∫—Ç–∞
6. **crm_operators** - –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã CRM –ø—Ä–æ–µ–∫—Ç–∞

### –í–æ–∑–º–æ–∂–Ω—ã–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏:
7. **niches** - –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–∂–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫
8. **chunk_synonyms** - –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–∂–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –ù–ï–ú–ï–î–õ–ï–ù–ù–û:
1. –í—ã–ø–æ–ª–Ω–∏—Ç—å `–®–ê–ì_16_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_TELEGRAM_SETTINGS_–ü–†–û–ï–ö–¢.sql`
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å `–®–ê–ì_18_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_KNOWLEDGE_SOURCES_–ë–ï–ó_–û–®–ò–ë–û–ö.sql`
3. –í—ã–ø–æ–ª–Ω–∏—Ç—å `–®–ê–ì_19_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_KNOWLEDGE_CHUNKS_–ë–ï–ó_–û–®–ò–ë–û–ö.sql`
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü–û–°–õ–ï –£–°–ü–ï–•–ê:
1. –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å PROJECT_ID –ª–æ–≥–∏–∫—É –¥–ª—è CRM —Å–∏—Å—Ç–µ–º—ã
3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å PROJECT_ID –ª–æ–≥–∏–∫—É –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü

### –í –î–û–õ–ì–û–°–†–û–ß–ù–û–ô –ü–ï–†–°–ü–ï–ö–¢–ò–í–ï:
1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É API
3. –£–±–µ–¥–∏—Ç—å—Å—è –≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

## üí° –í–´–í–û–î–´

### 1. –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç:
- PROJECT_ID –ª–æ–≥–∏–∫–∞ –¥–ª—è –∫–æ–º–∞–Ω–¥–Ω–æ–π —Ä–∞–±–æ—Ç—ã
- USER_ID –ª–æ–≥–∏–∫–∞ –¥–ª—è –ª–∏—á–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–æ–µ–∫—Ç–µ
- –°–ø—Ä–∞–≤–æ—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –æ–±—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

### 2. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- –ü—Ä–æ—Å—Ç—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –±—ã—Å—Ç—Ä–æ
- –ù–µ—Ç —Å–ª–æ–∂–Ω—ã—Ö UNION –∑–∞–ø—Ä–æ—Å–æ–≤
- –ò–Ω–¥–µ–∫—Å—ã –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è –ø–æ–∫–∞

### 3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- –î–∞–Ω–Ω—ã–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
- –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–º

## üìû –¢–†–ï–ë–£–ï–¢–°–Ø –î–ï–ô–°–¢–í–ò–ï
–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∏ —Å–æ–æ–±—â–∏—Ç–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã.

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ `u.id::text = wds.user_id` –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ JOIN –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –£–±—Ä–∞–Ω—ã –æ—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- –°–æ–∑–¥–∞–Ω—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤

## üéØ –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–°
- ‚úÖ –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –¢–µ—Å—Ç –∏–∑–æ–ª—è—Ü–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞
